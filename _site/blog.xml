<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Visible Data</title>
<link>https://visibledata.co.uk/blog.html</link>
<atom:link href="https://visibledata.co.uk/blog.xml" rel="self" type="application/rss+xml"/>
<description>Data Science Consultancy &amp; Training</description>
<generator>quarto-1.7.29</generator>
<lastBuildDate>Sat, 14 Dec 2024 00:00:00 GMT</lastBuildDate>
<item>
  <title>Advent of Code 2024 - Day 3</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-12-14_advent-of-code-2024-03/</link>
  <description><![CDATA[ 





<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You really shouldn’t be reading this before you’ve had a go yourself!
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<section id="r" class="level1">
<h1>R</h1>
<p>Let’s try with test data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb1-2"></span>
<span id="cb1-3">data_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xmul(2,4)%&amp;mul[3,7]!@^do_not_mul(5,5)+mul(32,64]then(mul(11,8)mul(8,5))"</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">extracted_operations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract_all</span>(data_test, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mul[(]</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{1,3},</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{1,3}[)]"</span>)[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract_all</span>(.,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{1,3},</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{1,3}"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace</span>(., <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-9">  .[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] </span>
<span id="cb1-10"></span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(extracted_operations, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 161</code></pre>
</div>
</div>
<p>And the real data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">data_real <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input.txt"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb3-2"></span>
<span id="cb3-3">extracted_operations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract_all</span>(data_real, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mul[(]</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{1,3},</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{1,3}[)]"</span>)[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract_all</span>(.,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{1,3},</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{1,3}"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace</span>(., <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-7">  .[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] </span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(extracted_operations, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 183380722</code></pre>
</div>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {Advent of {Code} 2024 - {Day} 3},
  date = {2024-12-14},
  url = {https://visibledata.co.uk/posts/2024-12-14_advent-of-code-2024-03/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“Advent of Code 2024 - Day 3.”</span>
December 14, 2024. <a href="https://visibledata.co.uk/posts/2024-12-14_advent-of-code-2024-03/">https://visibledata.co.uk/posts/2024-12-14_advent-of-code-2024-03/</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2024-12-14_advent-of-code-2024-03/</guid>
  <pubDate>Sat, 14 Dec 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Advent of Code 2024 - Day 1</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-12-01_advent-of-code-2024-01/</link>
  <description><![CDATA[ 





<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
You really shouldn’t be reading this before you’ve had a go yourself!
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<section id="r" class="level1">
<h1>R</h1>
<p>Rightyo! Let’s solve with the toy example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">vec_1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb1-2">vec_2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(vec_1) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(vec_2)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 11</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb3-2"></span>
<span id="cb3-3">input_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input.txt"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"list_1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"list_2"</span>))</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(input_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>list_1) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(input_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>list_2)))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 2176849</code></pre>
</div>
</div>
</section>
<section id="sql" class="level1">
<h1>SQL</h1>
<p>Let me solve this for the simple dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dbplyr"</span>)</span>
<span id="cb5-2">simple_table <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb5-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_1 =</span> vec_1,</span>
<span id="cb5-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list_2 =</span> vec_2</span>
<span id="cb5-5">)</span>
<span id="cb5-6"></span>
<span id="cb5-7">input_tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memdb_frame</span>(simple_table, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"simple_table"</span>)</span>
<span id="cb5-8"></span>
<span id="cb5-9">input_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remote_con</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sql</span>(</span>
<span id="cb5-12">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb5-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  WITH indexed_list_1 AS (</span></span>
<span id="cb5-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  SELECT</span></span>
<span id="cb5-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  ROW_NUMBER() OVER(ORDER BY `list_1`) AS `index`,</span></span>
<span id="cb5-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  `list_1`</span></span>
<span id="cb5-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FROM</span></span>
<span id="cb5-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  `simple_table`</span></span>
<span id="cb5-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  ),</span></span>
<span id="cb5-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb5-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  indexed_list_2 AS (</span></span>
<span id="cb5-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  SELECT </span></span>
<span id="cb5-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  ROW_NUMBER() OVER(ORDER BY `list_2`) AS `index`,</span></span>
<span id="cb5-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  `list_2`</span></span>
<span id="cb5-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FROM `simple_table`</span></span>
<span id="cb5-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  ORDER BY list_1)</span></span>
<span id="cb5-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb5-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  SELECT</span></span>
<span id="cb5-29"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  SUM(ABS(`list_1` - `list_2`)) AS `distance`</span></span>
<span id="cb5-30"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FROM</span></span>
<span id="cb5-31"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  indexed_list_1 LEFT JOIN indexed_list_2</span></span>
<span id="cb5-32"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  USING(`index`)</span></span>
<span id="cb5-33"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb5-34"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  "</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># Source:   SQL [1 x 1]
# Database: sqlite 3.46.0 [:memory:]
  distance
     &lt;dbl&gt;
1       11</code></pre>
</div>
</div>
<p>Great! Let’s scale up to this proper one</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">real_input_tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memdb_frame</span>(input_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"advent_data"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">overwrite=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb7-2"></span>
<span id="cb7-3">real_input_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remote_con</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sql</span>(</span>
<span id="cb7-6">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb7-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  WITH indexed_list_1 AS (</span></span>
<span id="cb7-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  SELECT</span></span>
<span id="cb7-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  ROW_NUMBER() OVER(ORDER BY `list_1`) AS `index`,</span></span>
<span id="cb7-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  `list_1`</span></span>
<span id="cb7-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FROM</span></span>
<span id="cb7-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  `advent_data`</span></span>
<span id="cb7-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  ),</span></span>
<span id="cb7-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb7-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  indexed_list_2 AS (</span></span>
<span id="cb7-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  SELECT </span></span>
<span id="cb7-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  ROW_NUMBER() OVER(ORDER BY `list_2`) AS `index`,</span></span>
<span id="cb7-18"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  `list_2`</span></span>
<span id="cb7-19"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FROM `advent_data`</span></span>
<span id="cb7-20"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  ORDER BY list_1)</span></span>
<span id="cb7-21"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb7-22"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  SELECT</span></span>
<span id="cb7-23"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  SUM(ABS(`list_1` - `list_2`)) AS `distance`</span></span>
<span id="cb7-24"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  FROM</span></span>
<span id="cb7-25"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  indexed_list_1 LEFT JOIN indexed_list_2</span></span>
<span id="cb7-26"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  USING(`index`)</span></span>
<span id="cb7-27"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb7-28"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  "</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># Source:   SQL [1 x 1]
# Database: sqlite 3.46.0 [:memory:]
  distance
     &lt;dbl&gt;
1  2176849</code></pre>
</div>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {Advent of {Code} 2024 - {Day} 1},
  date = {2024-12-02},
  url = {https://visibledata.co.uk/posts/2024-12-01_advent-of-code-2024-01/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“Advent of Code 2024 - Day 1.”</span>
December 2, 2024. <a href="https://visibledata.co.uk/posts/2024-12-01_advent-of-code-2024-01/">https://visibledata.co.uk/posts/2024-12-01_advent-of-code-2024-01/</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2024-12-01_advent-of-code-2024-01/</guid>
  <pubDate>Mon, 02 Dec 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Capital Circles</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-11-30_capital-circles/</link>
  <description><![CDATA[ 





<p>I really enjoyed seeing other’s #30DayMapChallenge posts, and particularly those of Ansgar Wolsing. I spent a while thinking about this glorious post</p>
<iframe src="https://www.linkedin.com/embed/feed/update/urn:li:share:7264973254291869696" height="834" width="504" frameborder="0" allowfullscreen="" title="Embedded post">
</iframe>
<p>And had the idea of creating a map of circles centered around cities with the radius being the shortest distance to another city above a certain population threshold. So let’s throw something together.</p>
<p>First I’ll load my packages, and Ansgar introduced me to <code>{giscoR}</code> for obtaining shapefiles. Previously, I’ve used <code>{rnaturalearthdata}</code> but think I might change the default going forwards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"maps"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span>)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"giscoR"</span>)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"countrycode"</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7">countries_sf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gisco_get_countries</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>()</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Manually remove duplicate San Jose and Nicosia</span></span>
<span id="cb1-12">cities_clean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> world.cities <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># filter(capital == 1) %&gt;% </span></span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"San Jose"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> lat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.97</span>),</span>
<span id="cb1-16">         <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>(name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nicosia"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> long <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">33.37</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">iso_3c =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">countrycode</span>(country.etc, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"country.name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"iso3c"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"long"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>)</span></code></pre></div>
</div>
<p>Let’s only look at cities with a population of at least 1 million</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">cities_of_interest <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cities_clean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(pop <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000000</span>)</span></code></pre></div>
</div>
<p>Here’s a neat little function that finds the max and min distance to each row in the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">add_max_min_point_to_row <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data, row_n){</span>
<span id="cb3-2">  target_row <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(data, row_n)</span>
<span id="cb3-3">  </span>
<span id="cb3-4">  all_others <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(data), row_n))</span>
<span id="cb3-5">  </span>
<span id="cb3-6">  all_distances <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_distance</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sfc</span>(target_row), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sfc</span>(all_others))</span>
<span id="cb3-7">  </span>
<span id="cb3-8">  min_iso_3c <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(all_others, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.min</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(all_distances))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(iso_3c)</span>
<span id="cb3-10">  </span>
<span id="cb3-11">  max_iso_3c <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(all_others, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.max</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(all_distances))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(iso_3c)</span>
<span id="cb3-13">  </span>
<span id="cb3-14">  target_row <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min_iso_3c =</span> min_iso_3c,</span>
<span id="cb3-16">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min_distance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(all_distances),</span>
<span id="cb3-17">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_iso_3c =</span> max_iso_3c,</span>
<span id="cb3-18">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max_distance =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(all_distances))</span>
<span id="cb3-19">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">cities_of_interest_distances <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(cities_of_interest) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dfr</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_max_min_point_to_row</span>(cities_of_interest, .x))</span></code></pre></div>
</div>
<p>And map!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">gg_city_circles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> cities_of_interest_distances <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-3">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geometry =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_buffer</span>(geometry, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dist =</span> min_distance, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nQuadSegs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-4">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_wrap_dateline</span>() ,</span>
<span id="cb5-5">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#663399"</span>,</span>
<span id="cb5-6">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> countries_sf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-8">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>NAME_ENGL <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Antarctica"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-9">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">area =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_area</span>(geometry))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-10">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(area <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1E11</span>),</span>
<span id="cb5-11">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>,</span>
<span id="cb5-12">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> colorspace<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lighten</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">amount =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Closest cities with populations of least 1 million"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+proj=robin"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lightblue"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-17">  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb5-18"></span>
<span id="cb5-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gg_city_circles.png"</span>),</span>
<span id="cb5-20">       gg_city_circles,</span>
<span id="cb5-21">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,</span>
<span id="cb5-22">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.37</span>)</span></code></pre></div>
</div>
<p><img src="https://visibledata.co.uk/posts/2024-11-30_capital-circles/gg_city_circles.png" class="img-fluid"></p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {Capital {Circles}},
  date = {2024-11-30},
  url = {https://visibledata.co.uk/posts/2024-11-30_capital-circles/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“Capital Circles.”</span> November 30,
2024. <a href="https://visibledata.co.uk/posts/2024-11-30_capital-circles/">https://visibledata.co.uk/posts/2024-11-30_capital-circles/</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2024-11-30_capital-circles/</guid>
  <pubDate>Sat, 30 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Data Quest: Motorway Services UK</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/</link>
  <description><![CDATA[ 





<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="left quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>I’m working on a few ideas about Motorway Service Stations in the UK, or more specifically the mainland of Great Britain (England, Scotland and Wales). However, I was surprised to discover there weren’t any well structured datasets. There is an <strong>incredible</strong> <em>website</em> available at <a href="www.motorwayservices.info">www.motorwayservices.info</a> - I thoroughly recommend a visit.</p>
</div>
<div class="right quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/gg_services_roadless_simple.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>For very sensible reasons they don’t allow data to be scraped (we can’t use <code>{rvest}</code>), so I’ve manually downloaded all 107 web pages for the motorway service stations and have them in this folder:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cjhRutils"</span>)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"service-stations/"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".html"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Abington Services M74 - Motorway Services Information.html"          
[2] "Annandale Water Services A74(M) - Motorway Services Information.html"
[3] "Baldock Services A1(M) - Motorway Services Information.html"         
[4] "Beaconsfield Services M40 - Motorway Services Information.html"      
[5] "Birch Services M62 - Motorway Services Information.html"             
[6] "Birchanger Green Services M11 - Motorway Services Information.html"  </code></pre>
</div>
</div>
<p>Now we can use <code>{rvest}</code> to read these HTML files - let’s target the info I want</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rvest"</span>)</span>
<span id="cb3-3">example_abingdon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"service-stations/Abington Services M74 - Motorway Services Information.html"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_nodes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".infotext"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_text</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb3-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">info =</span> .</span>
<span id="cb3-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_wider_delim</span>(info, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"property"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_trim</span>(value))</span>
<span id="cb3-11"></span>
<span id="cb3-12">example_abingdon</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 2
   property                       value                                         
   &lt;chr&gt;                          &lt;chr&gt;                                         
 1 Motorway                       "M74"                                         
 2 Where                          "at J13"                                      
 3 County                         "South Lanarkshire"                           
 4 Postcode                       "ML12 6RG"                                    
 5 Type                           "Single site, used by traffic in both directi…
 6 Operator                       "Welcome Break"                               
 7 Contact Phone                  "01864 502637"                                
 8 Eat-In Food                    "Starbucks, Papa John's, Burger King, Dunkin'…
 9 Takeaway Food / General        "Retail Shop"                                 
10 Other Non-Food Shops           "WH Smith"                                    
11 Picnic Area                    "yes"                                         
12 Cash Machines in main building "Yes (transaction charge applies)"            
13 Parking Charges                "Cars free for the first 2 hours then £5 for …
14 Other Facilities/Information   "GameZone, Tourist Information, BT Openzone"  
15 Motel                          "Days Inn Hotel Abington (Glasgow)"           
16 Fuel Brand                     "Shell"                                       
17 LPG available                  "Yes"                                         
18 Cash Machines at fuel station  "Yes (transaction charge applies)"            </code></pre>
</div>
</div>
<p>Okay! That’s enough processing to a function I can use to read in all of the data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">read_motorway_services_info <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(file_path){</span>
<span id="cb5-2">  name_service_station <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">basename</span>(file_path), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - Motorway Services Information.html"</span>)</span>
<span id="cb5-3">  </span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(file_path) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_nodes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".infotext"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_text</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb5-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">info =</span> .</span>
<span id="cb5-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_wider_delim</span>(info, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"property"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">too_many =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"merge"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_trim</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">service_station =</span> name_service_station) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identity</span>()</span>
<span id="cb5-14">}</span>
<span id="cb5-15"></span>
<span id="cb5-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"service-stations/Baldock Services A1(M) - Motorway Services Information.html"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_motorway_services_info</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 3
   property                       value                          service_station
   &lt;chr&gt;                          &lt;chr&gt;                          &lt;chr&gt;          
 1 Motorway                       A1(M)                          Baldock Servic…
 2 Where                          at J10 and from A507           Baldock Servic…
 3 County                         Hertfordshire                  Baldock Servic…
 4 Postcode                       SG7 5TR                        Baldock Servic…
 5 Type                           Single site, used by traffic … Baldock Servic…
 6 Operator                       Extra MSA                      Baldock Servic…
 7 Contact Phone                  01494 678876                   Baldock Servic…
 8 Eat-In Food                    KFC, Le Petit Four, McDonalds… Baldock Servic…
 9 Takeaway Food / General        M&amp;S Simply Food, WH Smith (wi… Baldock Servic…
10 Picnic Area                    yes                            Baldock Servic…
11 Children's Playground          Yes                            Baldock Servic…
12 Cash Machines in main building Yes (transaction charge appli… Baldock Servic…
13 Parking Charges                First two hours free for all … Baldock Servic…
14 Other Facilities/Information   Fast Food &amp; Bakeries and Conv… Baldock Servic…
15 Motel                          Days Inn Stevenage North       Baldock Servic…
16 Fuel Brand                     Shell                          Baldock Servic…
17 LPG available                  Yes                            Baldock Servic…
18 Cash Machines at fuel station  Yes (free)                     Baldock Servic…
19 Other Facilities/Information   Costa Express &amp; Deli2Go avail… Baldock Servic…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">data_raw_services <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"service-stations/"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[.]html"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">full.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dfr</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_motorway_services_info</span>(.x))</span></code></pre></div>
</details>
</div>
<section id="northbound-southbound-and-eastbound-westbound" class="level2">
<h2 class="anchored" data-anchor-id="northbound-southbound-and-eastbound-westbound">Northbound / Southbound and Eastbound / Westbound</h2>
<p>Some service stations come in pairs (<em>dual-site service areas or twin sites</em>) that are split by the motorway and yet <strong>still have the same name</strong>. For instance, Rownhams Services has a McDonalds when accessed westbound but not eastbound. If you looked at a map of the services it appears that they’re not connected (that’s an overhead sign not a footbridge!).</p>
<p><img src="https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/rownsham-services.png" class="img-fluid"> But they are! There’s a subway connecting them, which is <a href="https://www.sabre-roads.org.uk/forum/viewtopic.php?t=44620">apparently difficult to discover</a>. Thankfully, our data source <a href="www.motorwayservices.info">www.motorwayservices.info</a> knows they’re connected but does suggest it’s a footbridge.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">data_raw_services <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(service_station <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rownhams Services M27"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(property <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(value)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Separate facilities for each carriageway, but linked by a pedestrian footbridge"</code></pre>
</div>
</div>
<p>We need a way to identify these stations. It turns out the “Eat-In Food” property is our friend and identifies the 6 twin-site stations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">vec_eat_in_pairs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_services <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(property <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eat-In Food"</span>,</span>
<span id="cb10-3">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Northbound|Eastbound"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(service_station)</span>
<span id="cb10-5">vec_eat_in_pairs</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Northampton Services M1" "Rownhams Services M27"  
[3] "Sandbach Services M6"    "Strensham Services M5"  
[5] "Tibshelf Services M1"    "Watford Gap Services M1"</code></pre>
</div>
</div>
</section>
<section id="where-can-we-eat" class="level2">
<h2 class="anchored" data-anchor-id="where-can-we-eat">Where can we eat</h2>
<p>The Eat-In variable is the most complicated, interesting and ripe for visualisation. So let’s treat it separately. First we’ll identify our twin-site restaurants:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">data_raw_eat_in <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_services <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(property <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eat-In Food"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">directional =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(value,</span>
<span id="cb12-4">                                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Northbound|Eastbound"</span>))</span>
<span id="cb12-5"></span>
<span id="cb12-6">data_raw_directional_eat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_eat_in <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(directional <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb12-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Northbound"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Northbound|Southbound"</span>,</span>
<span id="cb12-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eastbound"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eastbound|Westbound"</span></span>
<span id="cb12-11">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_longer_delim</span>(direction,</span>
<span id="cb12-13">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb12-15">    direction <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Northbound"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(value,</span>
<span id="cb12-16">                                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=Northbound: ).*(?=Southbound)"</span>),</span>
<span id="cb12-17">    direction <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Southbound"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=Southbound).*"</span>),</span>
<span id="cb12-18">    direction <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eastbound"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(value,</span>
<span id="cb12-19">                                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=Eastbound: ).*(?=Westbound)"</span>),</span>
<span id="cb12-20">    direction <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Westbound"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(value,</span>
<span id="cb12-21">                                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?&lt;=Westbound: ).*"</span>)</span>
<span id="cb12-22">  )) </span>
<span id="cb12-23"></span>
<span id="cb12-24">data_raw_directional_eat</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 5
   property    value                       service_station directional direction
   &lt;chr&gt;       &lt;chr&gt;                       &lt;chr&gt;           &lt;lgl&gt;       &lt;chr&gt;    
 1 Eat-In Food "Costa, Restbite, The Burg… Northampton Se… TRUE        Northbou…
 2 Eat-In Food " Costa, Hot Food Co., McD… Northampton Se… TRUE        Southbou…
 3 Eat-In Food "Costa, Restbite. "         Rownhams Servi… TRUE        Eastbound
 4 Eat-In Food "Costa, Restbite, McDonald… Rownhams Servi… TRUE        Westbound
 5 Eat-In Food "Costa and Restbite, "      Sandbach Servi… TRUE        Northbou…
 6 Eat-In Food ": Costa, McDonald's, Hot … Sandbach Servi… TRUE        Southbou…
 7 Eat-In Food "Soho Coffee Company, Hot … Strensham Serv… TRUE        Northbou…
 8 Eat-In Food ": Costa, Hot Food Co., Mc… Strensham Serv… TRUE        Southbou…
 9 Eat-In Food "Costa, Restbite, McDonald… Tibshelf Servi… TRUE        Northbou…
10 Eat-In Food ": Costa, Restbite, McDona… Tibshelf Servi… TRUE        Southbou…
11 Eat-In Food "Costa, Fresh Food Cafe, M… Watford Gap Se… TRUE        Northbou…
12 Eat-In Food ": Costa, Restbite, The Bu… Watford Gap Se… TRUE        Southbou…</code></pre>
</div>
</div>
<p>Frustratingly, Strensham Services has an extra little bit of data about Subway being in the Northbound Forecourt. That’ll need manual removal. But other than that I think we end up with fairly well structured data for the eat-in component that we can begin to clean up.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">data_raw_directional_eat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_directional_eat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>),</span>
<span id="cb14-3">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" Northbound.*"</span>),</span>
<span id="cb14-4">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_trim</span>(value))</span>
<span id="cb14-5"></span>
<span id="cb14-6">data_raw_directionless_eat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_eat_in <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(directional <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":|;"</span>),</span>
<span id="cb14-9">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(Westbound)"</span>),</span>
<span id="cb14-10">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_trim</span>(value),</span>
<span id="cb14-11">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Directionless"</span>)</span>
<span id="cb14-12"></span>
<span id="cb14-13">data_clean_eat_in <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_directionless_eat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(data_raw_directional_eat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb14-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>directional)</span></code></pre></div>
</details>
</div>
<p>There are lots of alternative spellings in the data, here’s a case_when to grab them all. At some point in the future it would be interesting to see if edit distances could help, but for now let’s concentrate on getting a useful dataset.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">fn_fix_value_columns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data){</span>
<span id="cb15-2">  data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb15-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"arlo"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arlo's"</span>, </span>
<span id="cb15-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^bk$"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Burger King"</span>,</span>
<span id="cb15-6">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cotton"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cotton Traders"</span>, </span>
<span id="cb15-7">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chozen"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chozen Noodles"</span>, </span>
<span id="cb15-8">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cornwall"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"West Cornwall Pasty Company"</span>, </span>
<span id="cb15-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"costa"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Costa"</span>, </span>
<span id="cb15-10">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"eat &amp; drink co"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eat &amp; Drink Co"</span>, </span>
<span id="cb15-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"edc"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eat &amp; Drink Co"</span>, </span>
<span id="cb15-12">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fone"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FoneBiz"</span>, </span>
<span id="cb15-13">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"full house"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Full House"</span>, </span>
<span id="cb15-14">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"greg"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Greggs"</span>, </span>
<span id="cb15-15">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"harry"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Harry Ramsden's"</span>, </span>
<span id="cb15-16">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hot food co"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hot Food Co"</span>,</span>
<span id="cb15-17">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"krispy"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Krispy Kreme"</span>, </span>
<span id="cb15-18">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"le petit"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Le Petit Four"</span>, </span>
<span id="cb15-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lucky coin"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lucky Coin"</span>, </span>
<span id="cb15-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"m&amp;s"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M&amp;S"</span>, </span>
<span id="cb15-21">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"marks"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M&amp;S"</span>, </span>
<span id="cb15-22">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mcdona"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"McDonald's"</span>, </span>
<span id="cb15-23">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"papa john"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Papa John's"</span>, </span>
<span id="cb15-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pizza hut"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pizza Hut"</span>, </span>
<span id="cb15-25">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quicksilver"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quicksilver"</span>, </span>
<span id="cb15-26">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"regus"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Regus Business Lounge"</span>, </span>
<span id="cb15-27">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"restbite"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Restbite"</span>, </span>
<span id="cb15-28">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"soho"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SOHO Coffee Co"</span>, </span>
<span id="cb15-29">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spar"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SPAR"</span>, </span>
<span id="cb15-30">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"starbucks"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Starbucks"</span>, </span>
<span id="cb15-31">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"the burger"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The Burger Company"</span>, </span>
<span id="cb15-32">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top gift"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Top Gift"</span>, </span>
<span id="cb15-33">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tourist information"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tourist Information"</span>, </span>
<span id="cb15-34">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Upper Crust"</span>, </span>
<span id="cb15-35">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"whs"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WHSmiths"</span>, </span>
<span id="cb15-36">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wild"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Wild Bean Cafe"</span>, </span>
<span id="cb15-37">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WH Smith"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WHSMiths"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Whsmith"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W H Smiths"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W.H.Smiths"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W H Smith"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WH Smiths"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Wh Smith"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WH smith"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WHSmiths"</span>, </span>
<span id="cb15-38">      value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Buger King"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Burger King"</span>, </span>
<span id="cb15-39">      value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M &amp; S Simply food"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M&amp;S"</span>,</span>
<span id="cb15-40">      <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> value</span>
<span id="cb15-41">    ))</span>
<span id="cb15-42">}</span>
<span id="cb15-43"></span>
<span id="cb15-44">data_long_eat_in <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_clean_eat_in <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_longer_delim</span>(value,</span>
<span id="cb15-46">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_trim</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-49">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fn_fix_value_columns</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">retailer =</span> value,</span>
<span id="cb15-51">          service_station,</span>
<span id="cb15-52">         direction)</span></code></pre></div>
</details>
</div>
<p>Now… I’m a little unsure about what to do with the “Takeaway Food / General” property as it also contains information about where we can get food but for the 6 twin stations the direction isn’t provided. Let’s deal with the directionless other retailers now:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">data_long_other_shops_directionless <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_services <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>service_station <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> vec_eat_in_pairs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(property <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Takeaway Food / General"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Other Non-Food Shops"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(value, service_station) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"01823680370"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_longer_delim</span>(value,</span>
<span id="cb16-7">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_trim</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">side =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"both"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fn_fix_value_columns</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[(].*y[)]"</span>),</span>
<span id="cb16-11">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_trim</span>(value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb16-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reframe</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">retailer =</span> value,</span>
<span id="cb16-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">service_station =</span> service_station,</span>
<span id="cb16-14">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Directionless"</span>)</span>
<span id="cb16-15"></span>
<span id="cb16-16"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## There's one bad record</span></span>
<span id="cb16-17">data_long_other_shops_directionless <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb16-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">retailer =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamezone"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WHSmiths"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Waitrose"</span>),</span>
<span id="cb16-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">service_station =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Newport Pagnell Services M1"</span>,</span>
<span id="cb16-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Directionless"</span></span>
<span id="cb16-21">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb16-23">    data_long_other_shops_directionless,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(retailer, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"24hr Gamezone WHSmith &amp; Waitrose"</span>)</span>
<span id="cb16-24">  ))</span></code></pre></div>
</details>
</div>
<p>And now I’ll expand out the twin stations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Expand out the twins</span></span>
<span id="cb17-2">data_long_other_shops_w_direction <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_services <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(service_station <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> vec_eat_in_pairs) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(property <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Other Non-Food Shops"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Takeaway Food / General"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(value, service_station) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb17-7">    service_station <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rownhams Services M27"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Eastbound;Westbound"</span>,</span>
<span id="cb17-8">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Northbound;Southbound"</span></span>
<span id="cb17-9">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_longer_delim</span>(direction,</span>
<span id="cb17-11">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fn_fix_value_columns</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb17-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">retailer =</span> value)</span></code></pre></div>
</details>
</div>
<p>It’s time to combine everything together into a list of retailers which I’ll export into Excel and quickly categorise.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">data_long_retailers <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(data_long_eat_in, data_long_other_shops_w_direction, data_long_other_shops_directionless)</span>
<span id="cb18-2"></span>
<span id="cb18-3">data_long_retailers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(retailer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(retailer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb18-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_csv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retailer_types.csv"</span>))</span></code></pre></div>
</details>
</div>
<p>Let’s impose these categorisations:</p>
<ul>
<li>is_food_retailer:
<ul>
<li>Do we KNOW we it sells some food items?</li>
</ul></li>
<li>is_retaurant:
<ul>
<li>Do we KNOW we can order food to eat in?</li>
</ul></li>
<li>is_takeaway:
<ul>
<li>Do we KNOW we can order food to takeaway</li>
</ul></li>
<li>is_prepared_food_only
<ul>
<li>Do we KNOW that there is no hot/fresh food, Tesco</li>
</ul></li>
<li>is_coffee_shop
<ul>
<li>Do we KNOW you’d nip there for a coffee and it’ll be good? Controversially, McDonald’s isn’t included.</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"readxl"</span>)</span>
<span id="cb19-2">data_type_of_retailer <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"retailer_types.xlsx"</span>))</span>
<span id="cb19-3"></span>
<span id="cb19-4">data_services_retailers <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_long_retailers <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(data_type_of_retailer) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb19-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is"</span>), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb19-7">    .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb19-8">    .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb19-9">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb19-10">    )))</span>
<span id="cb19-11"></span>
<span id="cb19-12">data_services_retailers</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 650 × 8
   retailer service_station direction is_food_retailer is_restaurant is_takeaway
   &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;     &lt;lgl&gt;            &lt;lgl&gt;         &lt;lgl&gt;      
 1 Starbuc… Abington Servi… Directio… TRUE             NA            TRUE       
 2 Papa Jo… Abington Servi… Directio… TRUE             TRUE          TRUE       
 3 Burger … Abington Servi… Directio… TRUE             TRUE          TRUE       
 4 Dunkin'… Abington Servi… Directio… TRUE             FALSE         TRUE       
 5 Harry R… Abington Servi… Directio… TRUE             TRUE          TRUE       
 6 Costa    Annandale Wate… Directio… TRUE             FALSE         TRUE       
 7 Restbite Annandale Wate… Directio… TRUE             NA            NA         
 8 The Bur… Annandale Wate… Directio… TRUE             TRUE          TRUE       
 9 KFC      Baldock Servic… Directio… TRUE             TRUE          TRUE       
10 Le Peti… Baldock Servic… Directio… TRUE             FALSE         TRUE       
# ℹ 640 more rows
# ℹ 2 more variables: is_prepared_food_only &lt;lgl&gt;, is_coffee_shop &lt;lgl&gt;</code></pre>
</div>
</div>
</section>
<section id="non-food-information" class="level2">
<h2 class="anchored" data-anchor-id="non-food-information">Non-food information</h2>
<p>The non-food information is so much easier to deal with. Because I want to create an <code>{sf}</code> object and potentially support exporting as ESRI shapefiles let’s make sure our colnanes have a maximum of 10 characters.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">data_wide_services <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_services <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(property <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Motorway"</span>,</span>
<span id="cb21-3">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Where"</span>,</span>
<span id="cb21-4">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Postcode"</span>,</span>
<span id="cb21-5">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb21-6">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Operator"</span>,</span>
<span id="cb21-7">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Parking Charges"</span>,</span>
<span id="cb21-8">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LPG available"</span>,</span>
<span id="cb21-9">                         <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Electric Charge Point"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">property =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb21-11">    property <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LPG available"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"has_lpg"</span>,</span>
<span id="cb21-12">    property <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Electric Charge Point"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"has_electric_charge"</span>,</span>
<span id="cb21-13">    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> property</span>
<span id="cb21-14">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ï��[0-9]{1,}"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"£"</span>),</span>
<span id="cb21-16">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove_all</span>(value, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Â"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> property,</span>
<span id="cb21-18">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-19">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_single_site =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(type, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Single site"</span>),</span>
<span id="cb21-21">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_twin_station =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(type, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Separate facilities"</span>),</span>
<span id="cb21-22">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">has_walkway_between_twins =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb21-23">           is_twin_station <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(type, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linked"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb21-24">           is_twin_station <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(type, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"no link"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb21-25">           <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb21-26">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_ireland =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(service_station, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ireland"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb21-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reframe</span>(</span>
<span id="cb21-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> service_station,</span>
<span id="cb21-29">    motorway,</span>
<span id="cb21-30">    where,</span>
<span id="cb21-31">    postcode,</span>
<span id="cb21-32">    type,</span>
<span id="cb21-33">    operator,</span>
<span id="cb21-34">    is_ireland,</span>
<span id="cb21-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_charges =</span> parking_charges,</span>
<span id="cb21-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">has_charge =</span> has_electric_charge,</span>
<span id="cb21-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_single =</span> is_single_site,</span>
<span id="cb21-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_twin =</span> is_twin_station,</span>
<span id="cb21-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">has_walk =</span> has_walkway_between_twins</span>
<span id="cb21-40">  )</span></code></pre></div>
</details>
</div>
<p>There are some services like Gloucester Services M5 that appear as two distinct rows but they still pass <code>is_single == FALSE</code>. Let’s identify these services and mark them in the dataset as <code>pair_name</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">data_paired_services <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_wide_services <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(is_single <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"North|South|East|West"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_wider_delim</span>(name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Services"</span>,</span>
<span id="cb22-6">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direction"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>(), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_trim</span>(.))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_wider_delim</span>(direction,</span>
<span id="cb22-9">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>,</span>
<span id="cb22-10">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"direction"</span>,</span>
<span id="cb22-11">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"motorway"</span>),</span>
<span id="cb22-12">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">too_few =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"align_end"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_count</span>(name, motorway) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reframe</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Services"</span>, direction, motorway),</span>
<span id="cb22-16">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pair_name =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(name, motorway))</span>
<span id="cb22-17"></span>
<span id="cb22-18"></span>
<span id="cb22-19">data_services_info <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_wide_services <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(data_paired_services) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb22-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_pair =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(pair_name), <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb22-22"></span>
<span id="cb22-23">data_services_info</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 106 × 14
   name   motorway where postcode type  operator is_ireland p_charges has_charge
   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;lgl&gt;      &lt;chr&gt;     &lt;chr&gt;     
 1 Abing… M74      at J… ML12 6RG Sing… Welcome… FALSE      "Cars fr… &lt;NA&gt;      
 2 Annan… A74(M)   at J… DG11 1HD Sing… RoadChef FALSE      "Parking… Yes (More…
 3 Baldo… A1(M)    at J… SG7 5TR  Sing… Extra M… FALSE      "First t… &lt;NA&gt;      
 4 Beaco… M40      at J… HP9 2SE  Sing… Extra M… FALSE       &lt;NA&gt;     &lt;NA&gt;      
 5 Birch… M62      betw… OL10 2HQ Sepa… Moto     FALSE      "Car - £… &lt;NA&gt;      
 6 Birch… M11      at J… CM23 5QZ Sing… Welcome… FALSE      "Parking… &lt;NA&gt;      
 7 Black… M65      at J… BB3 0AT  Sing… Extra M… FALSE      "Parking… &lt;NA&gt;      
 8 Blyth… A1(M)    at J… S81 8HG  Sing… Moto     FALSE      "Free fo… Yes (More…
 9 Bothw… M74      betw… G71 8BG  Faci… RoadChef FALSE      "Parking… Yes (More…
10 Bridg… M5       at J… TA6 6TS  Sing… Moto     FALSE      "Cars - … &lt;NA&gt;      
# ℹ 96 more rows
# ℹ 5 more variables: is_single &lt;lgl&gt;, is_twin &lt;lgl&gt;, has_walk &lt;lgl&gt;,
#   pair_name &lt;chr&gt;, is_pair &lt;lgl&gt;</code></pre>
</div>
</div>
</section>
<section id="getting-the-locations-of-the-services" class="level2">
<h2 class="anchored" data-anchor-id="getting-the-locations-of-the-services">Getting the locations of the services…</h2>
<p>I’ve gone and got the coords from Google Maps and stored them in an Excel file (because I’m not perfect). Here’s a very quick interactive <code>{leaflet}</code> map showing where they are:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span>)</span>
<span id="cb24-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"leaflet"</span>)</span>
<span id="cb24-3">data_raw_service_locations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"services-locations.xlsx"</span>))</span>
<span id="cb24-4"></span>
<span id="cb24-5">data_clean_long_lat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_raw_service_locations <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate_wider_delim</span>(google_pin,</span>
<span id="cb24-7">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, </span>
<span id="cb24-8">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"long"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">long =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(long),</span>
<span id="cb24-10">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lat =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(lat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(name, long, lat)</span>
<span id="cb24-12"></span>
<span id="cb24-13"></span>
<span id="cb24-14">data_sf_service_locs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_clean_long_lat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">full_join</span>(data_services_info) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"long"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span>),</span>
<span id="cb24-17">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>)</span>
<span id="cb24-18">  </span>
<span id="cb24-19">data_sf_service_locs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(is_ireland <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">leaflet</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addProviderTiles</span>(providers<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>OpenStreetMap) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb24-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">addCircleMarkers</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-6c896a48ba8bb82e758c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6c896a48ba8bb82e758c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[55.5074835,55.2198924,52.014611,51.5879345,53.5678243,51.8719626,53.7132113,53.3874722,55.8134195,51.1047788,54.1790888,53.4179418,52.2698506,51.5389948,51.5086283,53.630861,51.950015,53.2682334,51.4490357,51.2723919,51.3042205,52.4717224,50.8632186,52.8679425,52.8679425,53.5922164,52.8216948,54.728792,50.7166648,53.697522,51.2955966,52.4290205,51.8192639,51.8182682,51.4775676,52.9480418,55.0079577,55.7871368,55.5829964,53.7131327,55.863811,51.4884861,52.6431567,52.3635603,54.4385194,52.9939241,54.3141921,56.2097442,53.3007134,53.9617929,52.696453,52.6193447,51.5097528,51.6311605,53.3588856,51.5883225,51.2671058,51.3415404,51.4824011,51.65677,52.0833896,52.2092968,52.6649138,51.7381619,51.0833157,52.5315878,51.7469245,51.4250061,53.6004693,50.9574755,53.1394497,51.5349379,54.4433037,51.2699864,51.2699864,51.6034985,51.6874524,54.7985568,52.8861198,52.8730257,56.0760998,51.0949477,52.0613874,51.512645,52.607525,50.9766283,54.4511621,54.4511621,52.6772126,51.4923655,53.1378409,50.9167416,51.947106,54.8748213,52.9614206,52.2164894,52.2178318,54.8895435,52.3055489,53.9469521,51.1178861,53.3153382,53.6219498],[-3.6984713,-3.4128154,-0.2051029,-0.6301183,-2.2341856,0.1917148,-2.479898,-1.0635325,-4.0649819,-2.9985461,-2.7362851,-2.6384365,-0.0115099,-3.1321032,-3.3096233,-2.6918882,-1.201172,-2.8050832,-1.3135076,0.0381587,-0.4082989,-1.5478013,-3.3869863,-1.3702639,-1.3702639,-0.9948338,-1.3106673,-1.5253505,-3.4661263,-1.2693176,-0.8586517,-2.0205212,-2.2272466,-2.2248559,-2.7101807,-0.6810522,-3.085129,-4.037042,-3.8247528,-1.7490003,-3.7608489,-0.3947451,-2.0590448,-1.9485568,-2.5967487,-2.293177,-2.6376176,-3.4421378,-2.4041875,-2.7629336,-1.2975539,-1.207531,-2.1620076,-0.2665066,-2.5076485,-2.8389324,0.6114595,0.6055594,-1.5596909,-2.4297848,-0.750573,-0.9459884,-1.9698975,-1.0992414,-0.2025141,-0.323001,-4.0682952,-1.0358717,-2.5755411,-1.4510085,-2.3391362,-3.5790382,-1.6694666,-2.9258045,-2.9258045,-2.6231769,-0.2242572,-2.8735537,-2.1761901,-2.1638335,-3.924159,1.0415873,-2.1543635,-2.1462654,-1.6434032,-3.1500562,-2.6101655,-2.6101655,-2.4037876,0.2695656,-1.3334762,-3.3574801,-0.5057912,-3.0081874,-1.2709822,-1.5080404,-1.5052217,-1.5615357,-1.1247226,-1.3713072,-1.2573425,-1.2856237,-1.5492314],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[50.7166648,56.2097442],"lng":[-4.0682952,1.0415873]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="operators" class="level2">
<h2 class="anchored" data-anchor-id="operators">Operators</h2>
<p>I want to make sure we’re not over counting operators due to pair sites! So let’s make some explicit counts.</p>
<ul>
<li><p>n_named_sites_all: How many uniquely named sites are there across Great Britian? <code>Gloucester Northbound Services M5</code> and <code>Gloucester Southbound Services M5</code> are distinctly named, but the <code>Birch Services M62</code> is listed once despite being a twinned site.</p></li>
<li><p>n_named_sites_mainland: same as above but discounting services in Ireland</p></li>
<li><p>n_named_sites_ireland: only counts uniquely named services in Ireland</p></li>
<li><p>n_single_sites: How many sites are accessible by traffic in both directions</p></li>
<li><p>n_twins: How many sites are twinned, two locations on each side of the motorway with or without a walkway between them</p></li>
<li><p>n_pairs: How many sites have paired names, eg <code>Gloucester Northbound Services M5</code> and <code>Gloucester Southbound Services M5</code></p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">data_process_ops_single <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_services_info <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(name, operator, is_single) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(operator, is_single) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(is_single <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reframe</span>(operator,</span>
<span id="cb25-6">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_single_sites =</span> n)</span>
<span id="cb25-7"></span>
<span id="cb25-8">data_process_ops_twins <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_services_info <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(operator, is_twin) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(is_twin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reframe</span>(operator,</span>
<span id="cb25-12">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_twins =</span> n)</span>
<span id="cb25-13"></span>
<span id="cb25-14">data_process_ops_pair <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_services_info <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(name, operator, is_pair) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(operator, is_pair) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(is_pair <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reframe</span>(operator,</span>
<span id="cb25-19">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_pairs =</span> n)</span>
<span id="cb25-20"></span>
<span id="cb25-21">data_process_ops_simple_all <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_services_info <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(operator, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_named_sites_all"</span>) </span>
<span id="cb25-23"></span>
<span id="cb25-24">data_process_ops_simple_ireland <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_services_info <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ireland"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(operator, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_named_sites_ireland"</span>) </span>
<span id="cb25-27"></span>
<span id="cb25-28"></span>
<span id="cb25-29">data_operators <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_process_ops_simple_all <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(data_process_ops_simple_ireland) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(data_process_ops_single) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(data_process_ops_twins) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(data_process_ops_pair) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>(), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replace_na</span>(.x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_named_sites_mainland =</span> n_named_sites_all <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> n_named_sites_ireland) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb25-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb25-37">    operator,</span>
<span id="cb25-38">    n_named_sites_all,</span>
<span id="cb25-39">         n_named_sites_mainland,</span>
<span id="cb25-40">         n_named_sites_ireland,</span>
<span id="cb25-41">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>())</span>
<span id="cb25-42"></span>
<span id="cb25-43">data_operators</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 7
  operator      n_named_sites_all n_named_sites_mainland n_named_sites_ireland
  &lt;chr&gt;                     &lt;int&gt;                  &lt;int&gt;                 &lt;int&gt;
1 Applegreen                    3                      0                     3
2 BP Connect                    1                      1                     0
3 Euro Garages                  2                      2                     0
4 Extra MSA                     7                      7                     0
5 Moto                         39                     39                     0
6 RoadChef                     20                     20                     0
7 Stop 24                       1                      1                     0
8 Welcome Break                27                     27                     0
9 Westmorland                   6                      6                     0
# ℹ 3 more variables: n_single_sites &lt;int&gt;, n_twins &lt;int&gt;, n_pairs &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="exporting-all-that-good-data" class="level2">
<h2 class="anchored" data-anchor-id="exporting-all-that-good-data">Exporting all that good data</h2>
<p>I’d really love this dataset to become a Tidy Tuesday dataset! So while writing this post <a href="https://github.com/charliejhadley/tidytuesday/tree/Motorway-Services-UK/data/curated/motorway-services-uk">I’ve created a fork of the repo</a>. If my eventual pull request gets accepted we’d be able to pull the data from the official TidyTuesday repo, but until then it’s available as follows</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/charliejhadley/tidytuesday/refs/heads/Motorway-Services-UK/data/curated/motorway-services-uk/data_service_locations.csv"</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 15
  name    long   lat motorway where postcode type  operator p_charges has_charge
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;     
1 Abin… -3.70   55.5 M74      at J… ML12 6RG Sing… Welcome… "Cars fr… &lt;NA&gt;      
2 Anna… -3.41   55.2 A74(M)   at J… DG11 1HD Sing… RoadChef "Parking… Yes (More…
3 Bald… -0.205  52.0 A1(M)    at J… SG7 5TR  Sing… Extra M… "First t… &lt;NA&gt;      
4 Beac… -0.630  51.6 M40      at J… HP9 2SE  Sing… Extra M…  &lt;NA&gt;     &lt;NA&gt;      
5 Birc… -2.23   53.6 M62      betw… OL10 2HQ Sepa… Moto     "Car - £… &lt;NA&gt;      
6 Birc…  0.192  51.9 M11      at J… CM23 5QZ Sing… Welcome… "Parking… &lt;NA&gt;      
# ℹ 5 more variables: is_single &lt;lgl&gt;, is_twin &lt;lgl&gt;, has_walk &lt;lgl&gt;,
#   pair_name &lt;chr&gt;, is_pair &lt;lgl&gt;</code></pre>
</div>
</div>
</section>
<section id="lets-make-a-map" class="level2">
<h2 class="anchored" data-anchor-id="lets-make-a-map">Let’s make a map</h2>
<p>I’ve obtained some <a href="https://geoportal.statistics.gov.uk/datasets/ons::countries-december-2023-boundaries-uk-bfc-2/about">high quality shapefiles for the UK from the ONS</a> which I’m going to immediately start throwing information away from.</p>
<ul>
<li><p>There aren’t any true service stations in Northern Ireland, so we’ll include only England, Scotland and Wales</p></li>
<li><p>There are only service stations on the mainland! So let’s discount any polygon with an area smaller than 1E10m^2</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">data_sf_uk <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Countries_December_2023_Boundaries_UK_BFC_-5189344684762562119/"</span>))</span>
<span id="cb29-2"></span>
<span id="cb29-3">data_sf_gb_mainland <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_sf_uk <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb29-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(CTRY23NM <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Northern Ireland"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb29-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_cast</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"POLYGON"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb29-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">area =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_area</span>(geometry))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb29-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(area <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1E10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># st_union() %&gt;%</span></span>
<span id="cb29-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>()</span>
<span id="cb29-10"></span>
<span id="cb29-11">data_sf_gb_mainland</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3 features and 9 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 134112.4 ymin: 11429.67 xmax: 655653.8 ymax: 976859.9
Projected CRS: OSGB36 / British National Grid
# A tibble: 3 × 10
  CTRY23CD  CTRY23NM CTRY23NMW  BNG_E  BNG_N  LONG   LAT GlobalID               
* &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                  
1 E92000001 England  Lloegr    394883 370883 -2.08  53.2 ea73ad5d-1f4e-4f07-8e0…
2 S92000003 Scotland Yr Alban  277744 700060 -3.97  56.2 f2267107-2e4a-442e-bc8…
3 W92000004 Wales    Cymru     263405 242881 -3.99  52.1 d818bd0d-8e08-446f-889…
# ℹ 2 more variables: geometry &lt;POLYGON [m]&gt;, area &lt;dbl&gt;</code></pre>
</div>
</div>
<p>It takes a fair amount of time to plot, so I can use `{rmapshaper} to simplify the borders, which look okay:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rmapshaper"</span>)</span>
<span id="cb31-2"></span>
<span id="cb31-3">data_sf_simpler_mainland <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ms_simplify</span>(data_sf_gb_mainland, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">keep =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0005</span>)</span>
<span id="cb31-4"></span>
<span id="cb31-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_sf_simpler_mainland) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(data_sf_service_locs, is_ireland <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span> )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>,</span>
<span id="cb31-9">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s build towards an okay looking chart:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"patchwork"</span>)</span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggtext"</span>)</span>
<span id="cb32-3"></span>
<span id="cb32-4">data_plot_services <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_sf_service_locs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb32-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(is_ireland <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb32-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(data_operators, operator, n_named_sites_all)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb32-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">operator =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(operator, n_named_sites_all))</span>
<span id="cb32-8"></span>
<span id="cb32-9">colour_motorway_blue <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3070B5"</span></span>
<span id="cb32-10"></span>
<span id="cb32-11">gg_services_roadless <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(data_sf_simpler_mainland, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>),</span>
<span id="cb32-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> colour_motorway_blue,</span>
<span id="cb32-14">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span id="cb32-15">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(data_plot_services, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>),</span>
<span id="cb32-17">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> operator),</span>
<span id="cb32-18">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb32-19">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>,</span>
<span id="cb32-20">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,</span>
<span id="cb32-22">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>,</span>
<span id="cb32-23">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiredness can kill&lt;br&gt;Take a break"</span>),</span>
<span id="cb32-24">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transport"</span>,,</span>
<span id="cb32-25">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>,</span>
<span id="cb32-26">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb32-27">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span></span>
<span id="cb32-28">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dark2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(</span>
<span id="cb32-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># override.aes = list(size = 8), </span></span>
<span id="cb32-32">                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb32-33">         ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_number</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">accuracy =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_number</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">accuracy =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>,</span>
<span id="cb32-37">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>),</span>
<span id="cb32-38">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.76</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb32-39">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># theme_classic(base_family = "Transport") +</span></span>
<span id="cb32-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transport"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>),</span>
<span id="cb32-42">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend.spacing.y = unit(2.0, "cm"),</span></span>
<span id="cb32-43">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> colour_motorway_blue, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb32-44">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> colour_motorway_blue),</span>
<span id="cb32-45">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb32-46">  )</span>
<span id="cb32-47"></span>
<span id="cb32-48">gg_services_roadless</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="making-it-look-like-a-motorway-sign" class="level3">
<h3 class="anchored" data-anchor-id="making-it-look-like-a-motorway-sign">Making it look like a motorway sign</h3>
<p>There is a simply beautiful <a href="https://assets.publishing.service.gov.uk/media/5c78f8c7e5274a0ebfec719c/traffic-signs-manual-chapter-07.pdf">design guide for UK traffic signs</a> that goes into <strong>all</strong> of the detail, for instance:</p>
<p><img src="https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/motorway-sign-design.png" class="img-fluid"></p>
<p>At some point it could be fun to take all of this and convert it into a <code>{ggplot2}</code> theme - but that’s a lot of work. I want to focus on getting that nice round white border on my chart. That’s more difficult than I originally thought, there are two pathways:</p>
<ul>
<li><p>Fiddle around with grobs thanks to <a href="https://stackoverflow.com/a/48220347/1659890">Claus Wilke’s great StackOverflow Answer</a> on adding round corners to the panel border.</p></li>
<li><p>Shove a rounded rectangle onto the chart through the <code>geom_rrect()</code> function from <code>{ggchicklet}</code>… which is much easier:</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggchicklet"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remotes::install_github("hrbrmstr/ggchicklet")</span></span>
<span id="cb33-2">gg_services_roadless <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_rrect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.76</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>),</span>
<span id="cb33-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>,</span>
<span id="cb33-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span id="cb33-6">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'npc'</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s rebuild the chart and set the sizing to work well on export :)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">lims_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">12.9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.86</span>)</span>
<span id="cb34-2">lims_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">50.2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">max =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">58.5</span>)</span>
<span id="cb34-3"></span>
<span id="cb34-4">gg_services_roadless <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_rrect</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin =</span> lims_x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>min <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, </span>
<span id="cb34-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax =</span> lims_x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>max <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, </span>
<span id="cb34-7">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> lims_y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>min <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span>, </span>
<span id="cb34-8">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> lims_y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>max <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65</span>),</span>
<span id="cb34-9">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> colour_motorway_blue,</span>
<span id="cb34-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span id="cb34-11">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,</span>
<span id="cb34-12">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'npc'</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(data_sf_simpler_mainland, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>),</span>
<span id="cb34-14">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> colour_motorway_blue,</span>
<span id="cb34-15">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span id="cb34-16">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(data_plot_services, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>),</span>
<span id="cb34-18">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> operator),</span>
<span id="cb34-19">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb34-20">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>,</span>
<span id="cb34-21">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.5</span>,</span>
<span id="cb34-23">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">53.7</span>,</span>
<span id="cb34-24">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Tiredness can kill&lt;br&gt;Take a break"</span>), </span>
<span id="cb34-25">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span id="cb34-26">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transport"</span>,,</span>
<span id="cb34-27">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>,</span>
<span id="cb34-28">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb34-29">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span></span>
<span id="cb34-30">                ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_brewer</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dark2"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_number</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">accuracy =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_number</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">accuracy =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>,</span>
<span id="cb34-36">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(lims_y),</span>
<span id="cb34-37">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(lims_x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb34-38">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># theme_classic(base_family = "Transport") +</span></span>
<span id="cb34-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Transport"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb34-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>),</span>
<span id="cb34-41">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb34-42">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.spacing.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb34-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.7</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb34-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb34-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey90"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb34-46">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb34-47">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb34-48">    )</span>
<span id="cb34-49"></span>
<span id="cb34-50">gg_services_roadless</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/index_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gg_services_roadless_simple.png"</span>),</span>
<span id="cb35-2">       gg_services_roadless,</span>
<span id="cb35-3">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.2</span>,</span>
<span id="cb35-4">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.5</span>,</span>
<span id="cb35-5">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey90"</span>)</span></code></pre></div>
</details>
</div>
<p><img src="https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/gg_services_roadless_simple.png" class="img-fluid"></p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {Data {Quest:} {Motorway} {Services} {UK}},
  date = {2024-11-22},
  url = {https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“Data Quest: Motorway Services UK.”</span>
November 22, 2024. <a href="https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/">https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2024-11-13_motorway-service-stations-info/</guid>
  <pubDate>Fri, 22 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Pros, Cons and Neutrals lists?</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-11-08_positives-and-negatives-lists/</link>
  <description><![CDATA[ 





<p>I thought it would be interesting for me to keep better track of the Pros, Cons and Neutrals that I discover/decide on and to find a way to visualise these nicely. The idea came to me when I was wanting to create a new Quarto blogpost and googled for a quick solution to find <a href="https://github.com/quarto-dev/quarto-cli/issues/3917">this issue</a> where it’s noted</p>
<blockquote class="blockquote">
<p>But a current limitation is that all are R focused rather than general quarto CLI tooling.</p>
</blockquote>
<p>That gets to the heart of something that could put off some R users migrating from RMarkdown to Quarto… but also that’s the whole point of Quarto to be cross-platform.</p>
<p>Right! So what would a Pros / Cons / Neutrals list look like? Well, <code>{bslib}</code> has nice cards available. So it could be something like this:</p>
<div class="column-page grid">
<div class="g-col-4">
<div class="cell">
<div class="cell-output-display">
<div class="card bslib-card bslib-mb-spacing html-fill-item html-fill-container" data-bslib-card-init="" data-full-screen="false" data-require-bs-caller="card()" data-require-bs-version="5" id="bslib-card-7814">
<div class="card-header">
✅
Quarto installs with few permissions
</div>
<div class="card-body bslib-gap-spacing html-fill-item html-fill-container" style="margin-top:auto;margin-bottom:auto;flex:1 1 auto;">
<p>Makes it really easy to use in training.</p>
</div>
<bslib-tooltip placement="auto" bsoptions="[]" data-require-bs-version="5" data-require-bs-caller="tooltip()">
<template>Expand</template>
<button aria-expanded="false" aria-label="Expand card" class="bslib-full-screen-enter badge rounded-pill"></button>
</bslib-tooltip>
<script data-bslib-card-init="">bslib.Card.initializeAllCards();</script>
</div>
</div>
</div>
</div>
<div class="g-col-4">
<div class="cell">
<div class="cell-output-display">
<div class="card bslib-card bslib-mb-spacing html-fill-item html-fill-container" data-bslib-card-init="" data-require-bs-caller="card()" data-require-bs-version="5">
<div class="card-header">
😐
Quarto quick tools are difficult to make as it's a CLI!
</div>
<div class="card-body bslib-gap-spacing html-fill-item html-fill-container" style="margin-top:auto;margin-bottom:auto;flex:1 1 auto;">
<p>RMarkdown has lovely features like `blogdown::new_post()` that can't really be added to Quarto as it's a CLI! Usability tools would need to be added to the CLI instead of the wrapping package.</p>
</div>
<div class="card-footer">
⚙️
This doesn't need to change
<p>That's the nature of the beast</p>
</div>
<script data-bslib-card-init="">bslib.Card.initializeAllCards();</script>
</div>
</div>
</div>
</div>
<div class="g-col-4">
<div class="cell">
<div class="cell-output-display">
<div class="card bslib-card bslib-mb-spacing html-fill-item html-fill-container" data-bslib-card-init="" data-require-bs-caller="card()" data-require-bs-version="5">
<div class="card-header">
❌
Quarto occassionally summons demons
</div>
<div class="card-body bslib-gap-spacing html-fill-item html-fill-container" style="margin-top:auto;margin-bottom:auto;flex:1 1 auto;">
<p>It doesn't, that's a lie.</p>
</div>
<div class="card-footer">
⚙️
Needs to change. Raised issue on GitHub.
</div>
<script data-bslib-card-init="">bslib.Card.initializeAllCards();</script>
</div>
</div>
</div>
</div>
</div>
<section id="feature-creep" class="level2">
<h2 class="anchored" data-anchor-id="feature-creep">Feature creep</h2>
<p>Ever heard of feature creep? She’s a beast.</p>
<p>I decided the fastest way to record these would be in a Google Sheet that I can then read easily into a Shiny app. But then I thought - I’d love to <a href="https://en.wikipedia.org/wiki/MoSCoW_method">MoSCoW this</a>. Which then led to me building up a bunch of data validation rules:</p>
<p><img src="https://visibledata.co.uk/posts/2024-11-08_positives-and-negatives-lists/change-desire-screenshot.png" class="img-fluid"> … and gosh, I’d discovered I was procrastinating. I’m really aiming to up my data blogging output and feel part of the tech community again. So, let’s settle with something that’s workable… an iOS note that I can also modify on my laptop.</p>
<p><img src="https://visibledata.co.uk/posts/2024-11-08_positives-and-negatives-lists/IMG_3420.PNG" class="img-fluid"></p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {Pros, {Cons} and {Neutrals} Lists?},
  date = {2024-11-08},
  url = {https://visibledata.co.uk/posts/2024-11-08_positives-and-negatives-lists/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“Pros, Cons and Neutrals Lists?”</span>
November 8, 2024. <a href="https://visibledata.co.uk/posts/2024-11-08_positives-and-negatives-lists/">https://visibledata.co.uk/posts/2024-11-08_positives-and-negatives-lists/</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2024-11-08_positives-and-negatives-lists/</guid>
  <pubDate>Fri, 08 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Curves and stones</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/</link>
  <description><![CDATA[ 





<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="left quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>I’ve got a project I’m working on where I’ve been inspired by the <a href="https://fifth-element.fandom.com/wiki/Elemental_Stones">elemental stones in the Fifth Element movie</a> you can see to the right.</p>
<p>In this post I’ll produce this chart:</p>
<p><img src="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/ggptch_all_directions.png" width="200px"></p>
</div>
<div class="right quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/The_Four_Stones.webp" class="img-fluid"></p>
</div>
</div>
</div>
<p>Have you ever seen <a href="https://thetidytrekker.com/rtistry">Megan Harris’ incredible generative art built with R</a>? If not - please take a look! While I was researching ways to make wavy lines with <code>{ggplot2}</code> I came across <a href="https://thetidytrekker.com/post/making-waves/making-waves.html">Megan’s blogpost where she makes this beautiful chart</a>.</p>
<p><img src="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/tidytrekker-chart.png" width="200px"></p>
<p>Borrowing pretty much directly from Megan’s code, here’s a nice sine curve that looks a little like the lines on the stones:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb1-2"></span>
<span id="cb1-3">theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-4">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pi, </span>
<span id="cb1-5">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7">sine <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> theta,</span>
<span id="cb1-8">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(theta),</span>
<span id="cb1-9">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(theta))</span>
<span id="cb1-10"></span>
<span id="cb1-11">wave_theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb1-12">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi, </span>
<span id="cb1-13">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb1-14"></span>
<span id="cb1-15">curve_top <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> wave_theta,</span>
<span id="cb1-16">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(x)</span>
<span id="cb1-18"></span>
<span id="cb1-19">curve_top <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_fixed</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi),</span>
<span id="cb1-23">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ratio =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Nice! Okay. So let’s stack 6 of these on top of one another:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">wave_theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-2">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi, </span>
<span id="cb2-3">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) </span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb2-6">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi, </span>
<span id="cb2-7">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) , <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>),</span>
<span id="cb2-8">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(wave_theta))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> line <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(x),</span>
<span id="cb2-10">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(line)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_fixed</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ratio =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9A7D66"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb2-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I then played around with reflecting these and also making vertical lines… it didn’t quite look right:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"patchwork"</span>)</span>
<span id="cb3-2"></span>
<span id="cb3-3">gg_L2R_sin_arrowed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb3-4">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi, </span>
<span id="cb3-5">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) , <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>),</span>
<span id="cb3-6">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(wave_theta))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> line <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(x),</span>
<span id="cb3-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(line)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ends =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_fixed</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ratio =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb3-14">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9A7D66"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb3-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()) </span>
<span id="cb3-18"></span>
<span id="cb3-19">gg_R2L_cos_arrowed <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb3-20">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi, </span>
<span id="cb3-21">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) , <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>),</span>
<span id="cb3-22">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(wave_theta))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> line <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cos</span>(x),</span>
<span id="cb3-24">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(line)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ends =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mult =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_fixed</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ratio =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb3-30">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9A7D66"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb3-33">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span>
<span id="cb3-34"></span>
<span id="cb3-35">ggptch_both_horiz <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_L2R_sin_arrowed <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> gg_R2L_cos_arrowed</span>
<span id="cb3-36"></span>
<span id="cb3-37">ggptch_both_horiz <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggptch_both_horiz.png"</span>),</span>
<span id="cb3-39">         .,</span>
<span id="cb3-40">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.22</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb3-41">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> )</span></code></pre></div>
</details>
</div>
<p><img src="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/ggptch_both_horiz.png" class="img-fluid"></p>
<section id="arrows-in-the-middle" class="level2">
<h2 class="anchored" data-anchor-id="arrows-in-the-middle">Arrows in the middle?</h2>
<p>With the arrows at the end of the lines it means that the images need to be padded asymmetrically - or at least it’s not a simple swap between the charts. Let’s see move the arrows to the middle of the lines and swap to using sin for both left and right</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">seq_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb4-2">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi, </span>
<span id="cb4-3">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> pi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb4-4">n_lines <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span></span>
<span id="cb4-5"></span>
<span id="cb4-6">data_left_and_right <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(seq_x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>),</span>
<span id="cb4-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(seq_x))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> line <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(x)) </span>
<span id="cb4-9"></span>
<span id="cb4-10">data_arrows_left_and_right <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_left_and_right <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(seq_x[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">102</span>)]),</span>
<span id="cb4-12">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(line, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(line) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x),</span>
<span id="cb4-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(x),</span>
<span id="cb4-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(y),</span>
<span id="cb4-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(y))</span>
<span id="cb4-18"></span>
<span id="cb4-19">gg_left_to_right <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_left_and_right <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_arrows_left_and_right,</span>
<span id="cb4-22">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> xmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> ymax, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xmax, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> ymin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line),</span>
<span id="cb4-23">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ends =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb4-25">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb4-26">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(line, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"background"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb4-30">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"background"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_fixed</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ratio =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pi)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb4-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9A7D66"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb4-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb4-36">  ) </span>
<span id="cb4-37"></span>
<span id="cb4-38">gg_right_to_left <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_left_and_right <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-40">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_arrows_left_and_right,</span>
<span id="cb4-41">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> xmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> ymax, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xmax, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> ymin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line),</span>
<span id="cb4-42">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ends =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb4-44">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb4-45">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(line, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"background"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb4-49">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"background"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_fixed</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ratio =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pi)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb4-53">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9A7D66"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb4-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb4-55">  ) </span>
<span id="cb4-56"></span>
<span id="cb4-57">ggptch_left_and_right <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_left_to_right <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> gg_right_to_left</span>
<span id="cb4-58"></span>
<span id="cb4-59">ggptch_left_and_right <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggptch_left_and_right.png"</span>),</span>
<span id="cb4-61">         .,</span>
<span id="cb4-62">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb4-63">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)</span></code></pre></div>
</details>
</div>
<p><img src="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/ggptch_left_and_right.png" class="img-fluid"></p>
<p>Cool! I like those. Now let’s make the vertical versions by swapping the x and y coordinates and combine them altogether with <code>{patchwork}</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">seq_x_tb <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb5-2">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi, </span>
<span id="cb5-3">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> pi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb5-4">n_lines <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span></span>
<span id="cb5-5"></span>
<span id="cb5-6">data_top_and_bottom <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(seq_x_tb, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>),</span>
<span id="cb5-7">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(seq_x_tb))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> line <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sin</span>(x)) </span>
<span id="cb5-9"></span>
<span id="cb5-10">data_arrows_bottom_and_top <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_top_and_bottom <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(seq_x_tb[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(seq_x_tb) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> , <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(seq_x_tb) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)]),</span>
<span id="cb5-12">         <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(line, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(line) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(x),</span>
<span id="cb5-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xmax =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(x),</span>
<span id="cb5-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(y),</span>
<span id="cb5-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(y))</span>
<span id="cb5-18"></span>
<span id="cb5-19">gg_top_to_bottom <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_top_and_bottom <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_arrows_bottom_and_top,</span>
<span id="cb5-22">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> xmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> ymax, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> xmax, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> ymin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line),</span>
<span id="cb5-23">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ends =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"first"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb5-25">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb5-26">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(line, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"background"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb5-30">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"background"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_fixed</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ratio =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb5-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9A7D66"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb5-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb5-36">  ) </span>
<span id="cb5-37"></span>
<span id="cb5-38">gg_bottom_to_top <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_top_and_bottom <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-40">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_arrows_bottom_and_top,</span>
<span id="cb5-41">               <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> xmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> ymax, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> xmax, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> ymin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> line),</span>
<span id="cb5-42">               <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"closed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ends =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb5-44">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb5-45">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(line, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"background"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"main"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb5-49">                                 <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"background"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey80"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_fixed</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ratio =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_void</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb5-53">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9A7D66"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb5-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.border =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb5-55">  ) </span>
<span id="cb5-56"></span>
<span id="cb5-57"></span>
<span id="cb5-58">(gg_top_to_bottom <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> gg_bottom_to_top)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">ggptch_all_directions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (gg_left_to_right <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> gg_right_to_left) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> </span>
<span id="cb6-2">(gg_top_to_bottom <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> gg_bottom_to_top)</span>
<span id="cb6-3"></span>
<span id="cb6-4">ggptch_all_directions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggptch_all_directions.png"</span>),</span>
<span id="cb6-6">         .,</span>
<span id="cb6-7">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb6-8">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)</span></code></pre></div>
</details>
</div>
<p><img src="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/ggptch_all_directions.png" class="img-fluid"> In an ideal world I’d play around with the vertical images to make them align better, but I can’t quite figure out how to do that today. Hopefully you’ll be seeing these charts again in a project soon. But even if not, I’m quite happy with how they look 😀</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {Curves and Stones},
  date = {2024-11-08},
  url = {https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“Curves and Stones.”</span> November 8,
2024. <a href="https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/">https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2024-11-08_curves-and-stones/</guid>
  <pubDate>Fri, 08 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Bordering countries graph</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/</link>
  <description><![CDATA[ 





<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="left quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>In this post we’re going to build up this <strong>graph</strong> which shows all countries with at least one border and the connections that remain after removing countries with only a single border.</p>
<p>To solve this smoothly I was very pleased to discover the <a href="[`geom_custom()` was added in late 2023](https://github.com/tidyverse/ggplot2/pull/5496)">newly [December 2023] added <code>guide_custom()</code> functionality</a> of <code>{ggplot2}</code>. Of course, this just works effortlessly with the <code>{ggraph}</code> extension for graph visualisation.</p>
</div>
<div class="right quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/gg_graph_countries.png" class="img-fluid"></p>
</div>
</div>
</div>
<section id="connected-countries-with-tidygraph-and-ggraph" class="level2">
<h2 class="anchored" data-anchor-id="connected-countries-with-tidygraph-and-ggraph">Connected Countries with tidygraph and ggraph</h2>
<p>I’ve been thinking about TidyTuesday datasets with country data and how it could be interesting to use country borders as a component of the chart making process. And what’s better than working on an actual TidyTuesday visualisation than getting distracted with something tangential to it?</p>
<p>In <a href="https://github.com/charliejhadley/cjhRutils">my utility package {cjhRutils}</a> I have a <code>tidygraph</code> object containing the nodes and edges of the connected countries, the code can be found in <a href="https://github.com/charliejhadley/cjhRutils/blob/master/data-raw/graph_connected_countries.R">this script</a>. After loading the package (alongside <code>{tidygrapph}</code>) we can see our dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidygraph"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cjhRutils"</span>)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggtext"</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6">ggraph_bordering_countries</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tbl_graph: 173 nodes and 608 edges
#
# A directed simple graph with 26 components
#
# A tibble: 173 × 8
     id iso_a2 iso_a3 name                 name_long name_en region_wb continent
  &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;    
1     1 AE     ARE    United Arab Emirates United A… United… Middle E… Asia     
2     2 AF     AFG    Afghanistan          Afghanis… Afghan… South As… Asia     
3     3 AL     ALB    Albania              Albania   Albania Europe &amp;… Europe   
4     4 AM     ARM    Armenia              Armenia   Armenia Europe &amp;… Asia     
5     5 AO     AGO    Angola               Angola    Angola  Sub-Saha… Africa   
6     6 AQ     ATA    Antarctica           Antarcti… Antarc… Antarcti… Antarcti…
# ℹ 167 more rows
#
# A tibble: 608 × 3
   from    to border_region             
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;                     
1     1   120 Middle East &amp; North Africa
2     1   136 Middle East &amp; North Africa
3     2    34 Cross Region              
# ℹ 605 more rows</code></pre>
</div>
</div>
<p>The graph contains all countries with at least one connection, let’s filter the graph to only include countries with two border or more… and visualise that naively with <code>{ggraph}</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggraph"</span>)</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-4">ggraph_bordering_countries <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">activate</span>(nodes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">node_degree =</span> tidygraph<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">centrality_degree</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(node_degree <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggraph</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layout =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nicely'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> region_wb)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_edge_link</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> border_region))</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="custom-ggplot2-legends-with-guide_custom" class="level2">
<h2 class="anchored" data-anchor-id="custom-ggplot2-legends-with-guide_custom">Custom ggplot2 legends with guide_custom()</h2>
<p>The guide/legend for that chart is a little bit complicated. Let’s look at why:</p>
<ol type="1">
<li><p>Nodes are coloured by the continent the node belongs to.</p></li>
<li><p>Edges are coloured by if the two nodes belong to the same continent.</p></li>
<li><p>There is a single node from “North America” but no edges with the <code>border_region</code> of “North America”</p></li>
<li><p>There are edges that need to be coloured “Cross Region” but no nodes with that colour.</p></li>
</ol>
<p>To solve this I thought of using my old trick of hijacking an unused aesthetic and manipulating its guide. However! That’s not really possible in this case, so I googled for alternatives and was extremeley <a href="https://github.com/tidyverse/ggplot2/pull/5496"><code>geom_custom()</code> was added in late 2023</a>. In the chart below I’ve used <code>guide_custom()</code> to add a red line that I can use to label cross regional borders.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-2">gg_graph_for_coords <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ggraph_bordering_countries <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">activate</span>(nodes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">node_degree =</span> tidygraph<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">centrality_degree</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(node_degree <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggraph</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layout =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nicely'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> region_wb)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_label</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> iso_a2), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_edge_link</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">custom =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_custom</span>(</span>
<span id="cb4-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cross regional borders"</span>,</span>
<span id="cb4-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grob =</span> grid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linesGrob</span>(</span>
<span id="cb4-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.4</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb4-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb4-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> grid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#F44336'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb4-16">    )</span>
<span id="cb4-17">  ))</span>
<span id="cb4-18"></span>
<span id="cb4-19">gg_graph_for_coords</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:95.0%"></p>
</figure>
</div>
</div>
</div>
<p>In the final chart I’d like to add a label to the US to explain why it’s included but Canada isn’t. So let’s grab the coordinates of the node so I can use them to help figure out where to place the label</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot_build</span>(gg_graph_for_coords)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(label <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"US"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(x, y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 0 × 2
# ℹ 2 variables: x &lt;dbl&gt;, y &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Nice. Now we can think about beautification. I’ve chosen to use colours from the &lt;coolors.co&gt; service and have found a subjective balance of colours that I think looks good based on how many nodes are in each group. To ensure a little bit of sense to the colours, I’ll order them as a factor so that the group with the most nodes appears at the top of the legend.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># https://coolors.co/448aff-1565c0-009688-8bc34a-ffc107-ff9800-f44336-ad1457</span></span>
<span id="cb7-2">vec_colours <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb7-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cross Region"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F44336"</span>,</span>
<span id="cb7-4">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"East Asia &amp; Pacific"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1565C0"</span>,</span>
<span id="cb7-5">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Europe &amp; Central Asia"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#009688"</span>,</span>
<span id="cb7-6">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Latin America &amp; Caribbean"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#8BC34A"</span>,</span>
<span id="cb7-7">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Middle East &amp; North Africa"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFC107"</span>,</span>
<span id="cb7-8">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"North America"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FF9800"</span>,</span>
<span id="cb7-9">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"South Asia"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#448AFF"</span>,</span>
<span id="cb7-10">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sub-Saharan Africa"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#AD1457"</span></span>
<span id="cb7-11">)</span>
<span id="cb7-12"></span>
<span id="cb7-13">vec_order_borders <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ggraph_bordering_countries <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">activate</span>(edges) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(border_region, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(border_region)</span>
<span id="cb7-18"></span>
<span id="cb7-19">vec_colours <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vec_colours[vec_order_borders]</span>
<span id="cb7-20"></span>
<span id="cb7-21">ggraph_one_edge_plus <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ggraph_bordering_countries <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">activate</span>(nodes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">node_degree =</span> tidygraph<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">centrality_degree</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(node_degree <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">region_wb =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_relevel</span>(region_wb, vec_order_borders)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">activate</span>(edges) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb7-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border_region =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_expand</span>(border_region, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"North America"</span>),</span>
<span id="cb7-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border_region =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_relevel</span>(border_region)</span>
<span id="cb7-30">  )</span>
<span id="cb7-31"></span>
<span id="cb7-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-33">gg_graph_before_label <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ggraph_one_edge_plus <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggraph</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layout =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'nicely'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> region_wb) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_edge_link</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> border_region),</span>
<span id="cb7-37">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb7-38">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">edge_width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_point</span>(</span>
<span id="cb7-40">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> region_wb),</span>
<span id="cb7-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># show.legend = TRUE,</span></span>
<span id="cb7-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb7-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb7-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span></span>
<span id="cb7-45">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_node_text</span>(</span>
<span id="cb7-47">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb7-48">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> iso_a2,</span>
<span id="cb7-49">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(</span>
<span id="cb7-50">        region_wb <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Middle East &amp; North Africa"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"North America"</span>),</span>
<span id="cb7-51">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb7-52">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span></span>
<span id="cb7-53">      )</span>
<span id="cb7-54">    ),</span>
<span id="cb7-55">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.3</span>,</span>
<span id="cb7-56">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source Code Pro"</span>,</span>
<span id="cb7-57">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb7-58">  )  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-59">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_identity</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_edge_colour_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> vec_colours, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drop =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-61">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> vec_colours, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drop =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-62">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(</span>
<span id="cb7-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">custom =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_custom</span>(</span>
<span id="cb7-64">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cross regional borders"</span>,</span>
<span id="cb7-65">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grob =</span> grid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">linesGrob</span>(</span>
<span id="cb7-66">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.9</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb7-67">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb7-68">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gp =</span> grid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gpar</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#F44336'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>)</span>
<span id="cb7-69">      )</span>
<span id="cb7-70">    ),</span>
<span id="cb7-71">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb7-72">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-73">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb7-74">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Who's connected to who?"</span>,</span>
<span id="cb7-75">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Countries with at least one land border"</span>,</span>
<span id="cb7-76">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb7-77">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb7-78">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"@charliejhadley | Source: geodatasource.com/addon/country-borders"</span></span>
<span id="cb7-79">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-80">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-81">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb7-82">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.618</span>),</span>
<span id="cb7-83">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-84">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb7-85">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,</span>
<span id="cb7-86">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto"</span>,</span>
<span id="cb7-87">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineheight =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb7-88">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb7-89">    ),</span>
<span id="cb7-90">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb7-91">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto"</span>,</span>
<span id="cb7-92">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.618</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb7-93">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span>
<span id="cb7-94">    ),</span>
<span id="cb7-95">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.618</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)),</span>
<span id="cb7-96">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-97">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-98">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-99">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-100">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.618</span>),</span>
<span id="cb7-101">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend.spacing.y = unit(2.0, "cm"),</span></span>
<span id="cb7-102">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cm"</span>),</span>
<span id="cb7-103">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb7-104">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot"</span></span>
<span id="cb7-105">  )</span>
<span id="cb7-106"></span>
<span id="cb7-107">gg_graph_before_label</span></code></pre></div>
</details>
</div>
<p><img src="https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/gg_graph_before_label.png" class="img-fluid"></p>
<p>Let’s add in my labels, which are manually placed but use the node position extracted earlier to help place them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">gg_graph_countries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_graph_before_label <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_curve</span>(</span>
<span id="cb8-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb8-4">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.08</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.5</span>,</span>
<span id="cb8-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.96</span> ,</span>
<span id="cb8-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.08</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span>,</span>
<span id="cb8-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.96</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span></span>
<span id="cb8-8">    ),</span>
<span id="cb8-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> yend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xend),</span>
<span id="cb8-10">    </span>
<span id="cb8-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb8-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npc"</span>)),</span>
<span id="cb8-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">curvature =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb8-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span></span>
<span id="cb8-15">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(</span>
<span id="cb8-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb8-18">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.08</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.5</span>,</span>
<span id="cb8-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.96</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb8-20">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_wrap</span>(</span>
<span id="cb8-21">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Canada isn't here. It only has a single land border with the US - which is included as it has two borders"</span>,</span>
<span id="cb8-22">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span></span>
<span id="cb8-23">      )</span>
<span id="cb8-24">    ),</span>
<span id="cb8-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label),</span>
<span id="cb8-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> colorspace<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">darken</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#D8E4EA"</span>),</span>
<span id="cb8-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.padding =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb8-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb8-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb8-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb8-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb8-32">  )</span>
<span id="cb8-33"></span>
<span id="cb8-34">gg_graph_countries <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(</span>
<span id="cb8-36">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gg_graph_countries.png"</span>),</span>
<span id="cb8-37">    .,</span>
<span id="cb8-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.25</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb8-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb8-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#D8E4EA"</span></span>
<span id="cb8-41">  )</span></code></pre></div>
</div>
<p><img src="https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/gg_graph_countries.png" class="img-fluid"></p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {Bordering Countries Graph},
  date = {2024-11-04},
  url = {https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“Bordering Countries Graph.”</span>
November 4, 2024. <a href="https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/">https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2024-10-28_bordering-country-graph/</guid>
  <pubDate>Mon, 04 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>{highcharts} doesn’t like empty factors (and the .by argument is quite nice, actually)</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-10-24_Highchart-doesnt-like-empty-factors/</link>
  <description><![CDATA[ 





<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="left quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>Heard of <code>{plotly}</code> for interactive charts? I massively prefer <code>{highcharts}</code> as it’s more accessible, mobile friendly and <strong>simply more beautiful</strong>. Both of these packages are <em>htmlwidgets</em> and there are <a href="https://www.htmlwidgets.org/showcase_highcharts.html">so many packages for making interactive charts, maps and more</a>.</p>
<p>But. We’re here to discuss how <code>{highcharter}</code> doesn’t like empty factor levels - with my own YouTubesque thumbnail.</p>
</div>
<div class="right quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://visibledata.co.uk/posts/2024-10-24_Highchart-doesnt-like-empty-factors/highchart-doesnt-like-empty-factors_youtube-thumbnail.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Let’s demonstrate how <code>{ggplot2}</code> handles ordering of factor levels that are empty:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"></span>
<span id="cb1-3">gss_party_by_marital <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gss_cat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_in_subcategory =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(partyid, marital)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_in_category =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(n_in_subcategory), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> partyid) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">partyid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(partyid, n_in_category))</span>
<span id="cb1-7"></span>
<span id="cb1-8">gss_party_by_marital <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> n_in_subcategory,</span>
<span id="cb1-10">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> partyid,</span>
<span id="cb1-11">             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> marital)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">direction =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-10-24_Highchart-doesnt-like-empty-factors/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>That’s a nicely ordered stacked bar chart! We’ve got the bars going from big to small, even though the final two categories don’t contain all of the marital states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">gss_party_by_marital <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(partyid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No answer"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Don't know"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-3">  knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">partyid</th>
<th style="text-align: left;">marital</th>
<th style="text-align: right;">n_in_subcategory</th>
<th style="text-align: right;">n_in_category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Married</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="even">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Divorced</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Never married</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="even">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Widowed</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Separated</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="even">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">No answer</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Don’t know</td>
<td style="text-align: left;">Married</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Let’s throw this into <code>{highcharter}</code> and we see just a complete <strong>mess</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(highcharter)</span>
<span id="cb3-2"></span>
<span id="cb3-3">gss_party_by_marital <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hchart</span>(</span>
<span id="cb3-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bar"</span>,</span>
<span id="cb3-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hcaes</span>(</span>
<span id="cb3-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> n_in_subcategory,</span>
<span id="cb3-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> partyid,</span>
<span id="cb3-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> marital</span>
<span id="cb3-10">    )</span>
<span id="cb3-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hc_plotOptions</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">series =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stacking =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="highchart html-widget html-fill-item" id="htmlwidget-2103f1720d96096aa7c3" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-2103f1720d96096aa7c3">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":null},"yAxis":{"title":{"text":"n_in_subcategory"},"type":"linear"},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":true,"stacking":"normal"},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"name":"No answer","data":[{"partyid":"Ind,near dem","marital":"No answer","n_in_subcategory":2,"n_in_category":2499,"y":2,"name":"Ind,near dem"},{"partyid":"Strong republican","marital":"No answer","n_in_subcategory":2,"n_in_category":2314,"y":2,"name":"Strong republican"},{"partyid":"Strong democrat","marital":"No answer","n_in_subcategory":2,"n_in_category":3490,"y":2,"name":"Strong democrat"},{"partyid":"Not str democrat","marital":"No answer","n_in_subcategory":1,"n_in_category":3690,"y":1,"name":"Not str democrat"},{"partyid":"No answer","marital":"No answer","n_in_subcategory":5,"n_in_category":154,"y":5,"name":"No answer"},{"partyid":"Independent","marital":"No answer","n_in_subcategory":4,"n_in_category":4119,"y":4,"name":"Independent"},{"partyid":"Not str republican","marital":"No answer","n_in_subcategory":1,"n_in_category":3032,"y":1,"name":"Not str republican"}],"type":"bar"},{"name":"Never married","data":[{"partyid":"Ind,near rep","marital":"Never married","n_in_subcategory":413,"n_in_category":1791,"y":413,"name":"Ind,near rep"},{"partyid":"Not str republican","marital":"Never married","n_in_subcategory":597,"n_in_category":3032,"y":597,"name":"Not str republican"},{"partyid":"Independent","marital":"Never married","n_in_subcategory":1181,"n_in_category":4119,"y":1181,"name":"Independent"},{"partyid":"Not str democrat","marital":"Never married","n_in_subcategory":1035,"n_in_category":3690,"y":1035,"name":"Not str democrat"},{"partyid":"Ind,near dem","marital":"Never married","n_in_subcategory":812,"n_in_category":2499,"y":812,"name":"Ind,near dem"},{"partyid":"Strong republican","marital":"Never married","n_in_subcategory":286,"n_in_category":2314,"y":286,"name":"Strong republican"},{"partyid":"Strong democrat","marital":"Never married","n_in_subcategory":940,"n_in_category":3490,"y":940,"name":"Strong democrat"},{"partyid":"Other party","marital":"Never married","n_in_subcategory":117,"n_in_category":393,"y":117,"name":"Other party"},{"partyid":"No answer","marital":"Never married","n_in_subcategory":35,"n_in_category":154,"y":35,"name":"No answer"}],"type":"bar"},{"name":"Separated","data":[{"partyid":"Strong democrat","marital":"Separated","n_in_subcategory":132,"n_in_category":3490,"y":132,"name":"Strong democrat"},{"partyid":"Not str democrat","marital":"Separated","n_in_subcategory":126,"n_in_category":3690,"y":126,"name":"Not str democrat"},{"partyid":"Independent","marital":"Separated","n_in_subcategory":198,"n_in_category":4119,"y":198,"name":"Independent"},{"partyid":"Ind,near dem","marital":"Separated","n_in_subcategory":96,"n_in_category":2499,"y":96,"name":"Ind,near dem"},{"partyid":"Strong republican","marital":"Separated","n_in_subcategory":56,"n_in_category":2314,"y":56,"name":"Strong republican"},{"partyid":"Not str republican","marital":"Separated","n_in_subcategory":60,"n_in_category":3032,"y":60,"name":"Not str republican"},{"partyid":"Other party","marital":"Separated","n_in_subcategory":11,"n_in_category":393,"y":11,"name":"Other party"},{"partyid":"Ind,near rep","marital":"Separated","n_in_subcategory":55,"n_in_category":1791,"y":55,"name":"Ind,near rep"},{"partyid":"No answer","marital":"Separated","n_in_subcategory":9,"n_in_category":154,"y":9,"name":"No answer"}],"type":"bar"},{"name":"Divorced","data":[{"partyid":"Not str republican","marital":"Divorced","n_in_subcategory":422,"n_in_category":3032,"y":422,"name":"Not str republican"},{"partyid":"Not str democrat","marital":"Divorced","n_in_subcategory":601,"n_in_category":3690,"y":601,"name":"Not str democrat"},{"partyid":"Ind,near dem","marital":"Divorced","n_in_subcategory":399,"n_in_category":2499,"y":399,"name":"Ind,near dem"},{"partyid":"Strong democrat","marital":"Divorced","n_in_subcategory":614,"n_in_category":3490,"y":614,"name":"Strong democrat"},{"partyid":"Independent","marital":"Divorced","n_in_subcategory":661,"n_in_category":4119,"y":661,"name":"Independent"},{"partyid":"Ind,near rep","marital":"Divorced","n_in_subcategory":283,"n_in_category":1791,"y":283,"name":"Ind,near rep"},{"partyid":"Strong republican","marital":"Divorced","n_in_subcategory":306,"n_in_category":2314,"y":306,"name":"Strong republican"},{"partyid":"Other party","marital":"Divorced","n_in_subcategory":68,"n_in_category":393,"y":68,"name":"Other party"},{"partyid":"No answer","marital":"Divorced","n_in_subcategory":29,"n_in_category":154,"y":29,"name":"No answer"}],"type":"bar"},{"name":"Widowed","data":[{"partyid":"Independent","marital":"Widowed","n_in_subcategory":270,"n_in_category":4119,"y":270,"name":"Independent"},{"partyid":"Strong republican","marital":"Widowed","n_in_subcategory":210,"n_in_category":2314,"y":210,"name":"Strong republican"},{"partyid":"Ind,near rep","marital":"Widowed","n_in_subcategory":118,"n_in_category":1791,"y":118,"name":"Ind,near rep"},{"partyid":"Not str democrat","marital":"Widowed","n_in_subcategory":354,"n_in_category":3690,"y":354,"name":"Not str democrat"},{"partyid":"Strong democrat","marital":"Widowed","n_in_subcategory":425,"n_in_category":3490,"y":425,"name":"Strong democrat"},{"partyid":"Not str republican","marital":"Widowed","n_in_subcategory":231,"n_in_category":3032,"y":231,"name":"Not str republican"},{"partyid":"Ind,near dem","marital":"Widowed","n_in_subcategory":157,"n_in_category":2499,"y":157,"name":"Ind,near dem"},{"partyid":"Other party","marital":"Widowed","n_in_subcategory":26,"n_in_category":393,"y":26,"name":"Other party"},{"partyid":"No answer","marital":"Widowed","n_in_subcategory":16,"n_in_category":154,"y":16,"name":"No answer"}],"type":"bar"},{"name":"Married","data":[{"partyid":"Strong democrat","marital":"Married","n_in_subcategory":1377,"n_in_category":3490,"y":1377,"name":"Strong democrat"},{"partyid":"Not str democrat","marital":"Married","n_in_subcategory":1573,"n_in_category":3690,"y":1573,"name":"Not str democrat"},{"partyid":"Strong republican","marital":"Married","n_in_subcategory":1454,"n_in_category":2314,"y":1454,"name":"Strong republican"},{"partyid":"Ind,near rep","marital":"Married","n_in_subcategory":922,"n_in_category":1791,"y":922,"name":"Ind,near rep"},{"partyid":"Independent","marital":"Married","n_in_subcategory":1805,"n_in_category":4119,"y":1805,"name":"Independent"},{"partyid":"Ind,near dem","marital":"Married","n_in_subcategory":1033,"n_in_category":2499,"y":1033,"name":"Ind,near dem"},{"partyid":"Not str republican","marital":"Married","n_in_subcategory":1721,"n_in_category":3032,"y":1721,"name":"Not str republican"},{"partyid":"Other party","marital":"Married","n_in_subcategory":171,"n_in_category":393,"y":171,"name":"Other party"},{"partyid":"No answer","marital":"Married","n_in_subcategory":60,"n_in_category":154,"y":60,"name":"No answer"},{"partyid":"Don't know","marital":"Married","n_in_subcategory":1,"n_in_category":1,"y":1,"name":"Don't know"}],"type":"bar"}],"xAxis":{"type":"category","title":{"text":"partyid"},"categories":null}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="using-complete-and-talking-about-that-.by-argument" class="level2">
<h2 class="anchored" data-anchor-id="using-complete-and-talking-about-that-.by-argument">Using complete() and talking about that .by argument</h2>
<p>You might have missed it in my code above, but I used groups without <code>group_by()</code> or <code>ungroup()</code>! Back in late 2022 there was a <a href="https://github.com/tidyverse/dplyr/pull/6528">suggestion that the grouping functions gain a <code>.by</code> argument</a> which was added as an experimental feature.</p>
<p>I initially I really didn’t like it. But, look how neat this is. I’ve highlighted the <code>summarise()</code> and <code>mutate()</code> lines that make use of the <code>.by</code> argument, it saves having to call <code>group_by()</code> and <code>ungroup()</code>… and just to be clear <code>complete()</code> is filling in empty factor levels with an explicit value of 0.</p>
<div class="cell" data-source-line-numbers="2,6">
<div class="sourceCode cell-code" id="cb4" data-source-line-numbers="2,6" data-code-line-numbers="2,6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">gss_completed_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gss_cat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_in_subcategory =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(partyid, marital)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">complete</span>(partyid,</span>
<span id="cb4-4">           marital,</span>
<span id="cb4-5">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_in_subcategory =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_in_category =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(n_in_subcategory), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> partyid) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">partyid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(partyid, n_in_category)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(n_in_category))</span>
<span id="cb4-9"></span>
<span id="cb4-10">gss_completed_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(partyid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No answer"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Don't know"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-12">  knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">partyid</th>
<th style="text-align: left;">marital</th>
<th style="text-align: right;">n_in_subcategory</th>
<th style="text-align: right;">n_in_category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">No answer</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="even">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Never married</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Separated</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="even">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Divorced</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Widowed</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="even">
<td style="text-align: left;">No answer</td>
<td style="text-align: left;">Married</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">154</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Don’t know</td>
<td style="text-align: left;">No answer</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Don’t know</td>
<td style="text-align: left;">Never married</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Don’t know</td>
<td style="text-align: left;">Separated</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Don’t know</td>
<td style="text-align: left;">Divorced</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Don’t know</td>
<td style="text-align: left;">Widowed</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Don’t know</td>
<td style="text-align: left;">Married</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now those empty factor levels are filled we can throw it back into <code>{highcharter}</code>. Make sure to interact with the chart, and click on the legend items to see just how beautiful <code>{highcharter}</code> is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="nil" data-code-line-numbers="nil" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">gss_completed_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hchart</span>(</span>
<span id="cb5-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bar"</span>,</span>
<span id="cb5-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hcaes</span>(</span>
<span id="cb5-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> n_in_subcategory,</span>
<span id="cb5-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> partyid,</span>
<span id="cb5-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> marital</span>
<span id="cb5-8">    )</span>
<span id="cb5-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hc_plotOptions</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">series =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stacking =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="highchart html-widget html-fill-item" id="htmlwidget-6dffecb350c8722b2da4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6dffecb350c8722b2da4">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":null},"yAxis":{"title":{"text":"n_in_subcategory"},"type":"linear"},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":true,"stacking":"normal"},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"name":"No answer","data":[{"partyid":"Independent","marital":"No answer","n_in_subcategory":4,"n_in_category":4119,"y":4,"name":"Independent"},{"partyid":"Not str democrat","marital":"No answer","n_in_subcategory":1,"n_in_category":3690,"y":1,"name":"Not str democrat"},{"partyid":"Strong democrat","marital":"No answer","n_in_subcategory":2,"n_in_category":3490,"y":2,"name":"Strong democrat"},{"partyid":"Not str republican","marital":"No answer","n_in_subcategory":1,"n_in_category":3032,"y":1,"name":"Not str republican"},{"partyid":"Ind,near dem","marital":"No answer","n_in_subcategory":2,"n_in_category":2499,"y":2,"name":"Ind,near dem"},{"partyid":"Strong republican","marital":"No answer","n_in_subcategory":2,"n_in_category":2314,"y":2,"name":"Strong republican"},{"partyid":"Ind,near rep","marital":"No answer","n_in_subcategory":0,"n_in_category":1791,"y":0,"name":"Ind,near rep"},{"partyid":"Other party","marital":"No answer","n_in_subcategory":0,"n_in_category":393,"y":0,"name":"Other party"},{"partyid":"No answer","marital":"No answer","n_in_subcategory":5,"n_in_category":154,"y":5,"name":"No answer"},{"partyid":"Don't know","marital":"No answer","n_in_subcategory":0,"n_in_category":1,"y":0,"name":"Don't know"}],"type":"bar"},{"name":"Never married","data":[{"partyid":"Independent","marital":"Never married","n_in_subcategory":1181,"n_in_category":4119,"y":1181,"name":"Independent"},{"partyid":"Not str democrat","marital":"Never married","n_in_subcategory":1035,"n_in_category":3690,"y":1035,"name":"Not str democrat"},{"partyid":"Strong democrat","marital":"Never married","n_in_subcategory":940,"n_in_category":3490,"y":940,"name":"Strong democrat"},{"partyid":"Not str republican","marital":"Never married","n_in_subcategory":597,"n_in_category":3032,"y":597,"name":"Not str republican"},{"partyid":"Ind,near dem","marital":"Never married","n_in_subcategory":812,"n_in_category":2499,"y":812,"name":"Ind,near dem"},{"partyid":"Strong republican","marital":"Never married","n_in_subcategory":286,"n_in_category":2314,"y":286,"name":"Strong republican"},{"partyid":"Ind,near rep","marital":"Never married","n_in_subcategory":413,"n_in_category":1791,"y":413,"name":"Ind,near rep"},{"partyid":"Other party","marital":"Never married","n_in_subcategory":117,"n_in_category":393,"y":117,"name":"Other party"},{"partyid":"No answer","marital":"Never married","n_in_subcategory":35,"n_in_category":154,"y":35,"name":"No answer"},{"partyid":"Don't know","marital":"Never married","n_in_subcategory":0,"n_in_category":1,"y":0,"name":"Don't know"}],"type":"bar"},{"name":"Separated","data":[{"partyid":"Independent","marital":"Separated","n_in_subcategory":198,"n_in_category":4119,"y":198,"name":"Independent"},{"partyid":"Not str democrat","marital":"Separated","n_in_subcategory":126,"n_in_category":3690,"y":126,"name":"Not str democrat"},{"partyid":"Strong democrat","marital":"Separated","n_in_subcategory":132,"n_in_category":3490,"y":132,"name":"Strong democrat"},{"partyid":"Not str republican","marital":"Separated","n_in_subcategory":60,"n_in_category":3032,"y":60,"name":"Not str republican"},{"partyid":"Ind,near dem","marital":"Separated","n_in_subcategory":96,"n_in_category":2499,"y":96,"name":"Ind,near dem"},{"partyid":"Strong republican","marital":"Separated","n_in_subcategory":56,"n_in_category":2314,"y":56,"name":"Strong republican"},{"partyid":"Ind,near rep","marital":"Separated","n_in_subcategory":55,"n_in_category":1791,"y":55,"name":"Ind,near rep"},{"partyid":"Other party","marital":"Separated","n_in_subcategory":11,"n_in_category":393,"y":11,"name":"Other party"},{"partyid":"No answer","marital":"Separated","n_in_subcategory":9,"n_in_category":154,"y":9,"name":"No answer"},{"partyid":"Don't know","marital":"Separated","n_in_subcategory":0,"n_in_category":1,"y":0,"name":"Don't know"}],"type":"bar"},{"name":"Divorced","data":[{"partyid":"Independent","marital":"Divorced","n_in_subcategory":661,"n_in_category":4119,"y":661,"name":"Independent"},{"partyid":"Not str democrat","marital":"Divorced","n_in_subcategory":601,"n_in_category":3690,"y":601,"name":"Not str democrat"},{"partyid":"Strong democrat","marital":"Divorced","n_in_subcategory":614,"n_in_category":3490,"y":614,"name":"Strong democrat"},{"partyid":"Not str republican","marital":"Divorced","n_in_subcategory":422,"n_in_category":3032,"y":422,"name":"Not str republican"},{"partyid":"Ind,near dem","marital":"Divorced","n_in_subcategory":399,"n_in_category":2499,"y":399,"name":"Ind,near dem"},{"partyid":"Strong republican","marital":"Divorced","n_in_subcategory":306,"n_in_category":2314,"y":306,"name":"Strong republican"},{"partyid":"Ind,near rep","marital":"Divorced","n_in_subcategory":283,"n_in_category":1791,"y":283,"name":"Ind,near rep"},{"partyid":"Other party","marital":"Divorced","n_in_subcategory":68,"n_in_category":393,"y":68,"name":"Other party"},{"partyid":"No answer","marital":"Divorced","n_in_subcategory":29,"n_in_category":154,"y":29,"name":"No answer"},{"partyid":"Don't know","marital":"Divorced","n_in_subcategory":0,"n_in_category":1,"y":0,"name":"Don't know"}],"type":"bar"},{"name":"Widowed","data":[{"partyid":"Independent","marital":"Widowed","n_in_subcategory":270,"n_in_category":4119,"y":270,"name":"Independent"},{"partyid":"Not str democrat","marital":"Widowed","n_in_subcategory":354,"n_in_category":3690,"y":354,"name":"Not str democrat"},{"partyid":"Strong democrat","marital":"Widowed","n_in_subcategory":425,"n_in_category":3490,"y":425,"name":"Strong democrat"},{"partyid":"Not str republican","marital":"Widowed","n_in_subcategory":231,"n_in_category":3032,"y":231,"name":"Not str republican"},{"partyid":"Ind,near dem","marital":"Widowed","n_in_subcategory":157,"n_in_category":2499,"y":157,"name":"Ind,near dem"},{"partyid":"Strong republican","marital":"Widowed","n_in_subcategory":210,"n_in_category":2314,"y":210,"name":"Strong republican"},{"partyid":"Ind,near rep","marital":"Widowed","n_in_subcategory":118,"n_in_category":1791,"y":118,"name":"Ind,near rep"},{"partyid":"Other party","marital":"Widowed","n_in_subcategory":26,"n_in_category":393,"y":26,"name":"Other party"},{"partyid":"No answer","marital":"Widowed","n_in_subcategory":16,"n_in_category":154,"y":16,"name":"No answer"},{"partyid":"Don't know","marital":"Widowed","n_in_subcategory":0,"n_in_category":1,"y":0,"name":"Don't know"}],"type":"bar"},{"name":"Married","data":[{"partyid":"Independent","marital":"Married","n_in_subcategory":1805,"n_in_category":4119,"y":1805,"name":"Independent"},{"partyid":"Not str democrat","marital":"Married","n_in_subcategory":1573,"n_in_category":3690,"y":1573,"name":"Not str democrat"},{"partyid":"Strong democrat","marital":"Married","n_in_subcategory":1377,"n_in_category":3490,"y":1377,"name":"Strong democrat"},{"partyid":"Not str republican","marital":"Married","n_in_subcategory":1721,"n_in_category":3032,"y":1721,"name":"Not str republican"},{"partyid":"Ind,near dem","marital":"Married","n_in_subcategory":1033,"n_in_category":2499,"y":1033,"name":"Ind,near dem"},{"partyid":"Strong republican","marital":"Married","n_in_subcategory":1454,"n_in_category":2314,"y":1454,"name":"Strong republican"},{"partyid":"Ind,near rep","marital":"Married","n_in_subcategory":922,"n_in_category":1791,"y":922,"name":"Ind,near rep"},{"partyid":"Other party","marital":"Married","n_in_subcategory":171,"n_in_category":393,"y":171,"name":"Other party"},{"partyid":"No answer","marital":"Married","n_in_subcategory":60,"n_in_category":154,"y":60,"name":"No answer"},{"partyid":"Don't know","marital":"Married","n_in_subcategory":1,"n_in_category":1,"y":1,"name":"Don't know"}],"type":"bar"}],"xAxis":{"type":"category","title":{"text":"partyid"},"categories":null}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="a-necessary-aside-on-licensing" class="level2">
<h2 class="anchored" data-anchor-id="a-necessary-aside-on-licensing">A necessary aside on licensing</h2>
<p><code>{highcharter}</code> is a wrapper for the incredible <a href="highcharts.com">https://highcharts.com/</a> JavaScript framework. It is <strong>not free</strong> to use <code>{highcharter}</code> in <a href="https://shop.highcharts.com/">commercial projects</a>, but there are free license options for <a href="https://shop.highcharts.com/contact/personal">personal projects</a> and <a href="https://www.highcharts.com/blog/education/">educational usage</a>.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {\{Highcharts\} Doesn’t Like Empty Factors (and the .by
    Argument Is Quite Nice, Actually)},
  date = {2024-10-24},
  url = {https://visibledata.co.uk/posts/2024-10-24_Highchart-doesnt-like-empty-factors},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“{Highcharts} Doesn’t Like Empty Factors
(and the .by Argument Is Quite Nice, Actually).”</span> October 24,
2024. <a href="https://visibledata.co.uk/posts/2024-10-24_Highchart-doesnt-like-empty-factors">https://visibledata.co.uk/posts/2024-10-24_Highchart-doesnt-like-empty-factors</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2024-10-24_Highchart-doesnt-like-empty-factors/</guid>
  <pubDate>Wed, 23 Oct 2024 23:00:00 GMT</pubDate>
</item>
<item>
  <title>From the archive: 30DayChartChallenge 2022 Pictogram</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-emoji-standard-deviation-chart/</link>
  <description><![CDATA[ 





<hr>
<p>This post has been rescued from a side-project blog that I’ve disposed of and slowly reposting content from. In this post I created one of my favourite charts:</p>
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-emoji-standard-deviation-chart/gg_emoji_histogram_fancy.png" class="img-fluid"></p>
<hr>
<p>This chart was built for the “Pictogram” prompt in the 2022 #30DayChartChallenge. It’s a tired trope to see a normal distribution called something like the “para-normal distribution” with a ghost, I then thought about emoji, 5-sigma and then this idea came about.</p>
<p>To begin I created a dotplot and was lucky enough for my seed to generate a single outlier on the right-side:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"></span>
<span id="cb1-3">data_hist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> {</span>
<span id="cb1-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb1-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>,</span>
<span id="cb1-7">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb1-8">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb1-9">  )</span>
<span id="cb1-10">}</span>
<span id="cb1-11"></span>
<span id="cb1-12">sd_of_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(data_hist<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x)</span>
<span id="cb1-13">mean_of_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(data_hist<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x)</span>
<span id="cb1-14"></span>
<span id="cb1-15">gg_hist_dot_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_hist <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dotplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dotdensity"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dotsize =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodge"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binpositions=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bygroup"</span>)</span>
<span id="cb1-18">gg_hist_dot_plot</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-emoji-standard-deviation-chart/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In case you’ve not seen it, you can extract all of the coordinates of geoms from a chart via <code>ggplot_build()</code>. Which I’m going to use to add the emoji in place of the dots in the chart:</p>
<p>I then extracted the coordinates of the dots via <code>ggplot_build()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">build_gg <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot_build</span>(gg_hist_dot_plot)</span></code></pre></div>
</div>
<p>Now I use <code>{emo}</code> to create a tibble containing data for my emojis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"emo"</span>)</span>
<span id="cb3-2"></span>
<span id="cb3-3">vec_emojis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3+"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> emo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ji</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scream"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> emo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ji</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fearful"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> emo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ji</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"confused"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> emo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ji</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grin"</span>))</span>
<span id="cb3-4"></span>
<span id="cb3-5">data_emoji_positions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> build_gg<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.frame</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(x, xmin, xmax, y, stackpos) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sds_from_mean =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb3-10">    x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> ( mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3+"</span>,</span>
<span id="cb3-11">    x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> ( mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>,</span>
<span id="cb3-12">    x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> ( mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>,</span>
<span id="cb3-13">    x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> ( mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1"</span>,</span>
<span id="cb3-14">    x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> ( mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2"</span>,</span>
<span id="cb3-15">    x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> ( mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3"</span>,</span>
<span id="cb3-16">    x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> ( mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data )<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3+"</span></span>
<span id="cb3-17">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">emoji_symbol =</span> vec_emojis[sds_from_mean])</span></code></pre></div>
</div>
<p>To visualise the standard deviation components of the Normal distribution I created two utility functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">hist_function <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>}</span>
<span id="cb4-2"></span>
<span id="cb4-3">geom_dnorm_fill <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(xlim, fill_color, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>){</span>
<span id="cb4-4"></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function"</span>,</span>
<span id="cb4-6">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> hist_function,</span>
<span id="cb4-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> fill_color,</span>
<span id="cb4-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> alpha,</span>
<span id="cb4-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> xlim)</span>
<span id="cb4-10"></span>
<span id="cb4-11">}</span>
<span id="cb4-12"></span>
<span id="cb4-13">data_emoji_positions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> stackpos)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb4-16">                    mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb4-17">                  viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb4-19">                    mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb4-20">                  viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb4-22">                    mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb4-23">                  viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb4-25">                    mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb4-26">                  viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-emoji-standard-deviation-chart/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I then combined everything together into the original version of the chart in 2022:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(hrbrthemes)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggtext)</span>
<span id="cb5-3"></span>
<span id="cb5-4">gg_emoji_histogram <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_emoji_positions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> stackpos)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb5-7">                  mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb5-8">                viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb5-10">                  mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb5-11">                viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb5-13">                  mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb5-14">                viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb5-16">                  mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb5-17">                viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{emo::ji('grin')} represent &lt;span style='color:{viridis::viridis(5)[1]};font-weight:bold'&gt;68% of the data&lt;/span&gt;"</span>,</span>
<span id="cb5-19">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb5-20">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{emo::ji('confused')} represent &lt;span style='color:{viridis::viridis(5)[2]};font-weight:bold'&gt;95% of the data&lt;/span&gt;"</span>,</span>
<span id="cb5-21">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb5-22">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{emo::ji('fearful')} represent &lt;span style='color:{viridis::viridis(5)[3]};font-weight:bold'&gt;99.7% of the data&lt;/span&gt;"</span>,</span>
<span id="cb5-23">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb5-24">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{emo::ji('scream')} represent &lt;span style='color:{viridis::viridis(5)[4]};font-weight:bold'&gt;the rest of the data&lt;/span&gt;"</span>)),</span>
<span id="cb5-25">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label),</span>
<span id="cb5-26">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DM Sans"</span>,</span>
<span id="cb5-27">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.padding =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb5-28">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb5-29">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb5-30">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>,</span>
<span id="cb5-31">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span id="cb5-32">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_curve</span>(</span>
<span id="cb5-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(data_emoji_positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb5-35">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> yend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xend),</span>
<span id="cb5-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x = 120, y = 10, xend = max(data_emoji_positions$x), yend = 1,</span></span>
<span id="cb5-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data = df,</span></span>
<span id="cb5-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npc"</span>)),</span>
<span id="cb5-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">curvature =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb5-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span></span>
<span id="cb5-41">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-42">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_point() +</span></span>
<span id="cb5-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">115</span>,</span>
<span id="cb5-44">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,</span>
<span id="cb5-45">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yup, that's me. You're probably&lt;br&gt;wondering how I ended up in&lt;br&gt; this situation..."</span>),</span>
<span id="cb5-46">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label),</span>
<span id="cb5-47">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>,</span>
<span id="cb5-48">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb5-49">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comic Sans MS"</span>,</span>
<span id="cb5-50">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.padding =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb5-51">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb5-52">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> emoji_symbol),</span>
<span id="cb5-54">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb5-55">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb5-56">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove background and outline</span></span>
<span id="cb5-57">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.padding =</span> grid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-58">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-59">  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#30DayChartChallenge 2022-04-02 Pictogram: Emojis and Standard Deviations"</span>,</span>
<span id="cb5-61">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"With apologies to everyone I present the &lt;i&gt;Emoji Standard Deviation Chart&lt;/i&gt;&lt;br&gt;Author: @charliejhadley"</span>,</span>
<span id="cb5-62">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb5-63">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-64"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-65">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arvo"</span>),</span>
<span id="cb5-66">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(),</span>
<span id="cb5-67">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-68">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>())</span>
<span id="cb5-69"></span>
<span id="cb5-70">gg_emoji_histogram <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-71">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gg_emoji_histogram.png"</span>),</span>
<span id="cb5-72">         .,</span>
<span id="cb5-73">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,</span>
<span id="cb5-74">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb5-75">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>)</span></code></pre></div>
</details>
</div>
<p>When I recovered this post in 2024 I remembered about <code>{geomtextpath}</code> for adding labels to curves and moved the title to bound the distribution:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geomtextpath"</span>)</span>
<span id="cb6-2"></span>
<span id="cb6-3">gg_emoji_histogram_fancy <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> data_emoji_positions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> stackpos)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb6-6">                  mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb6-7">                viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb6-9">                  mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb6-10">                viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb6-12">                  mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb6-13">                viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_dnorm_fill</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data,</span>
<span id="cb6-15">                  mean_of_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sd_of_data),</span>
<span id="cb6-16">                viridis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">viridis</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{emo::ji('grin')} represent &lt;span style='color:{viridis::viridis(5)[1]};font-weight:bold'&gt;68% of the data&lt;/span&gt;"</span>,</span>
<span id="cb6-18">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb6-19">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{emo::ji('confused')} represent &lt;span style='color:{viridis::viridis(5)[2]};font-weight:bold'&gt;95% of the data&lt;/span&gt;"</span>,</span>
<span id="cb6-20">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb6-21">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{emo::ji('fearful')} represent &lt;span style='color:{viridis::viridis(5)[3]};font-weight:bold'&gt;99.7% of the data&lt;/span&gt;"</span>,</span>
<span id="cb6-22">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb6-23">                                             <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{emo::ji('scream')} represent &lt;span style='color:{viridis::viridis(5)[4]};font-weight:bold'&gt;the rest of the data&lt;/span&gt;"</span>)),</span>
<span id="cb6-24">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label),</span>
<span id="cb6-25">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DM Sans"</span>,</span>
<span id="cb6-26">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.padding =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb6-27">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb6-28">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,</span>
<span id="cb6-29">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span>,</span>
<span id="cb6-30">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>,</span>
<span id="cb6-31">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_curve</span>(</span>
<span id="cb6-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(data_emoji_positions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb6-34">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend =</span> yend, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend =</span> xend),</span>
<span id="cb6-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x = 120, y = 10, xend = max(data_emoji_positions$x), yend = 1,</span></span>
<span id="cb6-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data = df,</span></span>
<span id="cb6-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"npc"</span>)),</span>
<span id="cb6-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">curvature =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb6-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span></span>
<span id="cb6-40">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-41">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_point() +</span></span>
<span id="cb6-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">115</span>,</span>
<span id="cb6-43">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,</span>
<span id="cb6-44">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yup, that's me. You're probably&lt;br&gt;wondering how I ended up in&lt;br&gt; this situation..."</span>),</span>
<span id="cb6-45">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> label),</span>
<span id="cb6-46">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>,</span>
<span id="cb6-47">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-48">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comic Sans MS"</span>,</span>
<span id="cb6-49">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.padding =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb6-50">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb6-51">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_richtext</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> emoji_symbol),</span>
<span id="cb6-53">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> data_emoji_positions,</span>
<span id="cb6-54">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb6-55">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>,</span>
<span id="cb6-56">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove background and outline</span></span>
<span id="cb6-57">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label.padding =</span> grid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pt"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-58">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_textpath</span>(</span>
<span id="cb6-59">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data = filter(data_emoji_positions, x &lt;= 100),</span></span>
<span id="cb6-60">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function"</span>, </span>
<span id="cb6-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>,</span>
<span id="cb6-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">86</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)},</span>
<span id="cb6-64">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#30DayChartChallenge 2022"</span>,</span>
<span id="cb6-65">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># family = "Comic Sans MS",</span></span>
<span id="cb6-66">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rich =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb6-67">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb6-68">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_textpath</span>(</span>
<span id="cb6-70">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># data = filter(data_emoji_positions, x &lt;= 100),</span></span>
<span id="cb6-71">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function"</span>, </span>
<span id="cb6-72">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb6-73">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-74">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x){<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">between</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">117</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">700</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)},</span>
<span id="cb6-75">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pictogram: Emojis and Standard Deviations"</span>,</span>
<span id="cb6-76">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comic Sans MS"</span>,</span>
<span id="cb6-77">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rich =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb6-78">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span></span>
<span id="cb6-79">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-80">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-81">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb6-82">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb6-83">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Author: @charliejhadley"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-84"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-85">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arvo"</span>),</span>
<span id="cb6-86">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_markdown</span>(),</span>
<span id="cb6-87">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb6-88">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb6-89">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot"</span>)</span>
<span id="cb6-90"></span>
<span id="cb6-91">gg_emoji_histogram_fancy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-92">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gg_emoji_histogram_fancy.png"</span>),</span>
<span id="cb6-93">         .,</span>
<span id="cb6-94">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,</span>
<span id="cb6-95">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb6-96">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>)</span></code></pre></div>
</details>
</div>
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-emoji-standard-deviation-chart/gg_emoji_histogram_fancy.png" class="img-fluid"></p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {From the Archive: {30DayChartChallenge} 2022 {Pictogram}},
  date = {2024-10-21},
  url = {https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-emoji-standard-deviation-chart},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“From the Archive: 30DayChartChallenge 2022
Pictogram.”</span> October 21, 2024. <a href="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-emoji-standard-deviation-chart">https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-emoji-standard-deviation-chart</a>.
</div></div></section></div> ]]></description>
  <category>Data visualisation</category>
  <category>30DayChartChallenge 2022</category>
  <guid>https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-emoji-standard-deviation-chart/</guid>
  <pubDate>Sun, 20 Oct 2024 23:00:00 GMT</pubDate>
</item>
<item>
  <title>From the archive: 30DayChartChallenge 2022 Waffles</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles/</link>
  <description><![CDATA[ 





<hr>
<p>This post has been rescued from a side-project blog that I’ve disposed of and slowly reposting content from. In this post I made this waffle chart:</p>
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles/cw_bechdel_waffles.png" class="img-fluid"></p>
<hr>
<p>This chart was built for the “Part-to-whole” prompt in the 2022 #30DayChartChallenge. I wanted to make a waffle chart and also experiment with combining multiple charts together, I’ve still not really committed to <code>{cowplot}</code> or <code>{patchwork}</code> and when I began 2022’s 30DayChartChallenge one of my big goals was to get stuck into comparing them. Although I didn’t get too far with that, it was still constructive to build this chart.</p>
<p>I’m very fond of the Bechdel dataset from <code>{fivethirtyeight}</code> so this was a simple choice for chart. If you don’t know, <code>knitr::kable()</code> is a really cheap way to make a Markdown table that looks fine in Quarto and RMarkdown:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fivethirtyeight)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3">bechdel_count_clean_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bechdel <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(clean_test)</span>
<span id="cb1-5"></span>
<span id="cb1-6">label_tests_vec <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nowomen"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No women in the movie"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notalk"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No talking between women"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"men"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Talk about men"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dubious"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dubiously passes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ok"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Passed the test!"</span>)</span>
<span id="cb1-7">label_tests_tib <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enframe</span>(label_tests_vec) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">clean_test =</span> name,</span>
<span id="cb1-9">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">test_label =</span> value)</span>
<span id="cb1-10"></span>
<span id="cb1-11"></span>
<span id="cb1-12">bechdel_count_clean_test <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bechdel <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(clean_test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(label_tests_tib) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">test_label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(test_label, n))</span>
<span id="cb1-16"></span>
<span id="cb1-17">bechdel_count_clean_test <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-18">  knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">clean_test</th>
<th style="text-align: right;">n</th>
<th style="text-align: left;">test_label</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ok</td>
<td style="text-align: right;">803</td>
<td style="text-align: left;">Passed the test!</td>
</tr>
<tr class="even">
<td style="text-align: left;">notalk</td>
<td style="text-align: right;">514</td>
<td style="text-align: left;">No talking between women</td>
</tr>
<tr class="odd">
<td style="text-align: left;">men</td>
<td style="text-align: right;">194</td>
<td style="text-align: left;">Talk about men</td>
</tr>
<tr class="even">
<td style="text-align: left;">dubious</td>
<td style="text-align: right;">142</td>
<td style="text-align: left;">Dubiously passes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nowomen</td>
<td style="text-align: right;">141</td>
<td style="text-align: left;">No women in the movie</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In 2022 it looked like <a href="https://github.com/hrbrmstr/waffle">{waffle}</a> package was the best for making waffle charts with {ggplot2}. I got side tracked thinking about the math behind making aesthetically pleasing but eventually settled on the most square possible chart via <code>round(sqrt(nrow(bechdel)))</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(waffle)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggpomological)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(hrbrthemes)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggtext)</span>
<span id="cb2-5">gg_waffle_bechdel <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bechdel_count_clean_test <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> test_label, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> n)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_waffle</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_rows =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(bechdel))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.33</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flip =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_equal</span>()</span>
<span id="cb2-9">gg_waffle_bechdel</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s beautify:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">bechdel_count_clean_test <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> test_label, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> n)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_waffle</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_rows =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(bechdel))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.33</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flip =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_pomological</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_equal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_enhance_waffle</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s do this by decade. Again, it was fun to experiment with different <code>n_rows()</code> values. It feels to me like the best option is to use prime factors of the decade with most observations, which became 7 * 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">bechdel_by_decade <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bechdel <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decade =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">floor</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">count</span>(decade, clean_test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sort =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(label_tests_tib) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">test_label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(test_label, n))</span>
<span id="cb4-6"></span>
<span id="cb4-7">bechdel_by_decade <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> clean_test, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> n)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_waffle</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_rows =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.33</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flip =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>decade, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_pomological</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_equal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_enhance_waffle</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>While that’s an interesting way to look at the data I abandoned this as I wanted something slightly more squarish for the eventual <code>{cowplot}</code> so I made a waffle per decade and added some title text.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">gg_bechdel_decade_prop <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bechdel_by_decade <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">test_label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_relevel</span>(test_label, label_tests_tib<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>test_label)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> test_label, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> n)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_waffle</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_rows =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.33</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flip =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">make_proportional =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>decade, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_ipsum</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{waffle} charts are pretty fun!"</span>,</span>
<span id="cb5-8">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb5-9">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;b&gt;Square waffles&lt;/b&gt;"</span>,</span>
<span id="cb5-10">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb5-11">                      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_wrap</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"For the squarest waffles use this code: round(sqrt(nrow(data))). It'd be fun if this was an optional argument for geom_waffle()"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb5-12">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb5-13">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;b&gt;Proportional Faceted waffles&lt;/b&gt;"</span>,</span>
<span id="cb5-14">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb5-15">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"With proportional faceting n_rows should be a factor of 10. If not proportional, it feels like the best option is finding prime factors for the largest group. Consider using numbers::primeFactors() for that"</span>,</span>
<span id="cb5-16">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb5-17">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;b&gt;Paragraphs of text&lt;/b&gt;"</span>,</span>
<span id="cb5-18">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span>,</span>
<span id="cb5-19">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"I've not really used {patchwork} or {cowplot} to add paragraphs of text. I'm always really impressed by folks who do have these nicely displayed summaries in their charts. So that's something I'm going to experiment with a lot this edition of #30DaysChartChallenge"</span>,</span>
<span id="cb5-20">                      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br&gt;"</span></span>
<span id="cb5-21">  )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_equal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_enhance_waffle</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb5-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot.subtitle = element_markdown(lineheight = 1.25, hjust = 0, size = 13),</span></span>
<span id="cb5-27">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_textbox_simple</span>(</span>
<span id="cb5-28">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb5-29">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">padding =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb5-30">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb5-31">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineheight =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span></span>
<span id="cb5-32">    ),</span>
<span id="cb5-33">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#242c28"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arvo"</span>))</span>
<span id="cb5-34"></span>
<span id="cb5-35">gg_bechdel_decade_prop</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These were then assembled together with <code>{cowplot}</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(cowplot)</span>
<span id="cb6-2"></span>
<span id="cb6-3">gg_bechdel_waffle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> bechdel_count_clean_test <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> test_label, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> n)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_waffle</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n_rows =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(bechdel))), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.33</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">flip =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_pomological</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_equal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_ipsum_rc</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grid=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_enhance_waffle</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>)</span>
<span id="cb6-12"></span>
<span id="cb6-13">cw_bechdel_waffles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_grid</span>(</span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggdraw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">draw_label</span>(</span>
<span id="cb6-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#30DayChartChallenge 2022-04-01 Part to Whole: Waffles and the Bechdel Test"</span>,</span>
<span id="cb6-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>,</span>
<span id="cb6-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb6-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb6-20">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb6-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb6-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Arvo"</span>)</span>
<span id="cb6-24">  ),</span>
<span id="cb6-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_grid</span>(gg_bechdel_waffle,</span>
<span id="cb6-26">  gg_bechdel_decade_prop,</span>
<span id="cb6-27">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb6-28">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rel_widths =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)),</span>
<span id="cb6-29">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb6-30">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rel_heights =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-31">)</span>
<span id="cb6-32"></span>
<span id="cb6-33">cw_bechdel_waffles <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggsave</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quarto_here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cw_bechdel_waffles.png"</span>),</span>
<span id="cb6-35">         .,</span>
<span id="cb6-36">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,</span>
<span id="cb6-37">         <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span></code></pre></div>
</div>
<p><img src="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles/cw_bechdel_waffles.png" class="img-fluid"></p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2024,
  author = {Hadley, Charlie},
  title = {From the Archive: {30DayChartChallenge} 2022 {Waffles}},
  date = {2024-10-21},
  url = {https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2024" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2024. <span>“From the Archive: 30DayChartChallenge 2022
Waffles.”</span> October 21, 2024. <a href="https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles">https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles</a>.
</div></div></section></div> ]]></description>
  <category>Data visualisation</category>
  <category>30DayChartChallenge 2022</category>
  <guid>https://visibledata.co.uk/posts/2024-10-21_30daychartchallenge-2022-waffles/</guid>
  <pubDate>Sun, 20 Oct 2024 23:00:00 GMT</pubDate>
</item>
<item>
  <title>How I learned to stop replicating everything from {xaringan} and love Quarto</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2022-08-04_how-i-learned-to-stop-replicating-everything-from-xaringan-and-love-quarto/</link>
  <description><![CDATA[ 




<p>Since the end of the rstudio::conf(2022) I’ve been working on replicating the <code>{xaringan}</code> RMarkdown presentation format in <code>{quarto}</code>. If you’ve never seen these slides before, here’s the self-documenting template from Yihui Xie (click inside the slides and use your arrow keys).</p>
<iframe src="https://slides.yihui.org/xaringan/#1" width="400px" height="350px">
</iframe>
<p>These slides are really quite beautiful. This blog post is about trying to replicate the letter box effect in Quarto. And - specifically - how I learned to stop trying to replicate it because <strong>I</strong> couldn’t [in a meaningful way]. I’d be very happy to be shown how to replicate it<sup>1</sup>.</p>
<p>I was very pleased to see that <a href="https://twitter.com/beamilz">Beatriz Milz</a> has already <a href="https://github.com/beatrizmilz/quarto-rladies-theme">ported the R-Ladies {xaringan} theme to Quarto</a>. I will follow up this post with another where I walk through how I’m implementing the default <code>{xaringan}</code> theme sans letterboxing, because I think there’s some useful things to point out.</p>
<section id="replicating-the-letterbox-effect" class="level2">
<h2 class="anchored" data-anchor-id="replicating-the-letterbox-effect">Replicating the letterbox effect</h2>
<p>This <a href="https://github.com/charliejhadley/xaringan-letterbox-quarto">repository</a> contains my attempt to replicate the letterbox affect. You can see the template slides below:</p>
<iframe src="https://charliejhadley.github.io/xaringan-letterbox-quarto/template#/title-slide" width="400px" height="350px">
</iframe>
<p>It looks like it works! There’s even the nice drop shadow. But extending it to fully replicate how <code>{xaringan}</code> wasn’t something I could figure out. This is the CSS I used to create the letterbox effect:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.quarto-light</span> {</span>
<span id="cb1-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">background-color</span>: <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#D8D8D3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-3">}</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.slides</span> {</span>
<span id="cb1-6">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">background-color</span>: <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#fff</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-7">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">border-width</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">px</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">px</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">px</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">px</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-8">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">border-style</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">solid</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-9">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">border-color</span>: <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">#fff</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-10">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">box-shadow</span>: <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgb(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">136</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">136</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">136</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">)</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">px</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">px</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">px</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">px</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb1-11">}</span></code></pre></div>
</div>
<p>Now let’s take a look at how the <code>reveal.js</code> format constructs slides:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;body</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">class</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"quarto-light"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span></span>
<span id="cb2-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;div</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">class</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slides"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span></span>
<span id="cb2-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;section</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">id</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title-slide"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;/section&gt;</span></span>
<span id="cb2-4">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;section</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">id</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hello-world"</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/section</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span></span>
<span id="cb2-5">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;section</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">id</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hello-ninja"</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/section</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span></span>
<span id="cb2-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;section</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">id</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"remark.js"</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/section</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span></span>
<span id="cb2-7">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;/div&gt;</span></span>
<span id="cb2-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;/div&gt;</span></span></code></pre></div>
</div>
<p>The grey background behind the slides is applied to the entire body element - which is fine! But notice that all slides are contained within one <code>&lt;div&gt;</code> element. This means we can’t supply a different background to individual slides. That’s a problem for trying to replicate <code>{xaringan}</code> because one of the most obvious features is that some slides have a different background colour - implemented through the <code>inverse</code> class.</p>
<p>In <code>{xaringan}</code> that makes sense because of how remark.js constructs slides (notice how the top slide (the title slide) has the <code>inverse</code> class):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;div</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">class</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"remark-slides-area"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span></span>
<span id="cb3-2">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;div</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">class</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"remark-slide-container inverse"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span></span>
<span id="cb3-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;div</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">class</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"remark-slide-scaler"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;&lt;/div&gt;</span></span>
<span id="cb3-4">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;/div&gt;</span></span>
<span id="cb3-5">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;div</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">class</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"remark-slide-container"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;</span></span>
<span id="cb3-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;div</span> <span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">class</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"remark-slide-scaler"</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&gt;&lt;/div&gt;</span></span>
<span id="cb3-7">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;/div&gt;</span></span>
<span id="cb3-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">&lt;/div&gt;</span></span></code></pre></div>
</div>
<p>I spent ages (and ages) experimenting with different CSS and SASS variables before I figured this out. I wish I’d have taken a step back and looked at how the HTML was constructed before spending so much time on this. But I did end up learning lots of things while trying and failing. I’ll document those findings in the next blogpost where I will completely ignore the letterboxing.</p>
<p>I did spend a little bit of time thinking about a complicated way to achieve this. It involved using JavaScript to add parent <code>&lt;div&gt;</code> elements to each <code>&lt;section&gt;</code> but my initial goal was to learn about Quarto extensions <strong>not</strong> JavaScript. Additionally, it became obvious that adding this letterbox effect broke the PDF printing of the presentation.</p>
<p>So unless anyone else comes up with a solution, this is how I learned to stop replicating everything from <code>{xaringan}</code> and love Quarto.</p>


</section>


<div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>However, take into account that any changes we make like this will break the print formatting of the slides. It might not be worth replicating the web look of {xaringan} if users cannot easily print the slides, as individually each presentation format does make slides that print well.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2022,
  author = {Charlie Hadley},
  title = {How {I} Learned to Stop Replicating Everything from
    \{Xaringan\} and Love {Quarto}},
  date = {2022-08-04},
  url = {https://visibledata.co.uk/posts/2022-08-04_how-i-learned-to-stop-replicating-everything-from-xaringan-and-love-quarto},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2022" class="csl-entry quarto-appendix-citeas">
Charlie Hadley. 2022. <span>“How I Learned to Stop Replicating
Everything from {Xaringan} and Love Quarto.”</span> August 4, 2022. <a href="https://visibledata.co.uk/posts/2022-08-04_how-i-learned-to-stop-replicating-everything-from-xaringan-and-love-quarto">https://visibledata.co.uk/posts/2022-08-04_how-i-learned-to-stop-replicating-everything-from-xaringan-and-love-quarto</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2022-08-04_how-i-learned-to-stop-replicating-everything-from-xaringan-and-love-quarto/</guid>
  <pubDate>Wed, 03 Aug 2022 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Creating an R-Ladies quarto format</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2022-07-29_creating-an-r-ladies-quarto-format/</link>
  <description><![CDATA[ 





<p>It’s the day after rstudio::conf(2022), and like many folks in the audience I’m very excited about the future of <code>{quarto}</code>. (LINKS). To help me better understand the differences between RMarkdown and quarto I decided I’d convert <a href="https://www.apreshill.com/project/rladies-xaringan/">Alison Hill’s R-Ladies {xaringan} theme</a> into a quarto <strong>format</strong></p>
<iframe src="https://www.apreshill.com/slides/rladies-demo-slides.html#1" width="400px" height="350px">
</iframe>
<p>However, what I realised is that first I needed to replicate the {xaringan} format as closely as possible in {quarto}.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.7     ✔ dplyr   1.0.9
✔ tidyr   1.2.0     ✔ stringr 1.4.0
✔ readr   2.1.2     ✔ forcats 0.5.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb5-2">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>feature, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>description,</span>
<span id="cb5-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Code chunk  appearance"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Different. Using accessibility features of quarto"</span></span>
<span id="cb5-4">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  feature                description                                      
  &lt;chr&gt;                  &lt;chr&gt;                                            
1 Code chunk  appearance Different. Using accessibility features of quarto</code></pre>
</div>
</div>
<section id="how-to-use-the-xaringan-quarto-theme" class="level1">
<h1>How to use the xaringan quarto theme</h1>
<p>In the RMarkdown universe we create <code>{xaringan}</code> slides by changing the <code>output</code> type of our RMarkdown document:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb7-1">---</span>
<span id="cb7-2">output:</span>
<span id="cb7-3">  xaringan::moon_reader</span>
<span id="cb7-4">---</span></code></pre></div>
<p>But in quarto, things are very different. Formats are made available as <a href="https://quarto.org/docs/extensions/formats.html">specific types of extensions</a>, which <strong>must be installed in each distinct project</strong>. You must therefore run this code in the Terminal (not the R console) in RStudio for each presentation you want to write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">quarto install extension rcharliejhadley<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>xaringan<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>quarto</span></code></pre></div>
</div>
<p>This will add the format to the <code>_extensions</code> folder and you can now create your slide deck with in a <code>.qmd</code> as follows:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb9-1">---</span>
<span id="cb9-2">title: Your awesome R-Ladies talk</span>
<span id="cb9-3">format: rladies-revealjs</span>
<span id="cb9-4">---</span></code></pre></div>
</section>
<section id="recreating-xaringan-in-quarto" class="level1">
<h1>Recreating <code>{xaringan}</code> in <code>{quarto}</code></h1>
<p>The new <code>{quarto}</code> system makes use of <code>reveal.js</code> for creating HTML slides, whereas <code>{xaringan}</code> uses <code>remark.js</code>. D<a href="https://twitter.com/charliejhadley/status/1553179086390009856?s=20&amp;t=7tThga5ITSGdLu3HXJolZw">espite these libraries sounding similar,</a> they’re very different. This means there’s a lot of styling that needs to be bought across into the new <code>xaringan-quarto</code> theme. But before we progress, let’s think about why we want to replicate the <code>{xaringan}</code> output type:</p>
<ul>
<li><p>{xaringan} slides look good!</p></li>
<li><p>{xaringan} has lots of nice features for formatting slides</p></li>
</ul>
<p>So in this new <code>{quarto}</code> format I want to replicate both the styles and the formatting features - as closely as possible, anyhow.</p>
<section id="adding-remark.js-dependency." class="level2">
<h2 class="anchored" data-anchor-id="adding-remark.js-dependency.">Adding remark.js dependency.</h2>
<p>It took me <strong>ages</strong> to figure out how to add a JavaScript dependency to a format. I eventually figured it out from looking at the <a href="https://github.com/quarto-ext/grouped-tabsets">grouped-tabsets extension</a>. These are the steps we need to go through:</p>
<ol type="1">
<li>We need to use a <code>.lua</code> file to add our dependencies, add a file called <code>remark-js.lua</code> into the <code>xaringan</code> folder. Within this file we’re going to add our dependency:</li>
</ol>
<pre class="verbatim"><code>Div = function(el)
  if quarto.doc.isFormat("html:js") then
    quarto.doc.addHtmlDependency({
        name = "remarkjs",
        scripts = {"remark-latest.min.js"}
      })
  end
end </code></pre>
<ol type="1">
<li><p>Add the <code>remark-latest.min.js</code> file to the <code>xaringan</code> folder. In the future I’ll figure out how to get the hosted file, but for now I copy pasted the contents of <a href="https://remarkjs.com/downloads/remark-latest.min.js" class="uri">https://remarkjs.com/downloads/remark-latest.min.js</a>.</p></li>
<li><p>In the <code>_extension.yml</code> file we need to add our lua dependency, as part of our format. To do so we need to <a href="https://quarto.org/docs/extensions/formats.html#common-metadata">use the <code>common</code> key</a>.</p></li>
</ol>
<pre class="verbatim"><code>contributes:
  formats:
    revealjs:
    common:
       filters:
           - remark-js.lua</code></pre>
</section>
<section id="adding-.scss-fles-to-formats" class="level2">
<h2 class="anchored" data-anchor-id="adding-.scss-fles-to-formats">Adding .scss fles to formats</h2>
<p>Now we’ve got the <code>remark.js</code> loaded we can move onto setting up the <code>{xaringan}</code> CSS styles. However, there’s a little trick to it. <code>{quarto}</code> makes use of <code>.scss</code> files intead of normal <code>.css</code> files, but that’s to our advantage. By using <code>.scss</code> files we can take advantage of <a href="https://quarto.org/docs/output-formats/html-themes.html#sass-variables">Bootstrap SASS variables</a> <a href="https://quarto.org/docs/output-formats/html-themes-more.html">which are very powerful</a>, but I’m not sure how much we’ll make use of them here.</p>
<p>When creating a <code>.scss</code> file we need to create at least one “layer boundary” otherwise we’ll get this error message:</p>
<pre class="verbatim"><code>ERROR: The file _extensions/xaringan/xaringan-default.scss doesn't contain at least one layer boundary (/*-- scss:defaults --*/, /*-- scss:rules --*/, /*-- scss:mixins --*/, /*-- scss:functions --*/, or /*-- scss:uses --*/)</code></pre>
<p>Here are the steps required to start-up our custom styling</p>
<ol type="1">
<li>Create a <code>xaringan-default.scss</code> file in the <code>xaringan</code> folder. We’ll set paragraph text to red so we can test it the styles are working:</li>
</ol>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/*-- scss:rules --*/</span></span>
<span id="cb13-2"></span>
<span id="cb13-3">p {</span>
<span id="cb13-4">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">color</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">red</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb13-5">}</span></code></pre></div>
<ol start="2" type="1">
<li>Update the <code>_extension.yml</code> file to make use of the <code>.scss</code> file</li>
</ol>
<pre class="verbatim"><code>contributes:
  formats:
    revealjs:
       theme: [default, xaringan-default.scss]
    common:
       filters:
           - remark-js.lua</code></pre>
</section>
<section id="adding-a-template-presentation" class="level2">
<h2 class="anchored" data-anchor-id="adding-a-template-presentation">Adding a template presentation</h2>
<p>It’s a good idea to add a template presentation file so folks know how to use the format. But it has another utility! We can render the template file within our RStudio project to continually test the theme without having to use the quarto cli.</p>
<p>So, let’s add <code>template.qmd</code> to the top-level directory of our project and some lorem ipsum text:</p>
<pre class="verbatim"><code>---
title: "Xarignan Slides"
format: xaringan-revealjs
---



## First slide

This paragraph text will be red!</code></pre>
<p>We’re now going to iteratively add/remove content to this template while we build up the theme.</p>
</section>
<section id="letter-boxing-and-slide-scaling" class="level2">
<h2 class="anchored" data-anchor-id="letter-boxing-and-slide-scaling">Letter-boxing and slide scaling</h2>
<p><code>{xaringan}</code> slides are very distinct because of the letter boxing affect from <code>remark.js</code>, and the size of the content rescales with the size of the browser windows. For a first attempt at replicating this, I’ve added <a href="80685b9a269530ce932f211024b5250d91b985a7">some CSS in this commit</a>. I also needed to add padding around the slide content, I’ve implemented this through the <a href="af09b15db3b1bba39ae18a96cb4bcc2e7f3e171e">border of the <code>&lt;div&gt;</code></a> but it’s likely not the best solution.</p>
<p>When it comes to replicating exactly how the slide aspect ratio changes, I’m not sure what to do. These are the <a href="https://quarto.org/docs/presentations/revealjs/advanced.html#presentation-size">options available for scaling the presentation size in <code>reveal.js</code></a> but at the moment I don’t understand how remark.js does its scaling, and so I can’t replicate it further.</p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<tbody>
<tr class="odd">
<td>Option</td>
<td>Description</td>
</tr>
<tr class="even">
<td><code>margin</code></td>
<td>Factor of the display size that should remain empty around the content (defaults to 0.1)</td>
</tr>
<tr class="odd">
<td><code>min-scale</code></td>
<td>Smallest possible scale to apply to content (defaults to 0.2)</td>
</tr>
<tr class="even">
<td><code>max-scale</code></td>
<td>Largest possible scale to apply to content (defaults to 2.0)</td>
</tr>
</tbody>
</table>
</section>
<section id="hello-world-slide" class="level2">
<h2 class="anchored" data-anchor-id="hello-world-slide">Hello world slide</h2>
<p>Let’s look at duplicating the styling of this slide from the <code>{xaringan</code>} template:</p>
<p><img src="https://visibledata.co.uk/posts/2022-07-29_creating-an-r-ladies-quarto-format/images/paste-C45D0768.png" class="img-fluid" width="335"></p>
<p>There are four thing to look at:</p>
<ul>
<li><p>Code chunk and in-line code formatting</p></li>
<li><p>Text and link formatting</p></li>
<li><p>Incremental bullet points</p></li>
<li><p>Footnotes</p></li>
</ul>
<section id="code-chunk-formatting" class="level3">
<h3 class="anchored" data-anchor-id="code-chunk-formatting">Code chunk formatting</h3>
<p>In <code>{xaringan}</code> the code chunk formatting is very flat. I’m choosing to deliberately use <code>{quarto}</code> code formatting as it improves accessibility and provides further customisation for formats that build on <code>xaringan-quarto</code> and for individual preferences. In the <code>_extension.yml</code> I’ve activated the github highlighting style.</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb16-1">contributes:</span>
<span id="cb16-2">  formats:</span>
<span id="cb16-3">    revealjs:</span>
<span id="cb16-4">       theme: [default, xaringan-default.scss, xaringan-default-fonts.scss]</span>
<span id="cb16-5">       highlight-style: github</span>
<span id="cb16-6">       </span></code></pre></div>
<p>You could use this YAML option for customising all code chunks or individual chunks. The documentation explains how to <a href="https://quarto.org/docs/output-formats/html-code.html#appearance">completely customise chunk appearance</a> and <a href="https://quarto.org/docs/output-formats/html-code.html#custom-highlighting">syntax highlighting</a>.</p>
<p>Now let’s look at the inline code formatting. In the original <code>xaringan</code> format this text is the same colour as paragraph text but printed in a mono spaced font. In this first alpha release of the format <a href="c16571511f3bb5cc9a4647f7db5398a86bd8077f">I’ve chosen to change this to purple</a>, but this probably won’t be popular.</p>
</section>
<section id="text-and-link-formatting" class="level3">
<h3 class="anchored" data-anchor-id="text-and-link-formatting">Text and link formatting</h3>
<p>We’re going to use the SASS <code>link-color</code> variable to change the colour of hyperlinks, but remember this must be placed in the defaults layer of the .scss file.</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb17-1">/*-- scss:defaults --*/</span>
<span id="cb17-2">$link-color: rgb(249, 38, 114);</span></code></pre></div>
<p>In <code>{xaringan}</code> the paragraph text is set to 20px, setting the <code>$presentation-font-size-root</code> to 28px in the .scss results in slides that scale similarly to {xaringan} slides.</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb18-1">$presentation-font-size-root: 28px;</span></code></pre></div>
<p>With <code>{xaringan}</code> we’re free to use whatever level of heading we like for slides. In fact, it’s fairly common to use lower-level headings for longer slide titles. But, in <code>{quarto}</code> we can <strong>only start slides with level 2 headings</strong>. I’ve taken the heading sizes from <code>{xaringan}</code> and added them to the styles:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb19-1">$heading2Size: 55px;</span>
<span id="cb19-2">$heading3Size: 45px;</span>
<span id="cb19-3">$heading4Size: 35px;</span></code></pre></div>
<p>Note that these are still scaled with the size of the browser window.</p>
</section>
<section id="incremental-bullet-points" class="level3">
<h3 class="anchored" data-anchor-id="incremental-bullet-points">Incremental bullet points</h3>
<p>In <code>{xaringan}</code> we can make anything incremental with two dashes, eg <code>--</code>. But in the <code>{quarto}</code> <code>reveal.js</code> format we need to create a <code>&lt;div&gt;</code> using the incremental class. There’s two ways of doing this, either with explicit <code>&lt;div&gt;&lt;/div&gt;</code> tags or with matching pairs of <code>:::</code>.</p>
</section>
<section id="footnotes" class="level3">
<h3 class="anchored" data-anchor-id="footnotes">Footnotes</h3>
<p>In {quarto} we use <code>^[footnote text]</code> notation to add footnotes that are then numbered at the bottom of the slide. In my opinion, the default styling for quarto is better than <code>{xaringan}</code> so I’m sticking with it.</p>
</section>
</section>
</section>
<section id="old-dragons" class="level1">
<h1>OLD DRAGONS</h1>
<p>In this blogpost I’ll first explain how to use the R-Ladies quaro presentation format and then <a href="doo">how to build your own quarto formats</a>.</p>
<section id="how-to-use-the-rladies-quarto-theme" class="level3">
<h3 class="anchored" data-anchor-id="how-to-use-the-rladies-quarto-theme">How to use the rladies quarto theme</h3>
<p>In the RMarkdown universe the R-Ladies {xaringan} theme is selected by changing the <code>css</code> option in the YAML header</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb20-1">---</span>
<span id="cb20-2">output:</span>
<span id="cb20-3">  xaringan::moon_reader:</span>
<span id="cb20-4">    css: ["default", "rladies", "rladies-fonts"]</span>
<span id="cb20-5">---</span></code></pre></div>
<p>But in quarto, things are very different. Formats are made available as <a href="https://quarto.org/docs/extensions/formats.html">specific types of extensions</a>, which <strong>must be installed in each distinct project</strong>. You must therefore run this code in the Terminal (not the R console) in RStudio for each presentation you want to write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">quarto install extension r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ladies<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>ladies<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>quarto</span></code></pre></div>
</div>
<p>This will add the format to the <code>_extensions</code> folder and you can now create your slide deck with in a <code>.qmd</code> as follows:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb22-1">---</span>
<span id="cb22-2">title: Your awesome R-Ladies talk</span>
<span id="cb22-3">format: rladies-revealjs</span>
<span id="cb22-4">---</span></code></pre></div>
</section>
<section id="how-to-build-your-own-theme" class="level3">
<h3 class="anchored" data-anchor-id="how-to-build-your-own-theme">How to build your own theme</h3>
<p>There is some <a href="https://quarto.org/docs/extensions/formats.html">existing documentation for building your own formats</a> and folder structure is extremely important. The minimum specification for an extension requires you to create an <code>_extension.yml</code> file nested as follows:</p>
<div class="sourceCode" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb23-1">rladies-quarto/</span>
<span id="cb23-2">              _extensions/</span>
<span id="cb23-3">                          rladies/</span>
<span id="cb23-4">                                  _extension.yml</span></code></pre></div>
<p>This extension will be called <code>rladies</code> because of the folder name <code>rladies</code>. Inside of the <code>_extension.yml</code> file we then specify that the extension contributes a format based on the <code>revealjs</code> presentation format using the default theme, note that there are <a href="https://quarto.org/docs/presentations/revealjs/themes.html">11 built-in revealjs themes available</a>.</p>
<div class="sourceCode" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb24-1">contributes:</span>
<span id="cb24-2">  formats:</span>
<span id="cb24-3">    revealjs:</span>
<span id="cb24-4">       theme: default</span></code></pre></div>
<p>We can add some metadata about the extension, and we can make use of <a href="https://quarto.org/docs/reference/formats/presentations/revealjs.html">any of the <code>revealjs</code> options</a>.</p>
<div class="sourceCode" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb25-1">title: RLadies quarto Presentation</span>
<span id="cb25-2">author: Charlotte Hadley</span>
<span id="cb25-3">version: 0.0.1</span>
<span id="cb25-4">contributes:</span>
<span id="cb25-5">  formats:</span>
<span id="cb25-6">    revealjs:</span>
<span id="cb25-7">       theme: default</span>
<span id="cb25-8">       incremental: true</span></code></pre></div>
<p>It’s now time to add our custom styles. This is achieved using <code>.scss</code> files instead of ordinary <code>.css</code> files, thanks to <code>quarto</code> making use of <a href="https://quarto.org/docs/output-formats/html-themes.html#sass-variables">Bootstrap SASS variables</a>. There are two steps:</p>
<ul>
<li>Add the <code>.scss</code> file to the <code>theme</code> option in the <code>_extension.yml</code> file</li>
</ul>
<div class="sourceCode" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb26-1">title: RLadies quarto Presentation</span>
<span id="cb26-2">author: Charlotte Hadley</span>
<span id="cb26-3">version: 0.0.1</span>
<span id="cb26-4">contributes:</span>
<span id="cb26-5">  formats:</span>
<span id="cb26-6">    revealjs:</span>
<span id="cb26-7">       theme: [default, rladies.scss]</span>
<span id="cb26-8">       incremental: true</span></code></pre></div>
<ul>
<li>Add styles to your <code>.scss</code> file that you can easily test</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb27-1">$body-color<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> red;</span></code></pre></div>
<style type="text/css">
$body-color: red;
</style>
</div>
<p>Let’s kill two birds with one stone by creating a template slide deck that we can also use to test our <code>.scss</code> styles. At the top level of the project add a new file called <code>template.qmd</code> and set the format as <code>rladies-revealjs</code> and click the Render button, if everything is working you’ll see a slide deck with red text.</p>
<div class="sourceCode" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb28-1">---</span>
<span id="cb28-2">title: "R-Ladies Xarignan Theme"</span>
<span id="cb28-3">format: rladies-revealjs</span>
<span id="cb28-4">---</span>
<span id="cb28-5"></span>
<span id="cb28-6">Test</span></code></pre></div>
<section id="replicating-alison-hills-theme-css" class="level4">
<h4 class="anchored" data-anchor-id="replicating-alison-hills-theme-css">Replicating Alison Hill’s theme CSS</h4>
</section>
<section id="slide-background-color" class="level4">
<h4 class="anchored" data-anchor-id="slide-background-color">slide background color</h4>
<p>I tried to change the background color with the scss file, but it only changes the background of the slide content.</p>
<div class="sourceCode" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb29-1"># .scss file</span>
<span id="cb29-2">.inverse {</span>
<span id="cb29-3">  data-background: #562457;</span>
<span id="cb29-4">}</span>
<span id="cb29-5"></span>
<span id="cb29-6"># presentation</span>
<span id="cb29-7">::: {.inverse}</span></code></pre></div>
<p><img src="https://visibledata.co.uk/posts/2022-07-29_creating-an-r-ladies-quarto-format/images/paste-3DDD0D0F.png" class="img-fluid" width="428"></p>
<p>Confusingly, if we set the <code>data-background</code> attribute within the {} then it does work</p>


</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2022,
  author = {Hadley, Charlie},
  title = {Creating an {R-Ladies} Quarto Format},
  date = {2022-06-20},
  url = {https://visibledata.co.uk/posts/2022-07-29_creating-an-r-ladies-quarto-format},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2022" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2022. <span>“Creating an R-Ladies Quarto
Format.”</span> June 20, 2022. <a href="https://visibledata.co.uk/posts/2022-07-29_creating-an-r-ladies-quarto-format">https://visibledata.co.uk/posts/2022-07-29_creating-an-r-ladies-quarto-format</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2022-07-29_creating-an-r-ladies-quarto-format/</guid>
  <pubDate>Sun, 19 Jun 2022 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Overriding individual code chunk options</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2022-06-20_overriding-individual-code-chunk-options/</link>
  <description><![CDATA[ 





<p>I’ve just moved this entire blog from <code>{blogdown}</code> to <code>{quarto}</code>. It was mostly simple but for one of the blogposts I really wanted a way to override individual code chunk options. Let’s make a toy .Rmd document to demonstrate this:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1">---</span>
<span id="cb1-2">output: html_document</span>
<span id="cb1-3">---</span>
<span id="cb1-4">  </span>
<span id="cb1-5">```{r setup, include=FALSE}</span>
<span id="cb1-6">knitr::opts_chunk$set(echo = TRUE, eval=FALSE)</span>
<span id="cb1-7">```</span>
<span id="cb1-8"></span>
<span id="cb1-9"></span>
<span id="cb1-10">This code chunk has `eval=TRUE` which I want to override</span>
<span id="cb1-11"></span>
<span id="cb1-12">```{r, eval=TRUE}</span>
<span id="cb1-13">2 + 2</span>
<span id="cb1-14">```</span></code></pre></div>
<ul>
<li><p>The default behaviour for code chunks is set in the <code>setup</code> chunk as <code>eval=FALSE</code></p></li>
<li><p>There’s an individual code chunk with <code>eval=TRUE</code></p></li>
<li><p>I want to <strong>override</strong> the individual code chunk behaviour.</p></li>
</ul>
<p>I tweeted about this and <a href="https://twitter.com/grrrck/status/1538925669756944384?s=20&amp;t=2Wh8cPaoSIgCwhD7yxUlOg">Garrick Aden-Buie replied</a> linking me to the documentation for option hooks. I was really pleased to then figure out this solution:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb2-1">---</span>
<span id="cb2-2">output: html_document</span>
<span id="cb2-3">---</span>
<span id="cb2-4"></span>
<span id="cb2-5">```{r setup, include=FALSE}</span>
<span id="cb2-6">knitr::opts_hooks$set(force_not_eval = function(value) {</span>
<span id="cb2-7">  value$eval &lt;- FALSE</span>
<span id="cb2-8">  value</span>
<span id="cb2-9">}</span>
<span id="cb2-10">)</span>
<span id="cb2-11">knitr::opts_chunk$set(force_not_eval = TRUE)</span>
<span id="cb2-12">```</span>
<span id="cb2-13"></span>
<span id="cb2-14">```{r, eval=TRUE}</span>
<span id="cb2-15">2 + 2</span>
<span id="cb2-16">```</span></code></pre></div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2022,
  author = {Hadley, Charlie},
  title = {Overriding Individual Code Chunk Options},
  date = {2022-06-20},
  url = {https://visibledata.co.uk/posts/2022-06-20_overriding-individual-code-chunk-options},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2022" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2022. <span>“Overriding Individual Code Chunk
Options.”</span> June 20, 2022. <a href="https://visibledata.co.uk/posts/2022-06-20_overriding-individual-code-chunk-options">https://visibledata.co.uk/posts/2022-06-20_overriding-individual-code-chunk-options</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2022-06-20_overriding-individual-code-chunk-options/</guid>
  <pubDate>Sun, 19 Jun 2022 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Writing verbatim SQL in pipe chains using {dbplyr}</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2022-06-15_verbatim-sql-in-dbplyr-pipe-chains/</link>
  <description><![CDATA[ 




<p>I’ve been trying to use the <a href="https://dbplyr.tidyverse.org/"><code>{dbplyr}</code></a> package when working with SQL and R. It provides a really nice interface for writing tidyverse code against a database connection. I feel that <code>{dbplyr}</code> gives a generally nice interface than using <code>{DBI}</code> which is the approach used in <a href="https://db.rstudio.com">db.rstudio.com</a>, but it’s under documented.</p>
<p>Here’s a comparison of code using <code>{DBI}</code> and <code>{dbplyr}</code></p>
<ul>
<li>Using <code>{dbplyr}</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fivethirtyeight)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dbplyr)</span>
<span id="cb1-4"></span>
<span id="cb1-5">bechdel_tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memdb_frame</span>(bechdel, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bechdel"</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7">bechdel_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(clean_test) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb1-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_budget_2013 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(budget_2013))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [5 x 2]
# Database: sqlite 3.38.5 [:memory:]
  clean_test mean_budget_2013
  &lt;chr&gt;                 &lt;dbl&gt;
1 dubious           59202525.
2 men               45896513.
3 notalk            57963237.
4 nowomen           51891839.
5 ok                44990138.</code></pre>
</div>
</div>
<ul>
<li>Using <code>{DBI}</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(fivethirtyeight)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(DBI)</span>
<span id="cb3-4"></span>
<span id="cb3-5">con <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbConnect</span>(RSQLite<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SQLite</span>(), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":memory:"</span>)</span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">copy_to</span>(con, bechdel, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bechdel"</span>)</span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl</span>(con, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bechdel"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(clean_test) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean_budget_2013 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(budget_2013))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [5 x 2]
# Database: sqlite 3.38.5 [:memory:]
  clean_test mean_budget_2013
  &lt;chr&gt;                 &lt;dbl&gt;
1 dubious           59202525.
2 men               45896513.
3 notalk            57963237.
4 nowomen           51891839.
5 ok                44990138.</code></pre>
</div>
</div>
<p>Now, that’s great for when we want to write new queries. But I wanted to go in the other direction. There’s lots of existing SQL code that I don’t want to re-write into R code, so it would be nice to write verbatim SQL within the pipe syntax. I couldn’t figure it out from the documentation so asked the question on Twitter, and as is often the case <a href="https://twitter.com/grrrck">Garrick Aden-Buie</a> gave me the solution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">tweetrmd<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tweet_embed</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://twitter.com/grrrck/status/1537082896124616705"</span>)</span></code></pre></div>
<div class="cell-output-display">
<blockquote class="twitter-tweet blockquote" data-width="550" data-lang="en" data-dnt="true" data-theme="light"><p lang="en" dir="ltr">if `bechdel_con` is a connection object then you can<br><br>library(dbplyr)<br>bechdel_con %&gt;% tbl(sql("SELECT title FROM bechdel"))<br><br>if `bechdel_tbl` is a remote tibble then you can<br>bechdel_tbl %&gt;%<br>  remote_con() %&gt;%<br>  tbl("SELECT title FROM bechdel")</p>— Garrick Aden-Buie (@grrrck) <a href="https://twitter.com/grrrck/status/1537082896124616705?ref_src=twsrc%5Etfw">June 15, 2022</a></blockquote>

</div>
</div>
<p>Let’s write that into a code chunk:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">bechdel_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remote_con</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sql</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT `clean_test`, AVG(`budget_2013`) AS `mean_budget_2013`</span></span>
<span id="cb6-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">FROM `bechdel`</span></span>
<span id="cb6-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">WHERE (`year` &lt; 2000.0)</span></span>
<span id="cb6-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">GROUP BY `clean_test`"</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [5 x 2]
# Database: sqlite 3.38.5 [:memory:]
  clean_test mean_budget_2013
  &lt;chr&gt;                 &lt;dbl&gt;
1 dubious           59202525.
2 men               45896513.
3 notalk            57963237.
4 nowomen           51891839.
5 ok                44990138.</code></pre>
</div>
</div>
<p>Note that we’re still connected to the database here. If we want to return a local tibble we need to use <code>collect()</code> which means our entire workflow is as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">bechdel_tbl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">memdb_frame</span>(bechdel, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bechdel"</span>)</span>
<span id="cb8-2"></span>
<span id="cb8-3">bechdel_tbl <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remote_con</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tbl</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sql</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SELECT `clean_test`, AVG(`budget_2013`) AS `mean_budget_2013`</span></span>
<span id="cb8-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">FROM `bechdel`</span></span>
<span id="cb8-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">WHERE (`year` &lt; 2000.0)</span></span>
<span id="cb8-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">GROUP BY `clean_test`"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">collect</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  clean_test mean_budget_2013
  &lt;chr&gt;                 &lt;dbl&gt;
1 dubious           59202525.
2 men               45896513.
3 notalk            57963237.
4 nowomen           51891839.
5 ok                44990138.</code></pre>
</div>
</div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2022,
  author = {Charlie Hadley},
  title = {Writing Verbatim {SQL} in Pipe Chains Using \{Dbplyr\}},
  date = {2022-06-15},
  url = {https://visibledata.co.uk/posts/2022-06-15_verbatim-sql-in-dbplyr-pipe-chains},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2022" class="csl-entry quarto-appendix-citeas">
Charlie Hadley. 2022. <span>“Writing Verbatim SQL in Pipe Chains Using
{Dbplyr}.”</span> June 15, 2022. <a href="https://visibledata.co.uk/posts/2022-06-15_verbatim-sql-in-dbplyr-pipe-chains">https://visibledata.co.uk/posts/2022-06-15_verbatim-sql-in-dbplyr-pipe-chains</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2022-06-15_verbatim-sql-in-dbplyr-pipe-chains/</guid>
  <pubDate>Tue, 14 Jun 2022 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Shiny modules to reduce duplication in apps</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2019-07-09-shiny-modules-to-reduce-duplication-in-apps/</link>
  <description><![CDATA[ 





<p>Shiny apps are awesome, with a bit of training you can build fairly impressive interactive web apps. But at some point, the subject of “shiny modules” will rear its head.</p>
<p>When I started learning modules, I found most of the existing <a href="http://shiny.rstudio.com/articles/modules.html">articles</a> focus on the technical-side of things and don’t focus on the <strong>benefits of using modules</strong> - they can significantly simplify and improve your apps.</p>
<p>I’m going to put together a few different tutorials on real-world Shiny apps and how modules can be used to improve them. As these tutorials develop I’ll link to them below.</p>
<p>But for now, we’re going to build this Shiny app:</p>
<div class="row">
<div class="col-sm-5">
<center>
<img src="https://visibledata.co.uk/posts/2019-07-09-shiny-modules-to-reduce-duplication-in-apps/shiny-app-wireframe.png" alt="Wireframe for shiny app" width="300px">
</center>
</div>
<div class="col-sm-7">
<ul>
<li><p>The shiny app displays data from the <code>WDI</code> package</p></li>
<li><p>Each “page” of the Shiny app details a different “development indicator” from the <code>WDI</code> package</p></li>
<li><p>Users select a country of interest from a pull-down menu</p></li>
<li><p>The chart, text and table underneath the pull-down menu all update when a country is selected</p></li>
<li><p>The charts, text and tables are <strong>the same on each page</strong> except for two variables; the selected country and the indicator detailed on that page.</p></li>
</ul>
</div>
</div>
<section id="how-to-use-this-tutorial" class="level3">
<h3 class="anchored" data-anchor-id="how-to-use-this-tutorial">How to use this tutorial</h3>
<p>It’s often useful to skim read through a tutorial before attempting to run the code on your own machine. If you do want to follow along with the code, you will need to install the <code>{usethis}</code> package before starting.</p>
<p>This tutorial is split into</p>
<ul>
<li><p>Shiny app without modules</p></li>
<li><p>Shiny app</p></li>
</ul>
</section>
<section id="shiny-app-without-modules" class="level3">
<h3 class="anchored" data-anchor-id="shiny-app-without-modules">Shiny app without modules</h3>
<p>The module-free version of the Shiny app can be downloaded onto your machine by running this code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">usethis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">use_course</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://github.com/charliejhadley/training_shiny-module/raw/master/wdi_indicators_modules/01_without-modules.zip"</span>)</span></code></pre></div>
</div>
<p>Once the RStudio project has opened, let’s take a look at the structure of the <code>ui.R</code> file in the app:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">countries_list <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(...)</span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">navbarPage</span>(</span>
<span id="cb2-4">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WDI"</span>,</span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(</span>
<span id="cb2-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Internet"</span>,</span>
<span id="cb2-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(</span>
<span id="cb2-8">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selectInput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"internet_country"</span>,</span>
<span id="cb2-9">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">choices =</span> countries_list),</span>
<span id="cb2-10">      ...</span>
<span id="cb2-11">    )</span>
<span id="cb2-12">  ),</span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(</span>
<span id="cb2-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bank branches"</span>,</span>
<span id="cb2-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(</span>
<span id="cb2-16">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selectInput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bank_branches_country"</span>,</span>
<span id="cb2-17">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">choices =</span> countries_list),</span>
<span id="cb2-18">      ...</span>
<span id="cb2-19">    )</span>
<span id="cb2-20">  ),</span>
<span id="cb2-21">  ...</span>
<span id="cb2-22">)</span></code></pre></div>
</div>
<p>We’re essentailly duplicating the same <code>selectInput()</code> in each of our <code>tabPanel()</code>s. If there were <em>many</em> controls being repeated we could make an argument for using modules from this file alone.</p>
<p>Let’s take a look at the <code>server.R</code> file of this app:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(input, output, session){</span>
<span id="cb3-2">  </span>
<span id="cb3-3">  output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>internet_timeline <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderPlot</span>({</span>
<span id="cb3-4">    </span>
<span id="cb3-5">    wdi_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-6">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_wdi_indicator_timeline</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>internet_country,</span>
<span id="cb3-7">                                ...)</span>
<span id="cb3-8">    </span>
<span id="cb3-9">  })</span>
<span id="cb3-10">  </span>
<span id="cb3-11">  output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>internet_comparison_table <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderUI</span>({</span>
<span id="cb3-12">    </span>
<span id="cb3-13">    ranking_table <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wdi_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>internet_country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-15">    </span>
<span id="cb3-16">    ranking_table <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-17">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">datatable</span>()</span>
<span id="cb3-18">        </span>
<span id="cb3-19">  })</span>
<span id="cb3-20">  </span>
<span id="cb3-21">  output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>bank_branches_timeline <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderPlot</span>({</span>
<span id="cb3-22">    </span>
<span id="cb3-23">    wdi_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_wdi_indicator_timeline</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>bank_branches_country,</span>
<span id="cb3-25">                              ...)</span>
<span id="cb3-26">    </span>
<span id="cb3-27">  })</span>
<span id="cb3-28">  </span>
<span id="cb3-29">  output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>bank_branches_comparison_table <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderUI</span>({</span>
<span id="cb3-30">    </span>
<span id="cb3-31">    ranking_table <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wdi_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-32">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>bank_branches_country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-33">    ...</span>
<span id="cb3-34">    </span>
<span id="cb3-35">    ranking_table <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-36">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">datatable</span>(...)</span>
<span id="cb3-37">        </span>
<span id="cb3-38">  })</span>
<span id="cb3-39">  </span>
<span id="cb3-40">}</span></code></pre></div>
</div>
<p>There’s a lot of duplication in this file. If we wanted to add a new tab about the number of secondary school students, we would have to add all of the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## ui.R</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(</span>
<span id="cb4-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Secondary schools"</span>,</span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(</span>
<span id="cb4-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">selectInput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secondary_schools_country"</span>,</span>
<span id="cb4-6">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">choices =</span> countries_list),</span>
<span id="cb4-7">    ...</span>
<span id="cb4-8">  )</span>
<span id="cb4-9">)</span>
<span id="cb4-10"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## server.R</span></span>
<span id="cb4-11">output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>secondary_schools_timeline <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderPlot</span>({</span>
<span id="cb4-12">  </span>
<span id="cb4-13">  wdi_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_wdi_indicator_timeline</span>(input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>secondary_schools_country,</span>
<span id="cb4-15">                              ...)</span>
<span id="cb4-16">  </span>
<span id="cb4-17">})</span>
<span id="cb4-18"></span>
<span id="cb4-19">output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>secondary_schools_comparison_table <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderUI</span>({</span>
<span id="cb4-20">  </span>
<span id="cb4-21">  ranking_table <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> wdi_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(country <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>secondary_schools_country) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-23">    ...</span>
<span id="cb4-24">  </span>
<span id="cb4-25">  ranking_table <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-26">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">datatable</span>(...)</span>
<span id="cb4-27">  </span>
<span id="cb4-28">})</span></code></pre></div>
</div>
<p>Let’s breakdown the advantages to re-writing this app to use modules.</p>
<section id="what-would-be-the-benefits-of-switching-to-use-modules" class="level4">
<h4 class="anchored" data-anchor-id="what-would-be-the-benefits-of-switching-to-use-modules">What would be the benefits of switching to use modules?</h4>
<ul>
<li><p>Without modules, if we wanted to change the look of the “comparison tables” we would need to do that X times - once for each <code>output$*_comparison_table</code> object.<br> Modules therefore help reduce transcription or copy/paste errors.</p></li>
<li><p>Modules will allow us to change the</p></li>
<li><p>Modules will reduce script file length, making the code easier to read and understand</p></li>
<li><p>Currently, if we wanted to change</p></li>
</ul>
<p>If we needed to add another tab to our</p>
<p>Each time we add a new tab to our shiny app, we’ll need to create a new pair of <code>render*()</code> functions and corresponding inputs in the <code>ui.R</code> file.</p>
<p>By re-designing our app to use modules, we’ll benefit from the following:</p>
<ul>
<li>Reduced script file lenght, improving readability</li>
<li>Simpler feature updates, changing the module code will update all pages at once.</li>
</ul>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2019,
  author = {Hadley, Charlie},
  title = {Shiny Modules to Reduce Duplication in Apps},
  date = {2019-07-09},
  url = {https://visibledata.co.uk/posts/2019-07-09-shiny-modules-to-reduce-duplication-in-apps},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2019" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2019. <span>“Shiny Modules to Reduce Duplication in
Apps.”</span> July 9, 2019. <a href="https://visibledata.co.uk/posts/2019-07-09-shiny-modules-to-reduce-duplication-in-apps">https://visibledata.co.uk/posts/2019-07-09-shiny-modules-to-reduce-duplication-in-apps</a>.
</div></div></section></div> ]]></description>
  <category>shiny</category>
  <guid>https://visibledata.co.uk/posts/2019-07-09-shiny-modules-to-reduce-duplication-in-apps/</guid>
  <pubDate>Mon, 08 Jul 2019 23:00:00 GMT</pubDate>
  <media:content url="https://visibledata.co.uk/posts/2019-07-09-shiny-modules-to-reduce-duplication-in-apps/shiny-app-wireframe.png" medium="image" type="image/png" height="125" width="144"/>
</item>
<item>
  <title>Shiny modules for useful controls</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2019-03-25-shiny-modules-for-useful-controls/</link>
  <description><![CDATA[ 





<p><a href="https://shiny.rstudio.com/articles/modules.html">Shiny Modules</a> are an “advanced” feature of Shiny apps that developers can use to reduce code duplication, simplify complex inter-relating controls, allow UI elements to be compartmentalised into R packages… and generally be a Shiny magician.</p>
<p>Much of the stuff written about modules gets lost in the weeds. We’re not going to do that here. We’re going to make the Shiny app I’ve embedded below (as an iframe), both with and without modules.</p>
<iframe width="100%" height="550px" scrolling="no" frameborder="yes" src="https://visibledata.shinyapps.io/shiny-with-modules_gg_ma_timeseries/">
</iframe>
<p>This app is slightly complicated, but deliberately so. I want to give you a real world example of using Shiny modules.</p>
<p>We’ll go through the following steps:</p>
<ol type="1">
<li><p>Data import and wrangling</p></li>
<li><p>server.R skeleton</p></li>
<li><p><code>gg_ma_timeseries()</code></p></li>
</ol>
<section id="how-to-follow-along" class="level2">
<h2 class="anchored" data-anchor-id="how-to-follow-along">How to follow along</h2>
<p>To follow along you are advised to <strong>create a new RStudio Project</strong> and create the files detailed below in turn.</p>
</section>
<section id="whats-the-app" class="level2">
<h2 class="anchored" data-anchor-id="whats-the-app">What’s the app?</h2>
<p>The app allows the viewer to interact with data from the <a href="https://ilabour.oii.ox.ac.uk/online-labour-index/">Online Labour Index</a>. This is a project undertaken by the University of Oxford’s Internet Institute to study the online labour market, and ultimately to provide an economic indicator for the gig economy. The data is deposited on Figshare, which means anyone can access (and importantly, cite) the data with the following DOI: <a href="https://doi.org/10.6084/m9.figshare.3761562">10.6084/m9.figshare.3761562</a>.</p>
</section>
<section id="data-import-wrangling-and-stuff" class="level2">
<h2 class="anchored" data-anchor-id="data-import-wrangling-and-stuff">Data import, wrangling and stuff</h2>
<p>Let’s completely ignore the details of accessing and wrangling the data. This is a tutorial on Shiny modules.</p>
<p>Create yourself a new script file called <code>data-processing.R</code> and insert this code. Please note that when this script is run it will download a dataset that in early 2019 is 37Mb in size, this will double every 3 years<sup>1</sup>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## This code should be inserted into your data-processing.R script</span></span>
<span id="cb1-2">fs_deposit_id <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3761562</span></span>
<span id="cb1-3">deposit_details <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fs_details</span>(fs_deposit_id)</span>
<span id="cb1-4"></span>
<span id="cb1-5">deposit_details <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(deposit_details<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>files)</span>
<span id="cb1-6">deposit_details <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">split</span>(deposit_details, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(deposit_details)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stringsAsFactors =</span> F)</span>
<span id="cb1-8"></span>
<span id="cb1-9">imported_country_group_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> deposit_details <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bcountrydata_"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(download_url) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">timestamp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_date</span>(timestamp)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> timestamp)</span>
<span id="cb1-15"></span>
<span id="cb1-16">gigs_by_country_group <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> imported_country_group_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(date, country_group) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">jobs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(count)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb1-20"></span>
<span id="cb1-21">gigs_by_occupation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> imported_country_group_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(date, occupation) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">count =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(count)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">jobs =</span> count) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span></code></pre></div>
</div>
<p>Please note, we don’t run this code yet. It’s going to be loaded in our <code>server.R</code> file.</p>
</section>
<section id="server.r-skeleton" class="level2">
<h2 class="anchored" data-anchor-id="server.r-skeleton">server.R skeleton</h2>
<p>Here’s the skeleton for our <code>server.R</code> file, go ahead and create this on your machine:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## this is how your server.R file should look</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shiny"</span>)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rfigshare"</span>)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lubridate"</span>)</span>
<span id="cb2-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xts"</span>)</span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggsci"</span>)</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data-processing.R"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">local =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(input, output, session){</span>
<span id="cb2-12">  </span>
<span id="cb2-13">  </span>
<span id="cb2-14">}</span></code></pre></div>
</div>
<p>Some things to note about our file:</p>
<ul>
<li><p>We’ve loaded all of the packages needed for the whole app, not just the data wrangling.</p></li>
<li><p>We’ve used <code>source()</code> to run the data wrangling script when the Shiny app loads</p></li>
<li><p>Our shiny server function contains <strong>three</strong> arguments. Many Shiny tutorials ommit the <code>session</code> argument, but it’s integral for Shiny modules to work correctly.</p></li>
</ul>
<p>We’re about to run our script file, but first <strong>register for a Figshare.com account</strong> so you can use the <code>rfigshare</code> package. Now <strong>run this script</strong>.</p>
</section>
<section id="gg_ma_timeseries" class="level2">
<h2 class="anchored" data-anchor-id="gg_ma_timeseries">gg_ma_timeseries</h2>
<p>Let’s assume for a minute that the dataviz we’re creating here is important enough that we might want to use it in other places than just this Shiny app. The easiest way to support this is by placing the script for the dataviz in its own file.</p>
<p>Create a new file called <code>gg_ma_timeseries.R</code> and add the following code, we’ll walk through the potentially mysterious <code>enquo</code> part of the functions in two minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## this is how your gg_ma_timeseries.R file should look</span></span>
<span id="cb3-2">gg_ma_timeseries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.data, date, value, category) {</span>
<span id="cb3-3">  date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enquo</span>(date)</span>
<span id="cb3-4">  </span>
<span id="cb3-5">  value <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enquo</span>(value)</span>
<span id="cb3-6">  </span>
<span id="cb3-7">  category <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enquo</span>(category)</span>
<span id="cb3-8">  </span>
<span id="cb3-9">  n_colours <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> .data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>category) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>()</span>
<span id="cb3-13">  </span>
<span id="cb3-14">  colours_from_startrek <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pal_startrek</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">palette =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"uniform"</span>))(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>))(n_colours)</span>
<span id="cb3-15">  </span>
<span id="cb3-16">  </span>
<span id="cb3-17">  .data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb3-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>date,</span>
<span id="cb3-20">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>value,</span>
<span id="cb3-21">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>category</span>
<span id="cb3-22">    )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-25">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> colours_from_startrek) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-26">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-27">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-28">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb3-29">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Example dataviz of Online Labour Index data"</span>,</span>
<span id="cb3-30">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DOI:10.6084/m9.figshare.376156"</span>)</span>
<span id="cb3-31">}</span>
<span id="cb3-32"></span>
<span id="cb3-33">ma_job_count <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.data, date, value, category, window_width){</span>
<span id="cb3-34">  </span>
<span id="cb3-35">  date <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enquo</span>(date)</span>
<span id="cb3-36">  </span>
<span id="cb3-37">  value <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enquo</span>(value)</span>
<span id="cb3-38">  </span>
<span id="cb3-39">  category <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enquo</span>(category)</span>
<span id="cb3-40">  </span>
<span id="cb3-41">  window_width <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(window_width)</span>
<span id="cb3-42">  </span>
<span id="cb3-43">  .data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-44">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>category) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-45">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-46">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value :=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rollmean</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>value,</span>
<span id="cb3-47">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k =</span> window_width,</span>
<span id="cb3-48">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.pad =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb3-49">                           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span></span>
<span id="cb3-50">    )) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-51">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>value)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-52">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb3-53">  </span>
<span id="cb3-54">}</span></code></pre></div>
</div>
<ul>
<li><p><code>gg_ma_timeseries()</code> is the function which creates our <code>ggplot2</code> timeseries dataviz</p></li>
<li><p><code>ma_job_count()</code> is a little utility function for smoothing the data with <code>xts::rollmean()</code>.</p></li>
</ul>
<p>Let’s load this file in our <code>server.R</code> script, so the file now has all of the code in it from before. <strong>Run this entire script</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## this is how your server.R file should look</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shiny"</span>)</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rfigshare"</span>)</span>
<span id="cb4-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lubridate"</span>)</span>
<span id="cb4-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xts"</span>)</span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggsci"</span>)</span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data-processing.R"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">local =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb4-10"></span>
<span id="cb4-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gg_ma_timeseries.R"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">local =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb4-12"></span>
<span id="cb4-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(input, output, session){</span>
<span id="cb4-14">  </span>
<span id="cb4-15">  </span>
<span id="cb4-16">}</span></code></pre></div>
</div>
<p>I want to prove to you that this works. Create a new script file <code>scratch-pad.R</code> where we can experiment and play. Add the following code, and then <strong>run the script</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## this is how your scratch-pad.R file should look</span></span>
<span id="cb5-2">gigs_by_occupation <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ma_job_count</span>(date, jobs, occupation, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_ma_timeseries</span>(date, jobs, occupation)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://visibledata.co.uk/posts/2019-03-25-shiny-modules-for-useful-controls/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice how the column names <code>jobs</code>, <code>occupation</code> and <code>date</code> have been given to <code>gg_ma_timeseries</code> without quotation marks? This is exactly the same as how we use functions from <code>dplyr</code>, e.g.&nbsp;<code>iris %&gt;% mutate(species = toupper(species))</code>. These are what we call <strong>naked column names</strong>.</p>
<p>That’s why the functions use <code>enquo()</code> internally, it’s implementing non-standard evaluation with <a href="https://tidyeval.tidyverse.org">tidyeval</a>. However, there’s zero need to understand this now (if you don’t want to). This is a Shiny module tutorial, so let’s move on to the <code>ui.R</code> file.</p>
</section>
<section id="ui.r-skeleton" class="level2">
<h2 class="anchored" data-anchor-id="ui.r-skeleton">ui.R skeleton</h2>
<p>Here’s the skeleton for our <code>ui.R</code> file, go ahead and create this on your machine:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## this is how your ui.R file should look</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shiny"</span>)</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shinycustomloader"</span>)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shinyServer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">navbarPage</span>(</span>
<span id="cb6-5">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shiny Modules"</span>,</span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(</span>
<span id="cb6-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By occupation"</span>,</span>
<span id="cb6-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>()</span>
<span id="cb6-9">  ),</span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(</span>
<span id="cb6-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By country"</span>,</span>
<span id="cb6-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>()</span>
<span id="cb6-13">  )</span>
<span id="cb6-14">))</span></code></pre></div>
</div>
</section>
<section id="shiny-app-without-modules" class="level2">
<h2 class="anchored" data-anchor-id="shiny-app-without-modules">Shiny app without modules</h2>
<p>A complete copy of this Shiny app that doesn’t use modules is available on Github here: <a href="https://github.com/charliejhadley/training_shiny-module/tree/master/gg_ma_timeseries/shiny-without-modules">https://github.com/charliejhadley/training_shiny-module/tree/master/gg_ma_timeseries/shiny-without-modules</a>.</p>
<p>There’s a tremendous amount of duplication in the <code>ui.R</code> file to get the <code>radioButtons()</code> to look how I want them to. We need to use Shiny modules to simplify this, which we’ll do in the section below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## DO NOT COPY THIS CODE.</span></span>
<span id="cb7-2"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## This is how the ui.R file looks without using modules.</span></span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shiny"</span>)</span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shinycustomloader"</span>)</span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shinyServer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">navbarPage</span>(</span>
<span id="cb7-7">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shiny without Modules"</span>,</span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(</span>
<span id="cb7-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By occupation"</span>,</span>
<span id="cb7-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidRow</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">column</span>(</span>
<span id="cb7-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">radioButtons</span>(</span>
<span id="cb7-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"by_occupation_landing_rollmean_k"</span>,</span>
<span id="cb7-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb7-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">choices =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-15">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Show daily value"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb7-16">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Show 28-day moving average"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span></span>
<span id="cb7-17">        ),</span>
<span id="cb7-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">selected =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>,</span>
<span id="cb7-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inline =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb7-20">      ),</span>
<span id="cb7-21">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb7-22">    )),</span>
<span id="cb7-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">withLoader</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotOutput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gg_gigs_by_occupation"</span>)),</span>
<span id="cb7-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loader =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dnaspin"</span></span>
<span id="cb7-25">    )</span>
<span id="cb7-26">  ),</span>
<span id="cb7-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(</span>
<span id="cb7-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By country"</span>,</span>
<span id="cb7-29">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidRow</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">column</span>(</span>
<span id="cb7-30">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">radioButtons</span>(</span>
<span id="cb7-31">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"by_country_group_landing_rollmean_k"</span>,</span>
<span id="cb7-32">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb7-33">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">choices =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-34">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Show daily value"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb7-35">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Show 28-day moving average"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span></span>
<span id="cb7-36">        ),</span>
<span id="cb7-37">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">selected =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>,</span>
<span id="cb7-38">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inline =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb7-39">      ),</span>
<span id="cb7-40">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb7-41">    )),</span>
<span id="cb7-42">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">withLoader</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotOutput</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gg_gigs_by_country_group"</span>)),</span>
<span id="cb7-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loader =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dnaspin"</span></span>
<span id="cb7-44">    )</span>
<span id="cb7-45">  )</span>
<span id="cb7-46">))</span></code></pre></div>
</div>
<p>The <code>server.R</code> file is fairly tidy because we’ve already abstracted a lot of the app into functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## DO NOT COPY THIS CODE.</span></span>
<span id="cb8-2"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## This is how the server.R file looks without using modules.</span></span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shiny"</span>)</span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rfigshare"</span>)</span>
<span id="cb8-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lubridate"</span>)</span>
<span id="cb8-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xts"</span>)</span>
<span id="cb8-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggsci"</span>)</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data-processing.R"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">local =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb8-11"></span>
<span id="cb8-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gg_ma_timeseries.R"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">local =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb8-13"></span>
<span id="cb8-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(input, output, session) {</span>
<span id="cb8-15">  output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gg_gigs_by_occupation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderPlot</span>({</span>
<span id="cb8-16">    </span>
<span id="cb8-17">    gigs_by_occupation <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-18">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ma_job_count</span>(date, jobs, occupation, input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>by_occupation_landing_rollmean_k) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_ma_timeseries</span>(date, jobs, occupation)</span>
<span id="cb8-20">    </span>
<span id="cb8-21">  })</span>
<span id="cb8-22"></span>
<span id="cb8-23">  output<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gg_gigs_by_country_group <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">renderPlot</span>({</span>
<span id="cb8-24">    </span>
<span id="cb8-25">    gigs_by_country_group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-26">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ma_job_count</span>(date, jobs, country_group, input<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>by_country_group_landing_rollmean_k) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb8-27">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_ma_timeseries</span>(date, jobs, country_group)</span>
<span id="cb8-28">    </span>
<span id="cb8-29">  })</span>
<span id="cb8-30">}</span></code></pre></div>
</div>
</section>
<section id="introducing-the-shiny-module" class="level2">
<h2 class="anchored" data-anchor-id="introducing-the-shiny-module">Introducing the Shiny Module</h2>
<p>The Shiny Module is composed of two components:</p>
<ul>
<li><code>gg_ma_timeseries_input()</code> creates an instance of our controls.</li>
<li><code>gg_ma_timeseries_output()</code> creates an instance of the chart, which is dependent on a set of controls (specified in the server.R file).</li>
</ul>
<center>
<img src="https://visibledata.co.uk/blog/2019-03-25-shiny-modules-for-useful-controls_files/the-whole-module.png" class="img-fluid" width="450">
</center>
<p>It’s crucial that we place the code for these elements of the module in the correct place:</p>
<center>
<img src="https://visibledata.co.uk/blog/2019-03-25-shiny-modules-for-useful-controls_files/where-things-live.png" class="img-fluid" width="450">
</center>
<section id="rules-for-modules" class="level3">
<h3 class="anchored" data-anchor-id="rules-for-modules">Rules for modules</h3>
<p>This is one of the things left out of the other Shiny module tutorials I’ve read. Most tutorials deal with a toy example and don’t split the code into distinct <code>ui.R</code> and <code>server.R</code> files. Let’s establish some hard and fast rules about modules:</p>
<ul>
<li><p>Place your module code in a subfolder called <code>/modules</code>.</p></li>
<li><p>Code for inputs (controls) must be sourced in the <code>ui.R</code> file.</p></li>
<li><p>Code for outputs (charts) must be sourced in the <code>server.R</code> file.</p></li>
</ul>
</section>
</section>
<section id="namespaces-with-ns" class="level2">
<h2 class="anchored" data-anchor-id="namespaces-with-ns">Namespaces with <code>NS</code></h2>
<p>Remember our <code>server.R</code> function?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">server <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(input, output, session){</span>
<span id="cb9-2">  </span>
<span id="cb9-3">}</span></code></pre></div>
</div>
<p>Inside of our modules we need to manipulate values from both the <code>input</code> and <code>output</code> objects. In programming speak, we need to be careful about namespaces. In Shiny, this means we need to use the <code>NS()</code> function to guarantee we’re refering to the values we think we’re refering to. Let’s create the control for our modules, in a new script file: <code>/modules/client-side_gg-ma-timeseries.R</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## This is how your /modules/client-side_gg-ma-timeseries.R file should look</span></span>
<span id="cb10-2">gg_ma_timeseries_input <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(id) {</span>
<span id="cb10-3">  ns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NS</span>(id)</span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tagList</span>(</span>
<span id="cb10-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"This entire tab is a shiny module, including; this text, the radio buttons and the chart."</span>,</span>
<span id="cb10-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidRow</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">column</span>(</span>
<span id="cb10-7">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">radioButtons</span>(</span>
<span id="cb10-8">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"landing_rollmean_k"</span>),</span>
<span id="cb10-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb10-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">choices =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb10-11">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Show daily value"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb10-12">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Show 28-day moving average"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span></span>
<span id="cb10-13">        ),</span>
<span id="cb10-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">selected =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>,</span>
<span id="cb10-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inline =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb10-16">      ),</span>
<span id="cb10-17">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb10-18">    ))</span>
<span id="cb10-19">  )</span>
<span id="cb10-20">}</span></code></pre></div>
</div>
<p>Things to take away from the <code>gg_ma_timeseries_input()</code> function:</p>
<ul>
<li><p><code>ns &lt;- NS(id)</code> ensures we’re refering to values from the server <code>input</code> object</p></li>
<li><p><code>ns("landing_rollmean_k")</code> translates to <code>input$landing_rollmean_k</code></p></li>
<li><p>If returning <strong>multiple ui elements</strong> they must be contained within <code>tagList()</code>… <em>but</em> it’s a great idea to use <code>tagList()</code> by default, it will prevent mishaps.</p></li>
</ul>
<p>That’s our control. We need to create our output function that will display the chart rendered by the server, which we’ll call <code>gg_ma_timeseries_output()</code>. It takes a while to download and display the data in our chart, so it’s a good idea to use the excellent [<code>shinycustomloader</code>] package to show an animated “loading” GIF to the user. Please update your <code>/modules/client-side_gg-ma-timeseries.R</code> file so it looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## This is how your /modules/client-side_gg-ma-timeseries.R file should look</span></span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shinycustomloader"</span>)</span>
<span id="cb11-3"></span>
<span id="cb11-4">gg_ma_timeseries_input <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(id) {</span>
<span id="cb11-5">  ns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NS</span>(id)</span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tagList</span>(</span>
<span id="cb11-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"This entire tab is a shiny module, including; this text, the radio buttons and the chart."</span>,</span>
<span id="cb11-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidRow</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">column</span>(</span>
<span id="cb11-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">radioButtons</span>(</span>
<span id="cb11-10">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"landing_rollmean_k"</span>),</span>
<span id="cb11-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb11-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">choices =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb11-13">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Show daily value"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb11-14">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Show 28-day moving average"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span></span>
<span id="cb11-15">        ),</span>
<span id="cb11-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">selected =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span>,</span>
<span id="cb11-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inline =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb11-18">      ),</span>
<span id="cb11-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb11-20">    ))</span>
<span id="cb11-21">  )</span>
<span id="cb11-22">}</span>
<span id="cb11-23"></span>
<span id="cb11-24">gg_ma_timeseries_output <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(id) {</span>
<span id="cb11-25">  ns <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">NS</span>(id)</span>
<span id="cb11-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">withLoader</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plotOutput</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ns</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ma_plot"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loader =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dnaspin"</span>)</span>
<span id="cb11-27">}</span></code></pre></div>
</div>
<p>Our output function is more complex than our input, because <code>ns("ma_plot")</code> refers to an instace of <code>output$ma_plot</code> from the Shiny module, which we haven’t created yet</p>
<p>The trick to how <code>NS()</code> works inside of <code>gg_ma_timeseries_output()</code> is more complicated than our input function, and is explained in the section below. However, let’s</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## This is how your ui.R file should look</span></span>
<span id="cb12-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shiny"</span>)</span>
<span id="cb12-3"></span>
<span id="cb12-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"modules/client-side_gg-ma-timeseries.R"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">local =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shinyServer</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">navbarPage</span>(</span>
<span id="cb12-7">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shiny Modules"</span>,</span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(</span>
<span id="cb12-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By occupation"</span>,</span>
<span id="cb12-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(</span>
<span id="cb12-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_ma_timeseries_input</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation_controls"</span>),</span>
<span id="cb12-12">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_ma_timeseries_output</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation_chart"</span>)</span>
<span id="cb12-13">    )</span>
<span id="cb12-14">  ),</span>
<span id="cb12-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tabPanel</span>(</span>
<span id="cb12-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"By country"</span>,</span>
<span id="cb12-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fluidPage</span>(</span>
<span id="cb12-18">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_ma_timeseries_input</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"by_country_controls"</span>),</span>
<span id="cb12-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gg_ma_timeseries_output</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"by_country_chart"</span>)</span>
<span id="cb12-20">    )</span>
<span id="cb12-21">  )</span>
<span id="cb12-22">))</span></code></pre></div>
</div>
<ul>
<li><p>We’re going to be extracting</p></li>
<li><p><code>ns &lt;- NS(id)</code> ensures we’re</p></li>
<li><p><code>ns("ma_plot")</code></p></li>
</ul>
</section>
<section id="things-they-dont-tell-you" class="level2">
<h2 class="anchored" data-anchor-id="things-they-dont-tell-you">Things they don’t tell you</h2>
<ul>
<li><p>Load the ui in the ui.R file</p></li>
<li><p>Delete the scratch-pad.R file</p></li>
</ul>
<!-- <blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Imagine you&#39;re following an R tutorial that includes<br><br>read_csv(&quot;http://online_csv&quot;)<br><br>How large would that csv need to be before you&#39;d want a warning written into the tutorial?</p>&mdash; Charlie Joey Hadley (@charliejhadley) <a href="https://twitter.com/charliejhadley/status/1110203236177334278?ref_src=twsrc%5Etfw">March 25, 2019</a></blockquote> -->
<!-- <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"> -->
<!-- </script> -->


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I was interested in how important file size warnings are in tutorials, my <a href="https://twitter.com/charliejhadley/status/1110203236177334278">Twitter poll revealed that most folks wanted a warning for files bigger than 10Mb</a>↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2019,
  author = {Hadley, Charlie},
  title = {Shiny Modules for Useful Controls},
  date = {2019-03-25},
  url = {https://visibledata.co.uk/posts/2019-03-25-shiny-modules-for-useful-controls},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2019" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2019. <span>“Shiny Modules for Useful Controls.”</span>
March 25, 2019. <a href="https://visibledata.co.uk/posts/2019-03-25-shiny-modules-for-useful-controls">https://visibledata.co.uk/posts/2019-03-25-shiny-modules-for-useful-controls</a>.
</div></div></section></div> ]]></description>
  <category>shiny</category>
  <guid>https://visibledata.co.uk/posts/2019-03-25-shiny-modules-for-useful-controls/</guid>
  <pubDate>Mon, 25 Mar 2019 00:00:00 GMT</pubDate>
  <media:content url="https://visibledata.co.uk/posts/2019-03-25-shiny-modules-for-useful-controls/shiny-modules-reusable-controls.png" medium="image" type="image/png" height="82" width="144"/>
</item>
<item>
  <title>One weird regex matches 97% of DOI…</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2019-03-13_extracting-doi-from-text/</link>
  <description><![CDATA[ 





<p>At least once a month I’m tasked with something that involves working with DOI, but I’ve never bothered to write a function for extracting these from texts. Time to end that by putting together a tidyversesque <code>add_doi()</code> function!</p>
<p>… wait, why?</p>
<p>The <a href="https://r4ds.had.co.nz/functions.html">R for Data Science</a> book has lots of excellent advice, including this snippet about reducing duplicated code by writing functions:</p>
<p><img src="https://visibledata.co.uk/posts/2019-03-13_extracting-doi-from-text/when-to-write-a-function.png" class="img-fluid" alt="" width="550"></p>
<p>So, what are DOI? DOI (Digital Object Identifiers) are the gold standard for citations. They’re guaranteed to point directly to the resource you care about. But how can we reliably extracting DOI from, for example, the following references?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb1-2">example_references <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb1-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text_citation =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gueorgi Kossinets and Duncan J. Watts, "Origins of Homophily in an Evolving Social Network," American Journal of Sociology 115 (2009):414, accessed December 5, 2014, doi:10.1086/599247'</span>,</span>
<span id="cb1-4">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Morey, C. C., Cong, Y., Zheng, Y., Price, M., &amp; Morey, R. D. (2015). The color-sharing bonus: Roles of perceptual organization and attentive processes in visual working memory. Archives of Scientific Psychology, 3, 18–29. https://doi.org/10.1037/arc0000014'</span>,</span>
<span id="cb1-5">                        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Barros, B., Read, T. &amp; Verdejo, M. F. (2008) Virtual collaborative experimentation:</span></span>
<span id="cb1-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">an approach combining remote and local labs. IEEE Transactions on Education. 51 (2),</span></span>
<span id="cb1-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">242–250. Available from: doi:10.1109/TE.2007.908071'</span>))</span></code></pre></div>
</div>
<p>CrossRef have a great blogpost about how to <a href="https://www.crossref.org/blog/dois-and-matching-regular-expressions/">match DOIs using regular expressions</a> where they recommend the following regex, which matches 97% of the 74.9 million DOI they tested. The majority of the ~500,000 not matched by this regex are from the <em>bad old days</em> of the early noughties, and outside of our interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">doi_regex <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{4,9}/[-._;()/:a-z0-9A-Z]+"</span></span></code></pre></div>
</div>
<p>Using <code>str_extract()</code> from the tidyverse package <code>stringr</code> allows us to extract the DOIs from our reference:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">example_references <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">doi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(text_citation, doi_regex))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  text_citation                                                            doi  
  &lt;chr&gt;                                                                    &lt;chr&gt;
1 "Gueorgi Kossinets and Duncan J. Watts, \"Origins of Homophily in an Ev… 10.1…
2 "Morey, C. C., Cong, Y., Zheng, Y., Price, M., &amp; Morey, R. D. (2015). T… 10.1…
3 "Barros, B., Read, T. &amp; Verdejo, M. F. (2008) Virtual collaborative exp… 10.1…</code></pre>
</div>
</div>
<p>This can all be rolled together into a function; <code>add_doi()</code>. If you’re unfamiliar with <code>!!</code>, <code>enquo</code> and <code>:=</code> that’s because I’m using <code>tidyeval</code>, <a href="https://tidyeval.tidyverse.org/modifying-inputs.html">find out more about tidyeval here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">add_doi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.data, citation_column, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"doi"</span>) {</span>
<span id="cb5-2">  citation_column <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enquo</span>(citation_column)</span>
<span id="cb5-3"></span>
<span id="cb5-4">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;&amp;</span> name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(.data)) {</span>
<span id="cb5-5">    rlang<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abort</span>(glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Column `{name}` already exists in the data"</span>))</span>
<span id="cb5-6">  }</span>
<span id="cb5-7">  </span>
<span id="cb5-8">  .data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name :=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_extract</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>citation_column, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10.</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">d{4,9}/[-._;()/:a-z0-9A-Z]+"</span>))</span>
<span id="cb5-10">}</span></code></pre></div>
</div>
<p>Because the function is written with <code>tidyeval</code> I can use <em>naked column names</em> just as a I would with <code>dplyr::add_count()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">example_references <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_doi</span>(text_citation)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  text_citation                                                            doi  
  &lt;chr&gt;                                                                    &lt;chr&gt;
1 "Gueorgi Kossinets and Duncan J. Watts, \"Origins of Homophily in an Ev… 10.1…
2 "Morey, C. C., Cong, Y., Zheng, Y., Price, M., &amp; Morey, R. D. (2015). T… 10.1…
3 "Barros, B., Read, T. &amp; Verdejo, M. F. (2008) Virtual collaborative exp… 10.1…</code></pre>
</div>
</div>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2019,
  author = {Hadley, Charlie},
  title = {One Weird Regex Matches 97\% of {DOI...}},
  date = {2019-03-13},
  url = {https://visibledata.co.uk/posts/2019-03-13_extracting-doi-from-text},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2019" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie. 2019. <span>“One Weird Regex Matches 97% of
DOI...”</span> March 13, 2019. <a href="https://visibledata.co.uk/posts/2019-03-13_extracting-doi-from-text">https://visibledata.co.uk/posts/2019-03-13_extracting-doi-from-text</a>.
</div></div></section></div> ]]></description>
  <category>reproducible research</category>
  <guid>https://visibledata.co.uk/posts/2019-03-13_extracting-doi-from-text/</guid>
  <pubDate>Wed, 13 Mar 2019 00:00:00 GMT</pubDate>
  <media:content url="https://visibledata.co.uk/posts/softblock-demo/three-designs.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Where is the centre of University of Oxford?</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2019-02-18_oxford-centres/</link>
  <description><![CDATA[ 




<div class="cell">

</div>
<p>My team at University of Oxford provide research data management and reproducible research advice to researchers across the whole of the University. A fairly common point of contention is where should we meet, and where is the centre of the University?</p>
<p>We broadly agreed that the centre of the University should be calculated as the (weighted) centre of mass of specific buildings or campuses within the University. Two of our favourite options were:</p>
<ul>
<li>Centre of mass of all colleges</li>
<li>Centre of mass of the University divisions</li>
</ul>
<p>In this blogpost I go through all the steps of scraping and combining data from the OxPoints service and Wikipedia to create the chart below:</p>
<p><img src="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/oxford-centres.gif" class="img-fluid" data-max-width="530px"></p>
<section id="how-to-follow-along" class="level3">
<h3 class="anchored" data-anchor-id="how-to-follow-along">How to follow along</h3>
<p>If you want to follow along, please follow these steps first:</p>
<ol type="1">
<li><p>Create a new RStudio project</p></li>
<li><p>Create a data directory by running <code>dir.create("data")</code></p></li>
<li><p>Create a script file in the <code>data</code> directory called <code>obtain-oxpoints-data.R</code>, we’ll use this to scrape data from Oxpoint.</p></li>
</ol>
</section>
<section id="get-data-from-oxpoints" class="level3">
<h3 class="anchored" data-anchor-id="get-data-from-oxpoints">Get data from OxPoints</h3>
<p>OxPoints is a tool for <a href="https://help.it.ox.ac.uk/oxpoints/index">accessing geographic information about University of Oxford</a> and was mostly put together by my friend and ex-colleague <a href="https://twitter.com/alexsdutton">Alex Dutton</a>. Now I’ve highlighted Alex is a friend, I can be slightly more candid in scraping data from the service…</p>
<p>We’re going to extract the shapefiles for all colleges in the university and store the data in ESRI shapefiles.</p>
<p>We need to load the following libraries at the top of our <code>data-raw/obtain-oxpoints-data.R</code> script:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jsonlite"</span>)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span>)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"here"</span>)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rvest"</span>)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mapview"</span>)</span></code></pre></div>
</div>
<p>There’s not a fantastically well documented way to obtain college data from the API. After jigging about with the search fields the query below returns everything we need, and then we then subset the data (after much trial and error):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">raw_json_oxpoints_colleges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_json</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://maps.ox.ac.uk/api/places/search?type=%2Funiversity%2Fcollege&amp;inoxford=true&amp;-type_exact=%5C%2Funiversity%5C%2Fsub-library&amp;-type_exact=%5C%2Funiversity%5C%2Froom&amp;count=50&amp;facet=type_exact"</span>)</span>
<span id="cb2-2"></span>
<span id="cb2-3">oxpoints_colleges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> raw_json_oxpoints_colleges<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">_embedded</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>pois</span></code></pre></div>
</div>
<p>The <code>oxpoints_colleges</code> object contains data for all 38 colleges (at the time of writing). We’re going to iteratively extract the college data through this <code>get_college_data()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">get_college_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(oxpoints_data,</span>
<span id="cb3-2">                             college_index) {</span>
<span id="cb3-3">  college_properties <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(oxpoints_data[[college_index]])</span>
<span id="cb3-4"></span>
<span id="cb3-5">  extracted_properties <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb3-6">    college_properties[college_properties <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb3-7">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>,</span>
<span id="cb3-8">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span>,</span>
<span id="cb3-9">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lon"</span>,</span>
<span id="cb3-10">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>,</span>
<span id="cb3-11">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name_sort"</span>,</span>
<span id="cb3-12">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shape"</span>,</span>
<span id="cb3-13">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"social_facebook"</span>,</span>
<span id="cb3-14">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"website"</span></span>
<span id="cb3-15">    )]</span>
<span id="cb3-16"></span>
<span id="cb3-17">  oxpoints_data[[college_index]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-18">    .[extracted_properties] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_if</span>(is.list, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">funs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(.))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate_all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">funs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_guess</span>(.)))</span>
<span id="cb3-22">}</span></code></pre></div>
</div>
<p>Let’s extract the first college to create an object we can iteratively fill:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">college_oxpoints_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> oxpoints_colleges <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_college_data</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<p>Now we can use <code>pwalk</code> to iterate over all other colleges:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pwalk</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x){college_oxpoints_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;&lt;-</span> college_oxpoints_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_college_data</span>(oxpoints_colleges, x))})</span></code></pre></div>
</div>
<p>Our <code>college_oxpoints_data</code> object contains the geometry of each college in the <code>shape</code> column and two columns <code>lat</code> and <code>long</code> of unknown provenance - let’s drop those as well as <code>name_sort</code> and <code>id</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">college_oxpoints_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_oxpoints_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lat, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lon, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>id, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>name_sort)</span></code></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name                   shape                           social_facebook website
  &lt;chr&gt;                  &lt;chr&gt;                           &lt;chr&gt;           &lt;chr&gt;  
1 All Souls College      POLYGON ((-1.2529353 51.753888… https://www.fa… http:/…
2 Balliol College        POLYGON ((-1.2584285 51.755520… &lt;NA&gt;            http:/…
3 Brasenose College      POLYGON ((-1.2553351 51.752854… https://www.fa… http:/…
4 Christ Church          POLYGON ((-1.2546005 51.751651… https://www.fa… http:/…
5 Corpus Christi College MULTIPOLYGON (((-1.2532213 51.… https://www.fa… http:/…
6 Exeter College         MULTIPOLYGON (((-1.2553241 51.… &lt;NA&gt;            http:/…</code></pre>
</div>
</div>
<p>Let’s augment this data with whatever we can easily collect from the Wikipedia page on the Oxford Colleges.</p>
</section>
<section id="extract-data-from-wikipedia-table" class="level3">
<h3 class="anchored" data-anchor-id="extract-data-from-wikipedia-table">Extract data from Wikipedia table</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Colleges_of_the_University_of_Oxford">Colleges of the University of Oxford Wikipedia page</a> provides a useful summary of the colleges, including; year of foundation, financial assets and number of students. We’ve already loaded the <code>rvest</code> package at the top of our script file, which is the go-to tool for web scraping with R. First, let’s import the web page using <code>read_html</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">colleges_of_oxford <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_html</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://en.wikipedia.org/wiki/Colleges_of_the_University_of_Oxford"</span>)</span></code></pre></div>
</div>
<p>We want to extract the tables from the web page, which we achieve using <code>html_nodes()</code>. Specifically, we only care about the 3rd table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">colleges_of_oxford <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> colleges_of_oxford <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_nodes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"table"</span>)</span>
<span id="cb9-3">colleges_of_oxford <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> colleges_of_oxford[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]]</span></code></pre></div>
</div>
<p>The <code>rvest</code> package does contain a useful function (<code>html_table()</code>) for parsing well-formed tables into tibbles. Unfortunately, our table is not very well formed at all. The first row spans the whole table and contains a glossary for abbreviations in the table, please don’t format your own tables like this. I’ve decided to get around this by extracting all rows from the table, which have the html tag <code>&lt;tr&gt;</code> and extract the contents of these nodes into character vectors using <code>html_text()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">colleges_of_oxford <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> colleges_of_oxford <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_nodes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tbody"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_nodes</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tr"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html_text</span>()</span></code></pre></div>
</div>
<p>We’ll throw away the top row by asking for parts <code>2:length(.)</code> and also clean up and nasty trailing/leading white space with <code>str_trim()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">colleges_of_oxford <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> colleges_of_oxford <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-2">  .[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>{<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(.) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>}] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_trim</span>() </span></code></pre></div>
</div>
<p>Now we can convert our vector of characters into a <code>tibble</code>! In the original table, the <a href="https://en.wikipedia.org/wiki/Newline">newline character <code>\n</code></a> separates pieces of data in each row. So we can use <code>str_replace_all</code> to replace any sequence of repeating <code>\n</code> with a <code>;</code> and then parse this as a table with <code>read_delim()</code>. Let’s also tidy up the column names before we forget.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">colleges_of_oxford <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> colleges_of_oxford <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace_all</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">{1,}"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> .) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">separate</span>(text,</span>
<span id="cb12-5">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">into =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foundation.year"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sister.college"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total.assets"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"financial.endowment"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"undergraduates"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"post.graduates"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"visiting.students"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"male.students"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"female.students"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"total.students"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"assets.per.student"</span>),</span>
<span id="cb12-6">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>)</span></code></pre></div>
</div>
<p>There are several messy columns that we need to convert into numeric data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">colleges_of_oxford <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(name, foundation.year, total.assets, financial.endowment)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  name                      foundation.year   total.assets    financial.endowme…
  &lt;chr&gt;                     &lt;chr&gt;             &lt;chr&gt;           &lt;chr&gt;             
1 Harris Manchester College 1786College: 1996 £40,301,000[27] £14,371,000[27]   
2 Hertford College          1282College: 1740 £79,183,000[28] £60,552,000[28]   </code></pre>
</div>
</div>
<p>Turns out <code>readr::parse_number()</code> is clever enough to fix our column. It’s convenient to use <code>mutate_at</code> to modify many columns at once, having previously re-arranged columns so all the targets are together:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">colleges_of_oxford <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> colleges_of_oxford <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(name, sister.college, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(name, sister.college, foundation.year, undergraduates, post.graduates, total.students) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(foundation.year<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>total.students, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_number</span>(.x)))</span></code></pre></div>
</div>
<p>We’ve now got all of the information I wanted about the colleges, so let’s combine the tables with <code>left_join()</code>. But this isn’t a well formatted dataset for GIS analysis/visualisation. For that we need to use the <code>sf</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">college_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_oxpoints_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(colleges_of_oxford)</span></code></pre></div>
</div>
</section>
<section id="creating-an-sf-object" class="level3">
<h3 class="anchored" data-anchor-id="creating-an-sf-object">Creating an <code>sf</code> object</h3>
<p><code>sf tibbles</code> are the augmented tibbles of the excellent <code>sf</code> package. They contain both the necessary geometric data for computing &amp; visualising GIS features, and additional non-geometric data about each feature (i.e.&nbsp;the founding year of the college).</p>
<p>Let’s remove the <code>shape</code> column from <code>college_data</code> to provide us with the purely non-geometric data columns, and we’ll append the</p>
<p>Let’s extract all the non-geometric data columns from <code>college_data</code> with <code>select()</code> and create a new tibble <code>college_nongeometric_data</code> that we’ll append the geometric data to below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">college_nongeometric_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>shape)</span></code></pre></div>
</div>
<p>In my opinion, this is the one and only fiddly part of using <code>sf</code>. We need to create an <code>sfc</code> object, which is achieved with the <code>st_as_sfc()</code> function. However, this function needs a <em>vector</em> of the features and not a <code>tibble</code>; which is why in the code below we use <code>.[[1]]</code>. If you’re unfamiliar with this trick, please refer to <a href="https://twitter.com/hadleywickham/status/643381054758363136">Hadley Wickham’s pepper shaker tutorial</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">college_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(shape) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-3">  .[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb18-4">college_geometries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sfc</span>(college_features)</span></code></pre></div>
</div>
<p>We can now augment <code>college_nongeometric_data</code> with this <code>sfc</code> object via the <code>st_geometry()</code> function. Finally, we’ll create a copy of this with a sensible name: <code>college_shapes</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_geometry</span>(college_nongeometric_data) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_geometries</span>
<span id="cb19-2">college_shapes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_nongeometric_data</span></code></pre></div>
</div>
<p>Our <code>sf tibble</code> currently suffers from two issues:</p>
<ul>
<li>There’s no projection. We’ll assign the standard WGS84 projection with <code>st_set_crs</code>.</li>
<li>The geometry objects are currently <code>POLYGON Z</code> and <code>MULTIPOLYGON Z</code> with zero values for <code>z</code>. As all values are zero, they’re pointless and can be removed with <code>st_zm</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">college_shapes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_shapes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_set_crs</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_zm</span>()</span></code></pre></div>
</div>
</section>
<section id="understanding-our-shapefiles-with-mapview" class="level3">
<h3 class="anchored" data-anchor-id="understanding-our-shapefiles-with-mapview">Understanding our shapefiles with <code>mapview</code></h3>
<p>Before continuing forwards, we should ensure our shapefiles are what we assume they are: the grounds of each college in the University of Oxford. The <code>mapview</code> package is incredibly useful for exploring and understanding <code>sf tibbles</code>. If you’ve been following along precisely, the script file your in already loads <code>mpaview</code>!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">mp_colleges <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_shapes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb21-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapview</span>()</span>
<span id="cb21-3">mp_colleges</span></code></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-68099cec8d866c380a4a" style="width:100%;height:464px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-68099cec8d866c380a4a">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-1.2529353,-1.2528694,-1.2528258,-1.2527521,-1.252715,-1.2527064,-1.2525681,-1.2524982,-1.2523614,-1.2523593,-1.2523414,-1.2521985,-1.2521373,-1.2521184,-1.252077,-1.2520666,-1.252037,-1.2520161,-1.2520973,-1.2521872,-1.2521849,-1.2524326,-1.2525016,-1.2525766,-1.2527656,-1.2528156,-1.2530169,-1.2531027,-1.25327,-1.2532892,-1.2532985,-1.253372,-1.253444,-1.2534491,-1.2534583,-1.2535291,-1.2536676,-1.253685,-1.2537109,-1.2537753,-1.253697,-1.2533986,-1.2532349,-1.2529809,-1.2529788,-1.2529353],"lat":[51.7538886,51.7538885,51.7537859,51.7536154,51.7535254,51.7535135,51.7535162,51.753518,51.75352,51.7535043,51.7533709,51.7533827,51.7533848,51.7533143,51.7531734,51.7531357,51.7529708,51.7528546,51.7528507,51.7528464,51.7528312,51.7528188,51.7528154,51.752811,51.7527973,51.7527884,51.7527521,51.7527378,51.7527114,51.7527476,51.7527651,51.7529037,51.7530393,51.7530503,51.7530751,51.7532501,51.7535461,51.753584,51.7536422,51.7537922,51.7538052,51.7538579,51.7538872,51.7539068,51.7538887,51.7538886]}]],[[{"lng":[-1.2584285,-1.2584429,-1.2584652,-1.2589203,-1.2589,-1.2588701,-1.2588663,-1.2588451,-1.258815,-1.2587618,-1.2587087,-1.2586597,-1.2585349,-1.2585045,-1.2584716,-1.2584174,-1.2583985,-1.2572921,-1.2571998,-1.2571726,-1.2568936,-1.2570789,-1.2570646,-1.2571227,-1.2573114,-1.2574361,-1.2574683,-1.2574953,-1.2575783,-1.2575963,-1.257653,-1.2577026,-1.2577185,-1.2577797,-1.2578035,-1.2577749,-1.2578538,-1.2579049,-1.2583621,-1.2584285],"lat":[51.7555201,51.7555677,51.7556096,51.7555524,51.7554723,51.7553453,51.7553308,51.7552395,51.7551911,51.7551053,51.7550198,51.7549409,51.7547312,51.7546118,51.7544919,51.754241,51.7542375,51.7543963,51.7544142,51.7544185,51.7544739,51.7548476,51.7548597,51.7549732,51.7549588,51.7551301,51.7551218,51.7551617,51.7552419,51.7552699,51.7552536,51.75532,51.7553412,51.7553475,51.7554224,51.7554725,51.7555848,51.7556476,51.7555287,51.7555201]}]],[[{"lng":[-1.2553351,-1.255317,-1.2552846,-1.2551002,-1.255111,-1.2550799,-1.2550938,-1.2551093,-1.2551193,-1.255125,-1.2551267,-1.2551211,-1.2551121,-1.255102,-1.2550908,-1.255112,-1.2551195,-1.2551342,-1.2551571,-1.2551605,-1.2551744,-1.2548598,-1.2546243,-1.2544756,-1.2544013,-1.2543642,-1.2543567,-1.2543054,-1.2542876,-1.2542294,-1.2542259,-1.2542063,-1.2541903,-1.254179,-1.2541636,-1.2541383,-1.2544907,-1.2549458,-1.2550889,-1.2553036,-1.2553538,-1.2553129,-1.2553248,-1.2553405,-1.2553402,-1.2553399,-1.2553391,-1.2553356,-1.2553351],"lat":[51.7528543,51.7529463,51.7529918,51.7530007,51.7530413,51.753045,51.7530474,51.7530545,51.7530626,51.7530739,51.7530857,51.753096,51.7531039,51.7531099,51.7531128,51.7532054,51.7532414,51.7533123,51.7534046,51.7534184,51.7534779,51.7535049,51.7535251,51.7535378,51.7533945,51.7533224,51.7533068,51.7531882,51.7531314,51.7529851,51.7529219,51.7528426,51.7527873,51.752734,51.752661,51.7525415,51.7524914,51.7524267,51.7524064,51.752376,51.7525261,51.7525345,51.752571,51.7526012,51.7526438,51.7526829,51.752784,51.7528455,51.7528543]}]],[[{"lng":[-1.2546005,-1.2545148,-1.2544338,-1.2543196,-1.2542181,-1.2541713,-1.2541683,-1.2541628,-1.2541573,-1.2541391,-1.2541652,-1.254141,-1.2541314,-1.2541721,-1.254145,-1.2541323,-1.2541227,-1.2541402,-1.2541822,-1.2541797,-1.2540901,-1.2540543,-1.2540179,-1.2540153,-1.2539849,-1.2539488,-1.2539142,-1.253916,-1.2539163,-1.2539214,-1.2539174,-1.2537986,-1.2537662,-1.2537614,-1.2537598,-1.2530008,-1.2529348,-1.252926,-1.2529202,-1.2529331,-1.2535546,-1.2536707,-1.2537956,-1.253785,-1.2543786,-1.2544774,-1.2544944,-1.2552372,-1.2552293,-1.2555562,-1.2556418,-1.2555959,-1.2565729,-1.2566473,-1.2567052,-1.2567217,-1.2567003,-1.2567134,-1.2567164,-1.2567371,-1.2568058,-1.2568324,-1.2568659,-1.256891,-1.2570324,-1.2569848,-1.2569614,-1.256953,-1.2568833,-1.2568913,-1.2568296,-1.2566955,-1.2567492,-1.2567602,-1.2568082,-1.2567586,-1.2566567,-1.2561447,-1.2557999,-1.2558028,-1.2556253,-1.2555836,-1.2554887,-1.2554977,-1.2555075,-1.2549424,-1.2546005],"lat":[51.7516519,51.7516484,51.7515923,51.7515715,51.7513037,51.7511123,51.7510989,51.7510765,51.7510428,51.7509716,51.7509693,51.750864,51.7506671,51.7506696,51.750554,51.750465,51.750389,51.7501972,51.7501953,51.7500551,51.7500492,51.7500486,51.7500485,51.7500722,51.7500693,51.7500714,51.7500913,51.7501084,51.7501259,51.7501527,51.7501726,51.7501829,51.750186,51.7501869,51.7501827,51.7502878,51.7500421,51.7498887,51.749789,51.749458,51.7494662,51.7494863,51.7495086,51.7494285,51.7493984,51.7493926,51.7493925,51.7493547,51.7492901,51.7492716,51.7492342,51.7492109,51.7491703,51.7495388,51.7496893,51.7497872,51.7501284,51.7502067,51.7502245,51.7503248,51.7505535,51.7505691,51.7506858,51.7507328,51.7509977,51.7510084,51.7510057,51.7509889,51.7510038,51.7510237,51.7510354,51.7510503,51.7511068,51.7511341,51.7512529,51.7512538,51.7512576,51.7513248,51.7514187,51.7514476,51.751482,51.7514845,51.7514903,51.7515272,51.7515673,51.75162,51.7516519]}]],[[{"lng":[-1.2532213,-1.2531249,-1.2530651,-1.2530323,-1.2529917,-1.2527262,-1.2525261,-1.252513,-1.2524889,-1.2524748,-1.2524553,-1.2524119,-1.2523759,-1.25237,-1.252364,-1.2523418,-1.2524924,-1.2529087,-1.2529736,-1.2530832,-1.2531234,-1.2532213],"lat":[51.7518777,51.7518942,51.7517618,51.7517669,51.7516774,51.751727,51.7517523,51.7518009,51.7517298,51.7517211,51.7517224,51.7516415,51.7514573,51.7514435,51.7514297,51.7513779,51.7513531,51.7512804,51.7513851,51.7515855,51.7516705,51.7518777]}],[{"lng":[-1.254141,-1.2541314,-1.2541721,-1.254145,-1.2541323,-1.2541227,-1.2541402,-1.2541822,-1.2541797,-1.2540901,-1.2540543,-1.2540178,-1.2540153,-1.2539849,-1.2539488,-1.2539142,-1.253916,-1.2539163,-1.2539214,-1.2539174,-1.2537994,-1.2537653,-1.2530008,-1.2530515,-1.2530533,-1.253044,-1.2530434,-1.2530973,-1.2532779,-1.2533229,-1.2533741,-1.2534161,-1.2534193,-1.2535505,-1.25362,-1.2536775,-1.2537172,-1.2537564,-1.2538223,-1.254023,-1.2541628,-1.2541573,-1.2541391,-1.2541652,-1.254141],"lat":[51.750864,51.7506671,51.7506696,51.750554,51.750465,51.750389,51.7501972,51.7501953,51.7500551,51.7500492,51.7500486,51.7500486,51.7500722,51.7500693,51.7500714,51.7500913,51.7501084,51.7501259,51.7501527,51.7501726,51.7501833,51.7501878,51.7502878,51.7504697,51.7507269,51.7509375,51.7510055,51.7511461,51.7511072,51.7511008,51.7510831,51.7510823,51.7510908,51.7510895,51.7510883,51.7510891,51.751088,51.7510869,51.7510864,51.7510823,51.7510765,51.7510428,51.7509716,51.7509693,51.750864]}]],[[{"lng":[-1.2553241,-1.2552917,-1.2552587,-1.2551926,-1.2550417,-1.2550697,-1.254725,-1.2546932,-1.2545985,-1.2545932,-1.2545646,-1.2545025,-1.2552004,-1.2554736,-1.2555881,-1.2559209,-1.2561878,-1.2562156,-1.2562511,-1.2562771,-1.2562817,-1.2563044,-1.2563456,-1.256415,-1.2564413,-1.2564823,-1.2565602,-1.256464,-1.2562541,-1.2560784,-1.2559408,-1.2558717,-1.2556222,-1.2556068,-1.2556018,-1.2555884,-1.2555821,-1.2555495,-1.2553241],"lat":[51.7541752,51.7540622,51.7539763,51.7538042,51.7538264,51.7539018,51.7539527,51.75387,51.7538839,51.7538702,51.7537956,51.7536275,51.7535509,51.7535262,51.753505,51.7534489,51.7534083,51.7534787,51.7535732,51.7536232,51.7536333,51.7536867,51.7537825,51.7539252,51.7539761,51.7540555,51.7542064,51.7542283,51.7542622,51.75429,51.7543106,51.7543212,51.7543511,51.7543073,51.7542903,51.7542441,51.7542206,51.7541413,51.7541752]}],[{"lng":[-1.2566717,-1.256784,-1.2567701,-1.2568247,-1.2568182,-1.2566473,-1.2566717],"lat":[51.754157,51.7541386,51.754106,51.7540971,51.7540816,51.7541127,51.754157]}]],[[{"lng":[-1.2630228,-1.2627545,-1.2624964,-1.2623025,-1.2622049,-1.2623127,-1.2624811,-1.2633638,-1.2634781,-1.2637868,-1.2642348,-1.2643872,-1.2644907,-1.2645986,-1.2646405,-1.2645944,-1.2646431,-1.2646944,-1.2647078,-1.2642364,-1.2634408,-1.2632352,-1.2630228],"lat":[51.7617732,51.7617353,51.761357,51.761072,51.7609375,51.760922,51.7609183,51.760642,51.7605682,51.7605746,51.76062,51.7607369,51.7608194,51.7609386,51.7609872,51.7610015,51.7610617,51.7610389,51.7610526,51.761252,51.7615891,51.761692,51.7617732]}]],[[{"lng":[-1.2518566,-1.2528673,-1.2529153,-1.2530192,-1.2530009,-1.2529055,-1.2528453,-1.2527824,-1.2526467,-1.2526337,-1.2526255,-1.2526072,-1.2525997,-1.252563,-1.2525579,-1.2525541,-1.2525456,-1.2524753,-1.25245,-1.2523558,-1.2523309,-1.2521836,-1.2520304,-1.2518982,-1.2518105,-1.2518014,-1.2518121,-1.2518125,-1.251813,-1.2518177,-1.2518134,-1.2518149,-1.2518307,-1.2518566],"lat":[51.7560851,51.7561452,51.7561611,51.7561696,51.7561353,51.7559513,51.755835,51.7557166,51.7554528,51.7554315,51.7554181,51.7553836,51.7553186,51.755243,51.7552219,51.755206,51.755093,51.7550774,51.7550702,51.7550679,51.7550655,51.7550628,51.7550595,51.7550564,51.7550523,51.7551462,51.7551469,51.7553197,51.7555362,51.755666,51.7556785,51.7557289,51.7560311,51.7560851]}]],[[{"lng":[-1.2531564,-1.2531563,-1.253159,-1.2531587,-1.2531587,-1.2534145,-1.2537156,-1.2537419,-1.2537573,-1.2536644,-1.2536545,-1.2536508,-1.2536375,-1.2531746,-1.2530993,-1.2530908,-1.2530179,-1.2529937,-1.2530653,-1.2531171,-1.2531515,-1.2531055,-1.2531064,-1.2532981,-1.2535256,-1.2535617,-1.2537847,-1.2539476,-1.2539333,-1.2540145,-1.2540242,-1.2539577,-1.254075,-1.2540987,-1.2542091,-1.2541767,-1.2540985,-1.2540433,-1.2539601,-1.2538123,-1.2538036,-1.2538533,-1.2538095,-1.253832,-1.2538268,-1.2537953,-1.2537836,-1.2537607,-1.2537857,-1.253782,-1.2537508,-1.253733,-1.2537041,-1.253697,-1.2533986,-1.2532349,-1.2529809,-1.2529927,-1.2529932,-1.2531477,-1.2531564],"lat":[51.7541042,51.7541277,51.7542283,51.7543108,51.7544271,51.7544364,51.7544473,51.7544483,51.7545253,51.7545226,51.7545223,51.7546777,51.7546907,51.7546831,51.7546702,51.7547145,51.7547077,51.7548039,51.7548108,51.7548158,51.7548191,51.7549094,51.7550231,51.7550192,51.7550146,51.7550139,51.755001,51.7549915,51.7549088,51.7549026,51.754902,51.7547971,51.7547691,51.7547634,51.7547463,51.7547025,51.7545967,51.7545398,51.7545358,51.7545272,51.7544454,51.7544342,51.7542395,51.7542228,51.7542016,51.7541858,51.7541389,51.7540589,51.7540422,51.7540209,51.7540109,51.7539326,51.7538274,51.7538052,51.7538579,51.7538872,51.7539068,51.7540089,51.7540219,51.7540192,51.7541042]}]],[[{"lng":[-1.2573977,-1.2574118,-1.2574836,-1.2575988,-1.2576289,-1.2578486,-1.2578801,-1.2579175,-1.2581653,-1.2582134,-1.2582546,-1.2582909,-1.2583416,-1.2583444,-1.2582715,-1.2581711,-1.2580775,-1.2579228,-1.2576999,-1.2575135,-1.2572397,-1.2570574,-1.2566995,-1.2565544,-1.2564672,-1.2564361,-1.2563972,-1.2563915,-1.256337,-1.2563012,-1.2564733,-1.2566267,-1.2568868,-1.2569011,-1.2569556,-1.257224,-1.2572553,-1.2573977],"lat":[51.7530387,51.7530522,51.7531204,51.7532753,51.7533315,51.7532928,51.7533557,51.7533485,51.753301,51.7532918,51.7533742,51.7534466,51.7535413,51.7535466,51.7535581,51.753575,51.7535937,51.7536183,51.7536543,51.7536854,51.7537298,51.7537691,51.7538454,51.7538689,51.7536837,51.7536136,51.7535414,51.7535311,51.7534269,51.7533481,51.75331,51.7532761,51.753221,51.7532173,51.7532034,51.7530911,51.753077,51.7530387]}]],[[{"lng":[-1.2591654,-1.2592696,-1.2593384,-1.2592945,-1.2575306,-1.2574626,-1.2573963,-1.2570577,-1.2570915,-1.2570686,-1.2568465,-1.2567525,-1.2566282,-1.2570401,-1.2571409,-1.2572331,-1.2575895,-1.2577057,-1.2579061,-1.2580819,-1.2582437,-1.2585671,-1.2586103,-1.2586743,-1.2589845,-1.259049,-1.2591654],"lat":[51.7588654,51.7590852,51.7592302,51.75926,51.7596391,51.759522,51.7595346,51.7589437,51.7589376,51.7588971,51.7584702,51.7583034,51.7580874,51.7579683,51.7579391,51.7579125,51.7578094,51.757835,51.7580997,51.7582667,51.7583673,51.7585366,51.758561,51.758591,51.7587466,51.7587961,51.7588654]}]],[[{"lng":[-1.2606751,-1.2605564,-1.26034,-1.2603338,-1.260101,-1.2600952,-1.2599778,-1.2598645,-1.2597381,-1.2597453,-1.2597626,-1.2588809,-1.2588639,-1.2588561,-1.2590198,-1.2591809,-1.2597449,-1.2596927,-1.2595714,-1.2597473,-1.2598209,-1.2606751],"lat":[51.7645778,51.7636885,51.7636928,51.7636569,51.7636654,51.763576,51.7635797,51.7635835,51.7635873,51.763681,51.7639272,51.7639632,51.7640918,51.764205,51.7647406,51.7652597,51.7651208,51.7649524,51.7647085,51.7646409,51.7646022,51.7645778]}]],[[{"lng":[-1.2555844,-1.256104,-1.2554695,-1.2551493,-1.2549274,-1.2547513,-1.2545301,-1.2545219,-1.2542507,-1.2541599,-1.2541793,-1.2542162,-1.2540477,-1.2539949,-1.2539464,-1.2539729,-1.2538371,-1.2538207,-1.2537343,-1.2537098,-1.2537182,-1.2534559,-1.2527716,-1.2527962,-1.253006,-1.2530897,-1.2528355,-1.252674,-1.2526235,-1.2523902,-1.2517741,-1.2513771,-1.2511868,-1.2510526,-1.2509897,-1.2509905,-1.2509862,-1.2509336,-1.2508984,-1.2512267,-1.2521514,-1.2521685,-1.2522713,-1.2525936,-1.2527956,-1.2532202,-1.2538258,-1.2541724,-1.2544002,-1.2547588,-1.2547473,-1.254725,-1.2547597,-1.2546847,-1.2546933,-1.2547691,-1.2547818,-1.2548054,-1.2548651,-1.2549051,-1.2550582,-1.2551317,-1.2551956,-1.255362,-1.2555337,-1.2555639,-1.2555844],"lat":[51.7651665,51.7658573,51.7660367,51.765622,51.7656938,51.7657538,51.7658339,51.7658368,51.7659171,51.765944,51.7659691,51.7660261,51.7660691,51.7660858,51.7660994,51.7661355,51.7661736,51.7661511,51.7661753,51.7661836,51.7661943,51.7662723,51.7664734,51.7665182,51.7670192,51.7672712,51.767319,51.7671914,51.7671515,51.7671739,51.767126,51.7669895,51.7668402,51.7666049,51.7663947,51.7659615,51.7656669,51.7653994,51.765224,51.7651609,51.7649831,51.7649771,51.7649413,51.7647865,51.7646884,51.7645145,51.76426,51.7641354,51.7640535,51.7644142,51.7644186,51.7644267,51.7644616,51.7644901,51.7644985,51.7645744,51.7645874,51.7645783,51.7645551,51.7645946,51.7645538,51.7645358,51.7646222,51.7648435,51.7650933,51.7651369,51.7651665]}]],[[{"lng":[-1.2504052,-1.2501305,-1.2491482,-1.2488973,-1.249009,-1.2491083,-1.2492083,-1.2492304,-1.2493223,-1.2494472,-1.2502463,-1.2503542,-1.2504572,-1.2504052],"lat":[51.7593582,51.758992,51.7592139,51.7592711,51.7594198,51.7594539,51.7594868,51.7594813,51.7594614,51.7596639,51.7594852,51.7594593,51.7594347,51.7593582]}]],[[{"lng":[-1.2554728,-1.2552891,-1.2551744,-1.2551605,-1.2551571,-1.2551342,-1.2551195,-1.255112,-1.2550908,-1.255102,-1.2551121,-1.2551211,-1.2551267,-1.255125,-1.2551193,-1.2551093,-1.2550938,-1.2550799,-1.255111,-1.2551002,-1.2551806,-1.2552846,-1.255317,-1.2553351,-1.2553356,-1.2553391,-1.2553399,-1.2553402,-1.2553405,-1.2553248,-1.2553129,-1.2553538,-1.2553036,-1.2553903,-1.2557555,-1.2558273,-1.2558414,-1.2558703,-1.255845,-1.2558219,-1.2558191,-1.2558713,-1.2559984,-1.2560336,-1.256039,-1.2560689,-1.2560747,-1.256162,-1.2561752,-1.2559416,-1.255744,-1.2554728],"lat":[51.753475,51.7534768,51.7534779,51.7534184,51.7534046,51.7533123,51.7532414,51.7532054,51.7531128,51.7531099,51.7531039,51.753096,51.7530857,51.7530739,51.7530626,51.7530545,51.7530474,51.753045,51.7530413,51.7530007,51.7529961,51.7529918,51.7529463,51.7528543,51.7528455,51.752784,51.7526829,51.7526438,51.7526012,51.752571,51.7525345,51.7525261,51.752376,51.7523642,51.7523138,51.7523078,51.7523417,51.7524263,51.7525979,51.7526041,51.7527127,51.7528077,51.7530362,51.7530995,51.7531093,51.7531632,51.7531735,51.7533272,51.753348,51.7533902,51.753426,51.753475]}]],[[{"lng":[-1.2443164,-1.2441723,-1.2439101,-1.2436773,-1.2434816,-1.243424,-1.2420346,-1.2412729,-1.2409027,-1.2403448,-1.2403024,-1.2402517,-1.2402175,-1.2401977,-1.2401939,-1.2399495,-1.2399152,-1.239887,-1.2398483,-1.2398281,-1.2396417,-1.2395369,-1.2392274,-1.2390548,-1.238818,-1.2386407,-1.238571,-1.2384828,-1.2383178,-1.2381844,-1.2381537,-1.238163,-1.2381804,-1.2382556,-1.2382833,-1.2382695,-1.2382454,-1.2382404,-1.2382464,-1.2382774,-1.238281,-1.2382982,-1.2383274,-1.2383962,-1.2384392,-1.2384932,-1.2388837,-1.2393381,-1.2394353,-1.2396038,-1.2358571,-1.2359257,-1.2357977,-1.235693,-1.2356867,-1.237605,-1.2376077,-1.2375335,-1.2359024,-1.2358739,-1.2360341,-1.2361853,-1.2365301,-1.2380306,-1.2383937,-1.2381678,-1.2383113,-1.2390263,-1.2388922,-1.2388468,-1.2387794,-1.23886,-1.2393098,-1.24033,-1.2404666,-1.2407458,-1.2408165,-1.2409108,-1.2410212,-1.2411884,-1.2413729,-1.241549,-1.2417602,-1.2418539,-1.2421638,-1.2422759,-1.2423065,-1.2423758,-1.2426746,-1.2428711,-1.2430967,-1.2432966,-1.2434587,-1.2436304,-1.2439894,-1.2448179,-1.2453533,-1.2458476,-1.2459727,-1.2460161,-1.2460497,-1.246206,-1.2462657,-1.2463037,-1.2463166,-1.2465563,-1.2465952,-1.2466527,-1.2467189,-1.2467323,-1.2468806,-1.2468866,-1.2468964,-1.2469051,-1.246906,-1.2469833,-1.2469924,-1.2470008,-1.2470009,-1.247154,-1.2473272,-1.2475023,-1.2475247,-1.2475695,-1.2476134,-1.2476754,-1.2479858,-1.248268,-1.2482124,-1.2482377,-1.2482781,-1.248327,-1.2485764,-1.2486354,-1.2486171,-1.2484728,-1.2484482,-1.2484462,-1.2484429,-1.2483501,-1.2485537,-1.2486791,-1.2489578,-1.2490389,-1.2490549,-1.2490806,-1.2490645,-1.2490431,-1.2490299,-1.2489391,-1.2487747,-1.24874,-1.2486129,-1.2486076,-1.2479583,-1.2475668,-1.2466032,-1.2463439,-1.2462863,-1.2458106,-1.245629,-1.2456126,-1.2455166,-1.2453526,-1.2451865,-1.2446979,-1.2445316,-1.2444408,-1.2443164],"lat":[51.7547731,51.7547315,51.7546918,51.7546725,51.7546493,51.754562,51.7544591,51.7544026,51.7543694,51.7543827,51.7542408,51.7542364,51.7542208,51.7542043,51.7541836,51.7541529,51.7541666,51.7541732,51.7541648,51.754153,51.7541478,51.754142,51.7541084,51.7540762,51.7540497,51.7540789,51.7542038,51.7544322,51.7546301,51.754746,51.754799,51.7548866,51.7550226,51.7551221,51.7552652,51.7553209,51.7555056,51.7556158,51.7556905,51.7558339,51.7559757,51.7561192,51.7561659,51.7562023,51.7562563,51.7564694,51.7568823,51.7573873,51.7575379,51.7576641,51.7576275,51.757028,51.7565564,51.7563725,51.756231,51.7562376,51.7561829,51.755239,51.7552656,51.755225,51.7547768,51.7541561,51.753128,51.7535298,51.7530583,51.7529941,51.7527407,51.7529406,51.7531204,51.7532181,51.7533516,51.7533957,51.7533653,51.7535429,51.7535844,51.7533169,51.7532734,51.7532339,51.7531886,51.7531288,51.7530199,51.7529652,51.7528687,51.7528144,51.7526289,51.7525481,51.7525128,51.7525002,51.752361,51.7522377,51.7520976,51.7519526,51.751875,51.7518212,51.7517364,51.7515452,51.7514389,51.7513228,51.7513194,51.7513388,51.7513723,51.7514706,51.7514766,51.7514969,51.7515037,51.751607,51.7516233,51.7516444,51.7515919,51.7515823,51.7516535,51.7516493,51.7516484,51.7516524,51.7516598,51.751702,51.7517008,51.7517049,51.7517107,51.7517942,51.7518916,51.7519932,51.7520063,51.7520274,51.7520526,51.7520879,51.7522087,51.7522858,51.7523593,51.752365,51.7523734,51.7523008,51.7523772,51.752432,51.7525421,51.7530239,51.7531623,51.7531735,51.753192,51.754103,51.7543474,51.7545111,51.7547303,51.7547232,51.7548041,51.7548345,51.7548937,51.7549723,51.7549907,51.7550999,51.7552975,51.7553425,51.7553001,51.7553056,51.7551034,51.7550121,51.7547847,51.7547283,51.7548264,51.7548942,51.7552619,51.7552624,51.7552653,51.7553055,51.7553268,51.7551118,51.7549009,51.7548339,51.7547731]}],[{"lng":[-1.2487991,-1.2486424,-1.248622,-1.2486301,-1.2486589,-1.2486867,-1.2487173,-1.2487468,-1.2487857,-1.248828,-1.2488797,-1.2490495,-1.2491224,-1.249047,-1.2490521,-1.2490502,-1.2490475,-1.2490094,-1.2490065,-1.2490063,-1.2489985,-1.249005,-1.2490115,-1.2489748,-1.2489435,-1.2489307,-1.2489342,-1.248969,-1.2490165,-1.2490173,-1.2489145,-1.2487909,-1.2487991],"lat":[51.7532033,51.7532012,51.7530696,51.7528354,51.7527719,51.7526757,51.7526785,51.7526116,51.7524316,51.7524102,51.7524207,51.7524646,51.7524775,51.7525923,51.7526092,51.7526255,51.7526398,51.7528175,51.7528272,51.7528329,51.7529153,51.7529505,51.7529935,51.7530014,51.7530143,51.7530316,51.7530524,51.7530711,51.753076,51.7530982,51.7531027,51.7531082,51.7532033]}],[{"lng":[-1.2485476,-1.2482925,-1.2482102,-1.248051,-1.2479762,-1.2483316,-1.2488568,-1.2485476],"lat":[51.7522071,51.7521277,51.7521019,51.7520529,51.7520279,51.7516642,51.7518247,51.7522071]}],[{"lng":[-1.2491581,-1.2488115,-1.2488692,-1.2489632,-1.249013,-1.2490386,-1.2490792,-1.2490699,-1.2491464,-1.2491337,-1.2491894,-1.2491581],"lat":[51.7523295,51.7522763,51.7521851,51.7522117,51.7521995,51.752155,51.7521643,51.752188,51.7522031,51.7522397,51.7522462,51.7523295]}]],[[{"lng":[-1.2519106,-1.25215,-1.2522227,-1.2524354,-1.2534863,-1.2534878,-1.2540843,-1.2541291,-1.2541592,-1.2539136,-1.253799,-1.2537546,-1.2537159,-1.2526481,-1.2519106],"lat":[51.7568404,51.7575375,51.7576574,51.7579665,51.757663,51.7576224,51.7574245,51.7574126,51.7574025,51.7570342,51.7567852,51.7567111,51.7567139,51.756792,51.7568404]}]],[[{"lng":[-1.2521937,-1.2521053,-1.251959,-1.2518031,-1.2516281,-1.2514453,-1.2513739,-1.2512493,-1.2510947,-1.251041,-1.2507424,-1.2505537,-1.2496833,-1.249637,-1.249661,-1.2496132,-1.2495789,-1.2495334,-1.2493771,-1.2493528,-1.2488834,-1.2488568,-1.2487085,-1.2483316,-1.2488158,-1.2489834,-1.2494574,-1.2496387,-1.2498197,-1.2507549,-1.2507619,-1.2507879,-1.2508173,-1.2508271,-1.2509144,-1.2515615,-1.2519538,-1.2524927,-1.2529228,-1.2530008,-1.2530515,-1.2530533,-1.253044,-1.2530434,-1.2530973,-1.2530652,-1.2530163,-1.2528697,-1.2527054,-1.2523221,-1.2522174,-1.2521937],"lat":[51.7513123,51.7513259,51.7513466,51.7513713,51.7513961,51.7514154,51.7514212,51.7514343,51.7514488,51.7514562,51.7514971,51.7515089,51.7515667,51.7516536,51.7516586,51.7517452,51.7518196,51.7519002,51.7518664,51.7518957,51.7517803,51.7518247,51.7517707,51.7516642,51.7510897,51.7508724,51.7510439,51.7508493,51.7509074,51.7507615,51.7507434,51.7507314,51.750737,51.7507516,51.7507337,51.7506169,51.7505328,51.7504099,51.7503174,51.7502878,51.7504697,51.7507269,51.7509375,51.7510055,51.7511461,51.7511543,51.7511659,51.751196,51.7512207,51.7512926,51.7513082,51.7513123]}],[{"lng":[-1.251685,-1.2518602,-1.2519424,-1.25205,-1.2521726,-1.2523418,-1.252364,-1.25237,-1.2523759,-1.2524119,-1.2524553,-1.2524748,-1.2524889,-1.252513,-1.2522898,-1.2522693,-1.2522509,-1.2522242,-1.2521152,-1.2518626,-1.2518665,-1.2517588,-1.2513385,-1.251293,-1.2512572,-1.2512559,-1.2512474,-1.2514088,-1.2514412,-1.2514739,-1.2516228,-1.251685],"lat":[51.7514797,51.7514431,51.7514323,51.7514168,51.7513991,51.7513779,51.7514297,51.7514435,51.7514573,51.7516415,51.7517224,51.7517211,51.7517298,51.7518009,51.7518323,51.751791,51.7517685,51.7517163,51.751731,51.7517589,51.7517966,51.7518097,51.75186,51.7517324,51.7515645,51.7515594,51.7515282,51.7515099,51.7515061,51.7515023,51.751487,51.7514797]}]],[[{"lng":[-1.2525757,-1.252572,-1.2525551,-1.2524951,-1.2523225,-1.2523286,-1.2523454,-1.2523614,-1.2524982,-1.2525681,-1.2527064,-1.252715,-1.2527521,-1.2528258,-1.2528694,-1.2529353,-1.2529788,-1.2529809,-1.2529927,-1.2529932,-1.2531477,-1.2531564,-1.2531563,-1.253157,-1.253159,-1.2526502,-1.2525863,-1.2525439,-1.2525034,-1.2523359,-1.2523279,-1.2523221,-1.2523169,-1.2525313,-1.2530918,-1.2530454,-1.2531228,-1.2532536,-1.2535617,-1.25364,-1.2536271,-1.2536189,-1.2535767,-1.2535083,-1.2532777,-1.2532715,-1.2531852,-1.2531913,-1.2531246,-1.2530738,-1.2525181,-1.2524919,-1.2525377,-1.2524947,-1.2524813,-1.2524561,-1.2524045,-1.2523405,-1.2522844,-1.25212,-1.2520181,-1.2518905,-1.2518972,-1.2508621,-1.2498811,-1.2499019,-1.2499148,-1.2499231,-1.2499522,-1.2498754,-1.2498052,-1.2497273,-1.2493986,-1.2491991,-1.2491717,-1.2491138,-1.2490414,-1.2488086,-1.2487948,-1.2487897,-1.2486706,-1.2486613,-1.2486337,-1.2486189,-1.2486218,-1.2486119,-1.2486289,-1.2486389,-1.2486423,-1.2486424,-1.2487991,-1.2487909,-1.2489145,-1.2490173,-1.2490165,-1.248969,-1.2489342,-1.2489307,-1.2489435,-1.2489748,-1.2490115,-1.2490252,-1.2490486,-1.2492613,-1.2493724,-1.2496876,-1.2496776,-1.2497184,-1.2496346,-1.2505108,-1.25053,-1.250815,-1.251202,-1.251319,-1.2515097,-1.2515737,-1.2523062,-1.2523878,-1.2524427,-1.2524912,-1.2525326,-1.2525757],"lat":[51.7541313,51.7541101,51.7540556,51.753835,51.7538148,51.7537873,51.7537108,51.75352,51.753518,51.7535162,51.7535135,51.7535254,51.7536154,51.7537859,51.7538885,51.7538886,51.7538887,51.7539068,51.7540089,51.7540219,51.7540192,51.7541042,51.7541277,51.7541463,51.7542283,51.7541776,51.7541704,51.7541641,51.7541576,51.7541395,51.7541398,51.7541589,51.754176,51.7542,51.7542626,51.7544585,51.7544916,51.7545022,51.7545155,51.7545206,51.7545963,51.7546461,51.7546436,51.7546361,51.7546261,51.7546626,51.754657,51.7546214,51.7546167,51.7546128,51.754551,51.7546701,51.7546756,51.754828,51.7548755,51.7550139,51.7550105,51.7550066,51.7550025,51.7549954,51.7549794,51.754974,51.7549459,51.7548673,51.7547823,51.7546986,51.7546274,51.7545812,51.7543993,51.754391,51.7543835,51.7543751,51.7543397,51.7546415,51.754683,51.7546482,51.7545996,51.7544414,51.7544497,51.7544442,51.754315,51.7543049,51.7542633,51.7541893,51.754155,51.7541547,51.7535946,51.7533552,51.7532564,51.7532012,51.7532033,51.7531082,51.7531027,51.7530982,51.753076,51.7530711,51.7530524,51.7530316,51.7530143,51.7530014,51.7529935,51.753071,51.7530762,51.7530843,51.7530967,51.7531163,51.7531878,51.7531897,51.7537719,51.7537617,51.7537632,51.7537639,51.7537606,51.7537608,51.7537665,51.7537734,51.7538727,51.7538848,51.753936,51.7541209,51.754126,51.7541313]}]],[[{"lng":[-1.2618695,-1.2619562,-1.2624891,-1.2629402,-1.2636181,-1.2636439,-1.2634271,-1.2633583,-1.2632922,-1.2624525,-1.2623572,-1.262184,-1.2621324,-1.2621134,-1.262,-1.2619715,-1.2619653,-1.2619726,-1.2620182,-1.2620468,-1.2616228,-1.2618695],"lat":[51.7522649,51.7522994,51.7524845,51.752637,51.7528461,51.7529078,51.7531606,51.7532126,51.7532199,51.7531417,51.7531287,51.7530765,51.753056,51.753038,51.7529293,51.7528904,51.7528425,51.7527935,51.7527388,51.7526932,51.7525646,51.7522649]}]],[[{"lng":[-1.2539776,-1.253981,-1.2539856,-1.2539899,-1.2539949,-1.2539961,-1.2539972,-1.254003,-1.2540171,-1.2540203,-1.2540865,-1.2540847,-1.2541007,-1.2541576,-1.2542652,-1.2542957,-1.2543314,-1.2543359,-1.2543628,-1.2543725,-1.2544055,-1.2544384,-1.2544604,-1.2544897,-1.2545019,-1.2545202,-1.2545397,-1.2545556,-1.2546006,-1.2546476,-1.2546868,-1.2544672,-1.2543337,-1.2542692,-1.2541905,-1.2540493,-1.2540119,-1.2539989,-1.2539878,-1.253978,-1.2539104,-1.2539563,-1.2540022,-1.253492,-1.2534307,-1.2533611,-1.2533342,-1.25331,-1.2532644,-1.2532557,-1.2532501,-1.2531768,-1.2531627,-1.2531444,-1.2531334,-1.2530121,-1.2529908,-1.2532176,-1.2532186,-1.2533226,-1.2533247,-1.2536311,-1.253884,-1.2539927,-1.2539865,-1.253986,-1.2539843,-1.2539807,-1.2539641,-1.2539408,-1.253906,-1.2539776],"lat":[51.7520308,51.7519987,51.7519563,51.7519155,51.7518693,51.7518582,51.7518481,51.7517937,51.7516692,51.751632,51.7516328,51.7516712,51.7516716,51.751673,51.7516829,51.751687,51.751686,51.7516987,51.7516956,51.7517251,51.7517243,51.7517447,51.7517742,51.7517735,51.7518037,51.7518505,51.7518505,51.751886,51.7520119,51.7521433,51.7523149,51.7523494,51.7523703,51.7523805,51.7523928,51.752415,51.7522209,51.7521604,51.7521044,51.7520451,51.7520535,51.7522751,51.7524324,51.7524948,51.7523431,51.7521337,51.7520562,51.7519771,51.7518273,51.7517989,51.7517898,51.75167,51.7516469,51.7516042,51.7515785,51.7513274,51.7512669,51.751235,51.751213,51.7512162,51.7511933,51.7511787,51.7511683,51.7511612,51.751364,51.7513765,51.7514464,51.7515275,51.7516657,51.7517953,51.7520401,51.7520308]}]],[[{"lng":[-1.2584293,-1.2584473,-1.2584676,-1.2586998,-1.2586954,-1.2587145,-1.2587151,-1.2588959,-1.2588893,-1.2589788,-1.2589777,-1.2589615,-1.258963,-1.2589515,-1.2589491,-1.2589665,-1.2590074,-1.2590031,-1.259092,-1.2591146,-1.2593081,-1.2592938,-1.2593799,-1.2593897,-1.2593704,-1.2593874,-1.2593768,-1.2593753,-1.2591888,-1.2591757,-1.2593689,-1.2593271,-1.259144,-1.259129,-1.2588697,-1.2584293],"lat":[51.7498753,51.7497199,51.7494549,51.7494633,51.7493352,51.7493355,51.7493931,51.7493657,51.7493919,51.7493925,51.7494056,51.7494055,51.7494319,51.7494317,51.7494983,51.7494975,51.749502,51.7495169,51.7495273,51.7495291,51.7495504,51.7496002,51.7496102,51.7496124,51.7496839,51.7496857,51.7497251,51.749733,51.7497147,51.7497758,51.7497887,51.7499254,51.7499152,51.7499131,51.7498984,51.7498753]}],[{"lng":[-1.2589632,-1.2589473,-1.2588419,-1.258823,-1.258761,-1.2587486,-1.2585528,-1.2585359,-1.2584288,-1.2582221,-1.2581356,-1.2581185,-1.2579871,-1.2580161,-1.2580218,-1.257903,-1.2579245,-1.2579579,-1.2574653,-1.2573462,-1.2572394,-1.2570713,-1.2569313,-1.2569286,-1.2569128,-1.2569101,-1.257042,-1.2573573,-1.2573936,-1.2575376,-1.2576984,-1.2579789,-1.2581629,-1.2584637,-1.2588445,-1.2588647,-1.2588802,-1.2592954,-1.2592798,-1.2593197,-1.259326,-1.2593248,-1.2593459,-1.2593643,-1.2593696,-1.2593554,-1.2593428,-1.2593406,-1.2593394,-1.2593155,-1.259307,-1.259191,-1.2589632],"lat":[51.7506932,51.7506923,51.7506848,51.7506843,51.7506802,51.7506794,51.7506668,51.7506657,51.7506587,51.7506453,51.7506397,51.7506386,51.7506277,51.7504398,51.7504032,51.7503958,51.7503554,51.7502062,51.7501395,51.7501315,51.7501361,51.7501466,51.7501543,51.7501347,51.7500125,51.7497665,51.7497783,51.7498075,51.7498113,51.7498235,51.7498375,51.7498655,51.7498839,51.749901,51.7499223,51.749923,51.7499235,51.7499561,51.7500485,51.7503041,51.750372,51.7503857,51.7504992,51.7505887,51.7506379,51.7506392,51.7506404,51.7506606,51.750672,51.750672,51.7507016,51.750699,51.7506932]}]],[[{"lng":[-1.261334,-1.2613109,-1.2615672,-1.2616785,-1.2617833,-1.2620575,-1.2621068,-1.2620914,-1.2621345,-1.2621312,-1.2621493,-1.2621161,-1.2619735,-1.261909,-1.2618111,-1.2614866,-1.2615077,-1.2613586,-1.2613043,-1.261244,-1.2615563,-1.2615935,-1.2619315,-1.2619604,-1.2623236,-1.2621718,-1.2620469,-1.2624029,-1.2624712,-1.2628832,-1.2629841,-1.2632143,-1.2632504,-1.2633173,-1.2634424,-1.2636259,-1.2637103,-1.2638309,-1.263964,-1.2643852,-1.2641341,-1.2640016,-1.2638957,-1.2636829,-1.263247,-1.2629162,-1.2627636,-1.2627787,-1.262173,-1.2621262,-1.2619961,-1.2619574,-1.2619093,-1.2619404,-1.2618748,-1.2618869,-1.2617197,-1.2614903,-1.2614023,-1.261334],"lat":[51.7596474,51.7595303,51.7595091,51.7595149,51.7594893,51.7594435,51.7594311,51.7594073,51.7593851,51.7593433,51.7591404,51.7590864,51.7591925,51.7592238,51.7592592,51.7593255,51.7593693,51.7594009,51.7592765,51.7591132,51.7590023,51.7589892,51.758876,51.7589041,51.7587659,51.7586187,51.7584976,51.7583576,51.7584268,51.7582781,51.758386,51.7583006,51.7583477,51.7583279,51.758287,51.7582264,51.7583407,51.7584916,51.7586151,51.7589254,51.7590875,51.7589978,51.7590513,51.7592171,51.7594264,51.7595855,51.7596399,51.7596625,51.759846,51.7597859,51.7598205,51.7597705,51.7597841,51.7598223,51.7598417,51.7598569,51.7599074,51.7599764,51.759755,51.7596474]}]],[[{"lng":[-1.262012,-1.2604056,-1.2604844,-1.2605437,-1.2606612,-1.2607516,-1.2630202,-1.2627671,-1.2627509,-1.2625693,-1.262012],"lat":[51.7610837,51.7613211,51.7617226,51.7619865,51.7625118,51.7629158,51.7624326,51.7620879,51.7620658,51.7618247,51.7610837]}]],[[{"lng":[-1.2618634,-1.2630031,-1.2631905,-1.2636718,-1.2639766,-1.2641606,-1.2636703,-1.2635535,-1.2633652,-1.2634617,-1.2628591,-1.2626725,-1.262665,-1.262494,-1.2622222,-1.2621234,-1.2618634],"lat":[51.7628497,51.7625929,51.7626175,51.763293,51.7637474,51.764019,51.7641325,51.7639821,51.7640306,51.7641803,51.7643403,51.7640036,51.7639901,51.7638116,51.7635557,51.7633432,51.7628497]}]],[[{"lng":[-1.2434816,-1.2435039,-1.2446369,-1.2446774,-1.2446876,-1.2460478,-1.2460758,-1.2463987,-1.2462016,-1.2457605,-1.2455284,-1.2453554,-1.2453213,-1.2453285,-1.2451865,-1.2450806,-1.2450452,-1.2448749,-1.2447523,-1.2446979,-1.2445316,-1.2444408,-1.2443164,-1.2441723,-1.2439101,-1.2436773,-1.2434816],"lat":[51.7546493,51.7571511,51.7571426,51.7582498,51.758526,51.7580604,51.7580508,51.7580117,51.7576583,51.7567849,51.7563667,51.7560192,51.7555042,51.7553079,51.7553268,51.7552816,51.7552658,51.7551898,51.7551358,51.7551118,51.7549009,51.7548339,51.7547731,51.7547315,51.7546918,51.7546725,51.7546493]}]],[[{"lng":[-1.26142,-1.2604352,-1.2603958,-1.2601115,-1.2599365,-1.2611853,-1.2612511,-1.26142],"lat":[51.7565154,51.7567225,51.7566462,51.7567046,51.7563936,51.7561195,51.7562304,51.7565154]}]],[[{"lng":[-1.2502938,-1.2503141,-1.2504101,-1.2503954,-1.250365,-1.2503458,-1.2503703,-1.2503826,-1.2503972,-1.2504144,-1.2504442,-1.2504806,-1.2505108,-1.2496346,-1.2497184,-1.2496776,-1.2496876,-1.2493724,-1.2492613,-1.2490486,-1.2490252,-1.249005,-1.2490017,-1.2489985,-1.2490063,-1.2490065,-1.2490094,-1.2490475,-1.2490732,-1.2491322,-1.2492988,-1.2497204,-1.2498847,-1.2500511,-1.2499325,-1.2498587,-1.2498772,-1.2499216,-1.2500485,-1.2502938],"lat":[51.7529813,51.7529161,51.7529237,51.7530427,51.7531385,51.7531993,51.7532044,51.7532096,51.7532335,51.7532783,51.7534348,51.7536205,51.7537617,51.7537719,51.7531897,51.7531878,51.7531163,51.7530967,51.7530843,51.7530762,51.753071,51.7529505,51.7529309,51.7529153,51.7528329,51.7528272,51.7528175,51.7526398,51.7525906,51.7524883,51.7525207,51.7525962,51.7526389,51.7526758,51.752896,51.7529091,51.752912,51.75292,51.7529381,51.7529813]}]],[[{"lng":[-1.2453317,-1.2449578,-1.2462841,-1.2468262,-1.2468347,-1.2471327,-1.2467873,-1.2465954,-1.2463228,-1.2461144,-1.2460118,-1.2459178,-1.2458316,-1.2457286,-1.2456749,-1.2453736,-1.2452272,-1.2450493,-1.2448754,-1.2449062,-1.2450003,-1.2450162,-1.2450249,-1.2450957,-1.2451829,-1.2451996,-1.2452523,-1.2452812,-1.2453053,-1.2452835,-1.2456768,-1.2453317],"lat":[51.7482256,51.7478121,51.7473087,51.7470946,51.7471159,51.747864,51.7480264,51.748195,51.7483902,51.7485583,51.7487583,51.7489992,51.7491834,51.7495129,51.7497997,51.7497886,51.749763,51.7497461,51.7496547,51.7496093,51.7494886,51.7493891,51.7493243,51.7487993,51.7488041,51.7487955,51.7487846,51.7487755,51.7487614,51.7487403,51.7486016,51.7482256]}]],[[{"lng":[-1.2653681,-1.2653377,-1.2652272,-1.2636921,-1.2630947,-1.2625103,-1.2619345,-1.26186,-1.261771,-1.2616724,-1.2614153,-1.2613575,-1.261243,-1.2611655,-1.2615527,-1.261818,-1.2621905,-1.2630725,-1.2631644,-1.263233,-1.2646344,-1.265106,-1.2653681],"lat":[51.7668942,51.7669418,51.7669976,51.7672615,51.7673663,51.7674688,51.7675735,51.7675751,51.7675208,51.7672071,51.7664197,51.7662444,51.7658942,51.7656726,51.7655974,51.7655383,51.7654514,51.7653239,51.7653106,51.7652945,51.7649496,51.7660865,51.7668942]}]],[[{"lng":[-1.2582667,-1.2580872,-1.257806,-1.2583743,-1.2583532,-1.2586861,-1.2588592,-1.2589091,-1.2591569,-1.2593549,-1.2593492,-1.2593406,-1.2592651,-1.2590296,-1.258943,-1.2588264,-1.2580083,-1.2579788,-1.2579466,-1.257918,-1.2578847,-1.257853,-1.2578218,-1.2577912,-1.2577575,-1.2577024,-1.2576674,-1.2575647,-1.2567809,-1.2564248,-1.2564223,-1.2562957,-1.2562705,-1.2562373,-1.2555281,-1.2555037,-1.2575459,-1.2576939,-1.2580388,-1.2580232,-1.2581914,-1.2584301,-1.2586834,-1.2589454,-1.2589828,-1.2590017,-1.2590121,-1.2590519,-1.2590767,-1.2590816,-1.2591333,-1.2591579,-1.2591577,-1.2592593,-1.2592803,-1.2593029,-1.2593147,-1.2593396,-1.2593705,-1.2593621,-1.2594256,-1.2594313,-1.259464,-1.259488,-1.2595219,-1.2595661,-1.2595628,-1.2595477,-1.2596332,-1.2596604,-1.2597631,-1.2598293,-1.2598387,-1.2598857,-1.2592163,-1.2589629,-1.2588516,-1.2586093,-1.2582667],"lat":[51.7582695,51.758085,51.7577534,51.7575759,51.7575457,51.757454,51.7574039,51.7574691,51.7574106,51.7573681,51.7573579,51.7573423,51.7573531,51.757399,51.7574228,51.7573553,51.7575862,51.7575949,51.7576044,51.7576128,51.7576226,51.7576319,51.757641,51.75765,51.7576585,51.75758,51.7575293,51.757379,51.7575842,51.7576673,51.75766,51.7574376,51.7574158,51.7573872,51.7562796,51.7562416,51.7558889,51.7558634,51.7558039,51.7557651,51.7557393,51.7557039,51.7556664,51.7556296,51.7557547,51.7558133,51.7558427,51.7559738,51.7560478,51.7560629,51.7562345,51.756295,51.756313,51.7565846,51.756665,51.7567499,51.7568104,51.7570155,51.75714,51.7571794,51.7573272,51.7573403,51.7573988,51.7574353,51.7574895,51.7575812,51.7575983,51.7576599,51.7578155,51.7578834,51.7581556,51.7583222,51.7584151,51.7586432,51.7587571,51.7586142,51.7585505,51.7584279,51.7582695]}]],[[{"lng":[-1.2606147,-1.2609104,-1.2611335,-1.2613265,-1.2613831,-1.2614329,-1.2615371,-1.2616416,-1.2618588,-1.2618835,-1.2619053,-1.2619468,-1.2619596,-1.2619202,-1.2619216,-1.2618643,-1.261611,-1.2616228,-1.2618695,-1.2615717,-1.2614158,-1.2612856,-1.2611485,-1.2611296,-1.2609581,-1.2609312,-1.2609155,-1.2608212,-1.2607945,-1.260767,-1.260768,-1.2607292,-1.2606967,-1.2605781,-1.2605754,-1.2605278,-1.2604838,-1.2604713,-1.2603322,-1.260306,-1.2602922,-1.2602142,-1.2602351,-1.2601093,-1.260135,-1.2602222,-1.2602476,-1.2603331,-1.2606147],"lat":[51.7529569,51.7528627,51.7527904,51.7529415,51.7529707,51.7530378,51.752996,51.7529521,51.7528467,51.752789,51.7527813,51.7527668,51.7527371,51.7527162,51.7526805,51.7526619,51.7525794,51.7525646,51.7522649,51.7521454,51.7522156,51.7522742,51.7523359,51.7523304,51.7521791,51.7521557,51.7521592,51.7520279,51.7519823,51.7519821,51.751937,51.7519367,51.7519364,51.7519661,51.7519623,51.7519742,51.7520017,51.7520095,51.7520443,51.7520509,51.7520341,51.7520557,51.7520882,51.7521193,51.7521586,51.7523023,51.7523468,51.7524856,51.7529569]}]],[[{"lng":[-1.2520161,-1.2518112,-1.2515331,-1.2505724,-1.2505454,-1.2505439,-1.2505261,-1.2505149,-1.2504991,-1.2504833,-1.2504853,-1.2504856,-1.2505753,-1.251219,-1.2515128,-1.252322,-1.2523286,-1.2523454,-1.2523614,-1.2523593,-1.2523414,-1.2521985,-1.2521373,-1.2521184,-1.252077,-1.2520666,-1.252037,-1.2520161],"lat":[51.7528546,51.7528351,51.7528141,51.752759,51.7531656,51.753174,51.7531784,51.7531841,51.7531944,51.7532172,51.7532942,51.7533429,51.7537159,51.7537241,51.753718,51.7538171,51.7537873,51.7537108,51.75352,51.7535043,51.7533709,51.7533827,51.7533848,51.7533143,51.7531734,51.7531357,51.7529708,51.7528546]}]],[[{"lng":[-1.2580388,-1.2575459,-1.2555037,-1.2553578,-1.2553113,-1.2553004,-1.2549566,-1.2556912,-1.2555324,-1.2557208,-1.2556882,-1.2556657,-1.2556176,-1.2557581,-1.2557552,-1.2557943,-1.2557986,-1.2558384,-1.2558366,-1.2558862,-1.2558903,-1.2559396,-1.2559514,-1.2561083,-1.2565767,-1.2566085,-1.2567145,-1.2567572,-1.2568064,-1.2568936,-1.2570789,-1.2570646,-1.2571227,-1.2573114,-1.2574361,-1.2574683,-1.2574953,-1.2575783,-1.2575963,-1.257653,-1.2577026,-1.2577185,-1.2577797,-1.2578035,-1.2577749,-1.2578538,-1.2579049,-1.2583621,-1.2584285,-1.2584429,-1.2584652,-1.2589203,-1.2589454,-1.2586834,-1.2584301,-1.2581914,-1.2580232,-1.2580388],"lat":[51.7558039,51.7558889,51.7562416,51.7560208,51.7559914,51.7559325,51.7553979,51.755238,51.7549192,51.7548905,51.7548084,51.7547304,51.7545912,51.75457,51.7545594,51.7545544,51.7545638,51.7545575,51.7545468,51.7545402,51.7545519,51.7545454,51.7545711,51.7545504,51.7545047,51.7545041,51.7545,51.7544917,51.7544837,51.7544739,51.7548476,51.7548597,51.7549732,51.7549588,51.7551301,51.7551218,51.7551617,51.7552419,51.7552699,51.7552536,51.75532,51.7553412,51.7553475,51.7554224,51.7554725,51.7555848,51.7556476,51.7555287,51.7555201,51.7555677,51.7556096,51.7555524,51.7556296,51.7556664,51.7557039,51.7557393,51.7557651,51.7558039]}]],[[{"lng":[-1.2508002,-1.2510764,-1.2511969,-1.2512094,-1.2512183,-1.2512289,-1.2512708,-1.2513385,-1.2517588,-1.2518665,-1.2518626,-1.2521152,-1.2522242,-1.2522424,-1.2522509,-1.2522693,-1.2522898,-1.252513,-1.2525261,-1.2527262,-1.2529917,-1.2530323,-1.2530456,-1.2527372,-1.2527745,-1.2527391,-1.2527491,-1.2527671,-1.2527782,-1.2528268,-1.2528504,-1.2528787,-1.2529039,-1.2529449,-1.2529669,-1.253023,-1.2530376,-1.2528671,-1.2527475,-1.2525313,-1.2523349,-1.2522212,-1.2521199,-1.251999,-1.2519801,-1.2518594,-1.2517608,-1.2517506,-1.2517075,-1.2517002,-1.2516639,-1.2515047,-1.2514755,-1.2513005,-1.2511419,-1.2510843,-1.2507232,-1.2503977,-1.2504652,-1.250505,-1.2505321,-1.2505479,-1.2505862,-1.2505801,-1.2505485,-1.250572,-1.2505833,-1.2506268,-1.2506789,-1.25072,-1.2507455,-1.2507591,-1.2507593,-1.2507609,-1.2506517,-1.2506654,-1.250553,-1.2505432,-1.2497229,-1.2497234,-1.2497273,-1.2497373,-1.2497457,-1.2498821,-1.2499979,-1.2501193,-1.2502208,-1.2502372,-1.2503215,-1.250341,-1.2504623,-1.2508002],"lat":[51.7515791,51.7515338,51.7515217,51.7515672,51.7516116,51.7516798,51.7518827,51.75186,51.7518097,51.7517966,51.7517589,51.751731,51.7517163,51.7517569,51.7517685,51.751791,51.7518323,51.7518009,51.7517523,51.751727,51.7516774,51.7517669,51.7518302,51.7518466,51.752026,51.7520311,51.752097,51.7522142,51.7522874,51.7522724,51.7523094,51.7523057,51.752387,51.7523815,51.7525031,51.7525,51.7525507,51.7525682,51.7525822,51.7526112,51.7526253,51.7526283,51.752631,51.7526344,51.752635,51.7526384,51.7526418,51.7526486,51.7526486,51.7526415,51.7526396,51.75263,51.7526278,51.7526148,51.752603,51.7525913,51.7525356,51.7524853,51.7523555,51.752279,51.7522266,51.7521816,51.7520728,51.7520713,51.7520636,51.7520135,51.7520152,51.7520205,51.752026,51.7520299,51.7519534,51.7519167,51.7519154,51.7518969,51.75188,51.7518408,51.7518263,51.7518589,51.7517489,51.7517455,51.7517184,51.751681,51.751633,51.7516238,51.7516182,51.7516122,51.7516073,51.7516065,51.7516024,51.7516014,51.7515955,51.7515791]}]],[[{"lng":[-1.2533782,-1.2535021,-1.2535167,-1.2537117,-1.2538073,-1.2538876,-1.2542113,-1.2543827,-1.2544601,-1.2545352,-1.2546123,-1.2546492,-1.2547386,-1.2548777,-1.2549178,-1.2550474,-1.2550875,-1.2550989,-1.2551196,-1.2551463,-1.2553032,-1.2555112,-1.2555363,-1.2556302,-1.2555652,-1.2555741,-1.2556305,-1.255704,-1.2552853,-1.254195,-1.2541592,-1.2539136,-1.253799,-1.2537546,-1.2536058,-1.2534733,-1.2533611,-1.2533618,-1.2533546,-1.2533449,-1.253073,-1.2530346,-1.2530009,-1.2528453,-1.2527824,-1.2526467,-1.2526337,-1.2526255,-1.2526072,-1.2525997,-1.252563,-1.2525579,-1.2525541,-1.2525456,-1.2526379,-1.2527242,-1.2528709,-1.2530345,-1.253036,-1.2530532,-1.2530592,-1.253062,-1.2530664,-1.2530747,-1.2530892,-1.2531,-1.2531151,-1.2531373,-1.2531372,-1.2532279,-1.2533185,-1.2533464,-1.2533684,-1.253373,-1.2533711,-1.2533697,-1.2533782],"lat":[51.7550919,51.7550897,51.7550894,51.7550855,51.7550837,51.7550764,51.7550439,51.7550132,51.7551326,51.755231,51.7553188,51.7553605,51.7554849,51.7556846,51.7557392,51.7559298,51.7559901,51.7560046,51.7560329,51.7560819,51.756338,51.7566809,51.756717,51.7568522,51.7568716,51.7568826,51.7569335,51.7570458,51.7571415,51.7573952,51.7574025,51.7570342,51.7567852,51.7567111,51.7564627,51.7562433,51.7560805,51.7560901,51.7560955,51.7561,51.7561517,51.7561381,51.7561353,51.755835,51.7557166,51.7554528,51.7554315,51.7554181,51.7553836,51.7553186,51.755243,51.7552219,51.755206,51.755093,51.7550964,51.7550957,51.7550978,51.7550981,51.7551083,51.7551076,51.7551789,51.7551883,51.7551932,51.7552003,51.7552086,51.7552123,51.7552158,51.7552158,51.7551848,51.7551829,51.7551811,51.7551772,51.7551647,51.7551477,51.7551241,51.7550917,51.7550919]}]],[[{"lng":[-1.2564686,-1.2561096,-1.2560636,-1.255962,-1.255953,-1.2559503,-1.2559488,-1.2559361,-1.2559363,-1.2558404,-1.2554692,-1.255423,-1.2539666,-1.2541034,-1.2527932,-1.2525766,-1.2525463,-1.251623,-1.2509106,-1.2506445,-1.2504564,-1.250531,-1.2506203,-1.2505779,-1.2507904,-1.2508942,-1.2506716,-1.2503205,-1.2527977,-1.2528701,-1.2529698,-1.2530203,-1.2532785,-1.2533482,-1.2533592,-1.253682,-1.2546909,-1.2543898,-1.2547562,-1.2548394,-1.2549409,-1.2550421,-1.2551538,-1.2560315,-1.2561667,-1.2553135,-1.2554482,-1.2562877,-1.2566582,-1.2561754,-1.2562387,-1.2566258,-1.2566578,-1.2565742,-1.256722,-1.2567854,-1.2568944,-1.2572741,-1.2569758,-1.2578542,-1.2582805,-1.2574331,-1.2566365,-1.2564686],"lat":[51.7714039,51.7714869,51.7715072,51.7715588,51.7716108,51.7717262,51.7717927,51.7719461,51.7720563,51.7720648,51.7721057,51.7732505,51.7732674,51.7722129,51.7722519,51.7714902,51.7713837,51.7715146,51.7721254,51.7720351,51.7719902,51.7714519,51.7708722,51.7705586,51.7705055,51.7704995,51.770282,51.769609,51.769046,51.7691284,51.7691047,51.7691454,51.7696535,51.7699324,51.7701,51.7700292,51.7698079,51.7694059,51.769321,51.7694516,51.7696087,51.7697666,51.7699482,51.7697287,51.7699546,51.7701615,51.7703596,51.7701569,51.7707759,51.770902,51.7710095,51.7709116,51.7709679,51.7709882,51.7712211,51.7712057,51.7713775,51.7712883,51.7708187,51.770567,51.7713587,51.7715313,51.7716847,51.7714039]}]],[[{"lng":[-1.263245,-1.2632545,-1.2632092,-1.2632185,-1.2632194,-1.2632933,-1.2634811,-1.2635844,-1.2636791,-1.2647074,-1.2647785,-1.2648858,-1.2647985,-1.2648909,-1.265016,-1.2654562,-1.2659636,-1.2663085,-1.2665137,-1.2668189,-1.2671012,-1.2672011,-1.2673308,-1.2674102,-1.2676078,-1.2680053,-1.2683319,-1.2685249,-1.2689694,-1.2693045,-1.2695621,-1.2696724,-1.2697556,-1.2698944,-1.2699265,-1.2698273,-1.2698555,-1.2699379,-1.2700006,-1.2697512,-1.2697055,-1.2694297,-1.269106,-1.268919,-1.2690524,-1.2690282,-1.2688862,-1.268837,-1.2689328,-1.2689269,-1.2659389,-1.2653718,-1.2652727,-1.2646608,-1.2645106,-1.2644941,-1.2644817,-1.2644694,-1.2644584,-1.2639728,-1.2633389,-1.2632748,-1.263245],"lat":[51.7551936,51.7550797,51.7547439,51.7546389,51.7545695,51.7544627,51.7541033,51.753773,51.7536941,51.7535893,51.7537657,51.7538139,51.7538627,51.7539269,51.7539855,51.7541754,51.754387,51.7545405,51.7546335,51.7547785,51.754916,51.7549717,51.7550487,51.7551049,51.7552296,51.7554789,51.7556669,51.7557821,51.7560415,51.7562555,51.75642,51.7565147,51.7566049,51.7567602,51.7568075,51.7568287,51.7568665,51.7568457,51.756937,51.7570056,51.7570181,51.757094,51.7572166,51.757069,51.7570284,51.7569589,51.756988,51.756876,51.7568521,51.7567846,51.7566462,51.7566807,51.7561952,51.7562454,51.7562568,51.7561737,51.7561106,51.7560998,51.7560036,51.7560646,51.7560952,51.7554201,51.7551936]}]]],null,".",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6,"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>All Souls College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/All-Souls-College-Oxford/108582172500121?fref=ts&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.asc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Trinity Hall&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1438&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>  0&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>   9&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>   9&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Balliol College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.balliol.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>St John's College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1263&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>385&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 343&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 729&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Brasenose College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/Brasenose-College/110706878471?fref=ts&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.bnc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Gonville and Caius College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1509&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>360&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 234&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 597&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Christ Church&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/chchoxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.chch.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Trinity College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1546&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>442&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 203&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 645&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Corpus Christi College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/corpuschristi.collegeoxford?fref=ts&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.ccc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Corpus Christi College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1517&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>258&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>  98&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 358&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Exeter College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.exeter.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Emmanuel College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1314&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>343&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 233&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 602&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Green Templeton College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/136041343108222&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.gtc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>St Edmund's College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>2008&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td> 90&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 439&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 529&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Harris Manchester College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/Harris-Manchester-College-Oxford/103799396325713&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.hmc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Homerton College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1786&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>115&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 150&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 265&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Hertford College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/Hertford-College-Oxford/109172079100828?fref=ts&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.hertford.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>None&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1282&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>410&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 236&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 677&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Jesus College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/Jesus-College-Oxford/107863505907747?fref=ts&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.jesus.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Jesus College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1571&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>358&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 189&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 548&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Keble College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/Keble-College-Oxford/104060756298488&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.keble.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Selwyn College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1870&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>422&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 369&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 795&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Kellogg College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/154599147901076&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.kellogg.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>None&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1990&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>  0&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>1155&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>1155&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Lady Margaret Hall&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/Lady-Margaret-Hall-Oxford/267457673320515&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.lmh.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Newnham College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1878&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>405&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 212&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 641&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Linacre College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/Linacre-College/332592916772500&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.linacre.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Hughes Hall&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1962&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>  0&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 497&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 497&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Lincoln College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.linc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Downing College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1427&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>312&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 302&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 617&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>16&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Magdalen College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/magdcolloxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.magd.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Magdalene College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1458&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>390&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 178&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 575&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>17&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Mansfield College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/MansfieldCollegeOxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.mansfield.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Homerton College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1886&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>239&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 173&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 452&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>18&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Merton College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/MertonCollegeOxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.merton.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Peterhouse&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1264&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>302&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 232&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 536&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>19&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>New College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/newcollegeoxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.new.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>King's College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1379&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>418&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 295&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 723&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>20&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Nuffield College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/OxfordNuffieldCollege&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>https://www.nuffield.ox.ac.uk/pages/default.aspx&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>None&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1937&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>  0&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>  95&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>  95&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>21&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Oriel College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/OrielCollegeOxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.oriel.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Clare College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1326&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>323&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 200&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 528&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>22&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Pembroke College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/PembrokeOxfordAccess&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.pmb.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Queens' College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1624&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>378&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 220&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 627&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>23&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Somerville College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/SomervilleOxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.some.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Girton College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1879&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>425&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 209&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 634&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>24&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>St Anne's College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/St-Annes-College/115770988475692&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.st-annes.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Murray Edwards College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1879&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>439&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 352&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 828&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>25&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>St Antony's College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/St-Antonys-College-Oxford/109638552388674&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.sant.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Wolfson College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1950&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>  0&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 443&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 443&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>26&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>St Catherine's College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/StCatz&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.stcatz.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Robinson College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1868&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>505&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 428&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 983&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>27&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>St Cross College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.stx.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Clare Hall&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1965&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>  0&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 545&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 545&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>28&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>St Edmund Hall&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/StEdmundHall&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.seh.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Fitzwilliam College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1278&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>396&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 296&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 732&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>29&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>St Hilda's College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/St-Hildas-College-Oxford/112469235433797?rf=154173007943647&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.sthildas.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>None&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1893&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>399&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 183&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 582&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>30&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>St Hugh's College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/sthughscollegeadmissions&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.st-hughs.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Clare College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1886&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>425&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 366&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 792&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>31&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>St John's College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/stjohnsoxford?fref=ts&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.sjc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Sidney Sussex College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1555&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>395&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 236&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 634&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>32&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>St Peter's College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/spcadmissions&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.spc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>None&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1929&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>356&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 215&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 592&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>33&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>The Queen's College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/queenscollegeoxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.queens.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Pembroke College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1341&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>336&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 177&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 514&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>34&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Trinity College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/pages/Trinity-College-University-of-Oxford/55903340478&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.trinity.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Churchill College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1555&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>299&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 135&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 434&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>35&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>University College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/universitycollegeoxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.univ.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Trinity Hall&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1249&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>394&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 224&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 618&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>36&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Wadham College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/wadhamcollege&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.wadham.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Christ's College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1610&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>466&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 208&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 704&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>37&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Wolfson College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/wolfsoniansworldwide&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.wolfson.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Darwin College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1966&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>  0&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 581&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 581&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>38&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Worcester College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.worc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>St Catharine's College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1714&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>438&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 179&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td> 647&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-1.2700006,51.7470946,-1.2356867,51.7732674,true,".","Zoom to .","<strong> . <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],".",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["."],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"."}]}],"limits":{"lat":[51.7470946,51.7732674],"lng":[-1.2700006,-1.2356867]},"fitBounds":[51.7470946,-1.2700006,51.7732674,-1.2356867,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<p>How does this help us? Well, we can see that the colleges of the University are mostly clustered together around the city centre and there are some outliers like Wolfson College. If you clicked around a little, you’d also notice that some colleges have multiple sites (they’re MULTIPOLYGONS in the data).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">college_shapes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_geometry_type</span>(college_shapes) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MULTIPOLYGON"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapview</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zcol =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha.regions =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-ed4a7d48fbd3c8be6ed2" style="width:100%;height:464px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-ed4a7d48fbd3c8be6ed2">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-1.2532213,-1.2531249,-1.2530651,-1.2530323,-1.2529917,-1.2527262,-1.2525261,-1.252513,-1.2524889,-1.2524748,-1.2524553,-1.2524119,-1.2523759,-1.25237,-1.252364,-1.2523418,-1.2524924,-1.2529087,-1.2529736,-1.2530832,-1.2531234,-1.2532213],"lat":[51.7518777,51.7518942,51.7517618,51.7517669,51.7516774,51.751727,51.7517523,51.7518009,51.7517298,51.7517211,51.7517224,51.7516415,51.7514573,51.7514435,51.7514297,51.7513779,51.7513531,51.7512804,51.7513851,51.7515855,51.7516705,51.7518777]}],[{"lng":[-1.254141,-1.2541314,-1.2541721,-1.254145,-1.2541323,-1.2541227,-1.2541402,-1.2541822,-1.2541797,-1.2540901,-1.2540543,-1.2540178,-1.2540153,-1.2539849,-1.2539488,-1.2539142,-1.253916,-1.2539163,-1.2539214,-1.2539174,-1.2537994,-1.2537653,-1.2530008,-1.2530515,-1.2530533,-1.253044,-1.2530434,-1.2530973,-1.2532779,-1.2533229,-1.2533741,-1.2534161,-1.2534193,-1.2535505,-1.25362,-1.2536775,-1.2537172,-1.2537564,-1.2538223,-1.254023,-1.2541628,-1.2541573,-1.2541391,-1.2541652,-1.254141],"lat":[51.750864,51.7506671,51.7506696,51.750554,51.750465,51.750389,51.7501972,51.7501953,51.7500551,51.7500492,51.7500486,51.7500486,51.7500722,51.7500693,51.7500714,51.7500913,51.7501084,51.7501259,51.7501527,51.7501726,51.7501833,51.7501878,51.7502878,51.7504697,51.7507269,51.7509375,51.7510055,51.7511461,51.7511072,51.7511008,51.7510831,51.7510823,51.7510908,51.7510895,51.7510883,51.7510891,51.751088,51.7510869,51.7510864,51.7510823,51.7510765,51.7510428,51.7509716,51.7509693,51.750864]}]],[[{"lng":[-1.2553241,-1.2552917,-1.2552587,-1.2551926,-1.2550417,-1.2550697,-1.254725,-1.2546932,-1.2545985,-1.2545932,-1.2545646,-1.2545025,-1.2552004,-1.2554736,-1.2555881,-1.2559209,-1.2561878,-1.2562156,-1.2562511,-1.2562771,-1.2562817,-1.2563044,-1.2563456,-1.256415,-1.2564413,-1.2564823,-1.2565602,-1.256464,-1.2562541,-1.2560784,-1.2559408,-1.2558717,-1.2556222,-1.2556068,-1.2556018,-1.2555884,-1.2555821,-1.2555495,-1.2553241],"lat":[51.7541752,51.7540622,51.7539763,51.7538042,51.7538264,51.7539018,51.7539527,51.75387,51.7538839,51.7538702,51.7537956,51.7536275,51.7535509,51.7535262,51.753505,51.7534489,51.7534083,51.7534787,51.7535732,51.7536232,51.7536333,51.7536867,51.7537825,51.7539252,51.7539761,51.7540555,51.7542064,51.7542283,51.7542622,51.75429,51.7543106,51.7543212,51.7543511,51.7543073,51.7542903,51.7542441,51.7542206,51.7541413,51.7541752]}],[{"lng":[-1.2566717,-1.256784,-1.2567701,-1.2568247,-1.2568182,-1.2566473,-1.2566717],"lat":[51.754157,51.7541386,51.754106,51.7540971,51.7540816,51.7541127,51.754157]}]],[[{"lng":[-1.2443164,-1.2441723,-1.2439101,-1.2436773,-1.2434816,-1.243424,-1.2420346,-1.2412729,-1.2409027,-1.2403448,-1.2403024,-1.2402517,-1.2402175,-1.2401977,-1.2401939,-1.2399495,-1.2399152,-1.239887,-1.2398483,-1.2398281,-1.2396417,-1.2395369,-1.2392274,-1.2390548,-1.238818,-1.2386407,-1.238571,-1.2384828,-1.2383178,-1.2381844,-1.2381537,-1.238163,-1.2381804,-1.2382556,-1.2382833,-1.2382695,-1.2382454,-1.2382404,-1.2382464,-1.2382774,-1.238281,-1.2382982,-1.2383274,-1.2383962,-1.2384392,-1.2384932,-1.2388837,-1.2393381,-1.2394353,-1.2396038,-1.2358571,-1.2359257,-1.2357977,-1.235693,-1.2356867,-1.237605,-1.2376077,-1.2375335,-1.2359024,-1.2358739,-1.2360341,-1.2361853,-1.2365301,-1.2380306,-1.2383937,-1.2381678,-1.2383113,-1.2390263,-1.2388922,-1.2388468,-1.2387794,-1.23886,-1.2393098,-1.24033,-1.2404666,-1.2407458,-1.2408165,-1.2409108,-1.2410212,-1.2411884,-1.2413729,-1.241549,-1.2417602,-1.2418539,-1.2421638,-1.2422759,-1.2423065,-1.2423758,-1.2426746,-1.2428711,-1.2430967,-1.2432966,-1.2434587,-1.2436304,-1.2439894,-1.2448179,-1.2453533,-1.2458476,-1.2459727,-1.2460161,-1.2460497,-1.246206,-1.2462657,-1.2463037,-1.2463166,-1.2465563,-1.2465952,-1.2466527,-1.2467189,-1.2467323,-1.2468806,-1.2468866,-1.2468964,-1.2469051,-1.246906,-1.2469833,-1.2469924,-1.2470008,-1.2470009,-1.247154,-1.2473272,-1.2475023,-1.2475247,-1.2475695,-1.2476134,-1.2476754,-1.2479858,-1.248268,-1.2482124,-1.2482377,-1.2482781,-1.248327,-1.2485764,-1.2486354,-1.2486171,-1.2484728,-1.2484482,-1.2484462,-1.2484429,-1.2483501,-1.2485537,-1.2486791,-1.2489578,-1.2490389,-1.2490549,-1.2490806,-1.2490645,-1.2490431,-1.2490299,-1.2489391,-1.2487747,-1.24874,-1.2486129,-1.2486076,-1.2479583,-1.2475668,-1.2466032,-1.2463439,-1.2462863,-1.2458106,-1.245629,-1.2456126,-1.2455166,-1.2453526,-1.2451865,-1.2446979,-1.2445316,-1.2444408,-1.2443164],"lat":[51.7547731,51.7547315,51.7546918,51.7546725,51.7546493,51.754562,51.7544591,51.7544026,51.7543694,51.7543827,51.7542408,51.7542364,51.7542208,51.7542043,51.7541836,51.7541529,51.7541666,51.7541732,51.7541648,51.754153,51.7541478,51.754142,51.7541084,51.7540762,51.7540497,51.7540789,51.7542038,51.7544322,51.7546301,51.754746,51.754799,51.7548866,51.7550226,51.7551221,51.7552652,51.7553209,51.7555056,51.7556158,51.7556905,51.7558339,51.7559757,51.7561192,51.7561659,51.7562023,51.7562563,51.7564694,51.7568823,51.7573873,51.7575379,51.7576641,51.7576275,51.757028,51.7565564,51.7563725,51.756231,51.7562376,51.7561829,51.755239,51.7552656,51.755225,51.7547768,51.7541561,51.753128,51.7535298,51.7530583,51.7529941,51.7527407,51.7529406,51.7531204,51.7532181,51.7533516,51.7533957,51.7533653,51.7535429,51.7535844,51.7533169,51.7532734,51.7532339,51.7531886,51.7531288,51.7530199,51.7529652,51.7528687,51.7528144,51.7526289,51.7525481,51.7525128,51.7525002,51.752361,51.7522377,51.7520976,51.7519526,51.751875,51.7518212,51.7517364,51.7515452,51.7514389,51.7513228,51.7513194,51.7513388,51.7513723,51.7514706,51.7514766,51.7514969,51.7515037,51.751607,51.7516233,51.7516444,51.7515919,51.7515823,51.7516535,51.7516493,51.7516484,51.7516524,51.7516598,51.751702,51.7517008,51.7517049,51.7517107,51.7517942,51.7518916,51.7519932,51.7520063,51.7520274,51.7520526,51.7520879,51.7522087,51.7522858,51.7523593,51.752365,51.7523734,51.7523008,51.7523772,51.752432,51.7525421,51.7530239,51.7531623,51.7531735,51.753192,51.754103,51.7543474,51.7545111,51.7547303,51.7547232,51.7548041,51.7548345,51.7548937,51.7549723,51.7549907,51.7550999,51.7552975,51.7553425,51.7553001,51.7553056,51.7551034,51.7550121,51.7547847,51.7547283,51.7548264,51.7548942,51.7552619,51.7552624,51.7552653,51.7553055,51.7553268,51.7551118,51.7549009,51.7548339,51.7547731]}],[{"lng":[-1.2487991,-1.2486424,-1.248622,-1.2486301,-1.2486589,-1.2486867,-1.2487173,-1.2487468,-1.2487857,-1.248828,-1.2488797,-1.2490495,-1.2491224,-1.249047,-1.2490521,-1.2490502,-1.2490475,-1.2490094,-1.2490065,-1.2490063,-1.2489985,-1.249005,-1.2490115,-1.2489748,-1.2489435,-1.2489307,-1.2489342,-1.248969,-1.2490165,-1.2490173,-1.2489145,-1.2487909,-1.2487991],"lat":[51.7532033,51.7532012,51.7530696,51.7528354,51.7527719,51.7526757,51.7526785,51.7526116,51.7524316,51.7524102,51.7524207,51.7524646,51.7524775,51.7525923,51.7526092,51.7526255,51.7526398,51.7528175,51.7528272,51.7528329,51.7529153,51.7529505,51.7529935,51.7530014,51.7530143,51.7530316,51.7530524,51.7530711,51.753076,51.7530982,51.7531027,51.7531082,51.7532033]}],[{"lng":[-1.2485476,-1.2482925,-1.2482102,-1.248051,-1.2479762,-1.2483316,-1.2488568,-1.2485476],"lat":[51.7522071,51.7521277,51.7521019,51.7520529,51.7520279,51.7516642,51.7518247,51.7522071]}],[{"lng":[-1.2491581,-1.2488115,-1.2488692,-1.2489632,-1.249013,-1.2490386,-1.2490792,-1.2490699,-1.2491464,-1.2491337,-1.2491894,-1.2491581],"lat":[51.7523295,51.7522763,51.7521851,51.7522117,51.7521995,51.752155,51.7521643,51.752188,51.7522031,51.7522397,51.7522462,51.7523295]}]],[[{"lng":[-1.2521937,-1.2521053,-1.251959,-1.2518031,-1.2516281,-1.2514453,-1.2513739,-1.2512493,-1.2510947,-1.251041,-1.2507424,-1.2505537,-1.2496833,-1.249637,-1.249661,-1.2496132,-1.2495789,-1.2495334,-1.2493771,-1.2493528,-1.2488834,-1.2488568,-1.2487085,-1.2483316,-1.2488158,-1.2489834,-1.2494574,-1.2496387,-1.2498197,-1.2507549,-1.2507619,-1.2507879,-1.2508173,-1.2508271,-1.2509144,-1.2515615,-1.2519538,-1.2524927,-1.2529228,-1.2530008,-1.2530515,-1.2530533,-1.253044,-1.2530434,-1.2530973,-1.2530652,-1.2530163,-1.2528697,-1.2527054,-1.2523221,-1.2522174,-1.2521937],"lat":[51.7513123,51.7513259,51.7513466,51.7513713,51.7513961,51.7514154,51.7514212,51.7514343,51.7514488,51.7514562,51.7514971,51.7515089,51.7515667,51.7516536,51.7516586,51.7517452,51.7518196,51.7519002,51.7518664,51.7518957,51.7517803,51.7518247,51.7517707,51.7516642,51.7510897,51.7508724,51.7510439,51.7508493,51.7509074,51.7507615,51.7507434,51.7507314,51.750737,51.7507516,51.7507337,51.7506169,51.7505328,51.7504099,51.7503174,51.7502878,51.7504697,51.7507269,51.7509375,51.7510055,51.7511461,51.7511543,51.7511659,51.751196,51.7512207,51.7512926,51.7513082,51.7513123]}],[{"lng":[-1.251685,-1.2518602,-1.2519424,-1.25205,-1.2521726,-1.2523418,-1.252364,-1.25237,-1.2523759,-1.2524119,-1.2524553,-1.2524748,-1.2524889,-1.252513,-1.2522898,-1.2522693,-1.2522509,-1.2522242,-1.2521152,-1.2518626,-1.2518665,-1.2517588,-1.2513385,-1.251293,-1.2512572,-1.2512559,-1.2512474,-1.2514088,-1.2514412,-1.2514739,-1.2516228,-1.251685],"lat":[51.7514797,51.7514431,51.7514323,51.7514168,51.7513991,51.7513779,51.7514297,51.7514435,51.7514573,51.7516415,51.7517224,51.7517211,51.7517298,51.7518009,51.7518323,51.751791,51.7517685,51.7517163,51.751731,51.7517589,51.7517966,51.7518097,51.75186,51.7517324,51.7515645,51.7515594,51.7515282,51.7515099,51.7515061,51.7515023,51.751487,51.7514797]}]],[[{"lng":[-1.2584293,-1.2584473,-1.2584676,-1.2586998,-1.2586954,-1.2587145,-1.2587151,-1.2588959,-1.2588893,-1.2589788,-1.2589777,-1.2589615,-1.258963,-1.2589515,-1.2589491,-1.2589665,-1.2590074,-1.2590031,-1.259092,-1.2591146,-1.2593081,-1.2592938,-1.2593799,-1.2593897,-1.2593704,-1.2593874,-1.2593768,-1.2593753,-1.2591888,-1.2591757,-1.2593689,-1.2593271,-1.259144,-1.259129,-1.2588697,-1.2584293],"lat":[51.7498753,51.7497199,51.7494549,51.7494633,51.7493352,51.7493355,51.7493931,51.7493657,51.7493919,51.7493925,51.7494056,51.7494055,51.7494319,51.7494317,51.7494983,51.7494975,51.749502,51.7495169,51.7495273,51.7495291,51.7495504,51.7496002,51.7496102,51.7496124,51.7496839,51.7496857,51.7497251,51.749733,51.7497147,51.7497758,51.7497887,51.7499254,51.7499152,51.7499131,51.7498984,51.7498753]}],[{"lng":[-1.2589632,-1.2589473,-1.2588419,-1.258823,-1.258761,-1.2587486,-1.2585528,-1.2585359,-1.2584288,-1.2582221,-1.2581356,-1.2581185,-1.2579871,-1.2580161,-1.2580218,-1.257903,-1.2579245,-1.2579579,-1.2574653,-1.2573462,-1.2572394,-1.2570713,-1.2569313,-1.2569286,-1.2569128,-1.2569101,-1.257042,-1.2573573,-1.2573936,-1.2575376,-1.2576984,-1.2579789,-1.2581629,-1.2584637,-1.2588445,-1.2588647,-1.2588802,-1.2592954,-1.2592798,-1.2593197,-1.259326,-1.2593248,-1.2593459,-1.2593643,-1.2593696,-1.2593554,-1.2593428,-1.2593406,-1.2593394,-1.2593155,-1.259307,-1.259191,-1.2589632],"lat":[51.7506932,51.7506923,51.7506848,51.7506843,51.7506802,51.7506794,51.7506668,51.7506657,51.7506587,51.7506453,51.7506397,51.7506386,51.7506277,51.7504398,51.7504032,51.7503958,51.7503554,51.7502062,51.7501395,51.7501315,51.7501361,51.7501466,51.7501543,51.7501347,51.7500125,51.7497665,51.7497783,51.7498075,51.7498113,51.7498235,51.7498375,51.7498655,51.7498839,51.749901,51.7499223,51.749923,51.7499235,51.7499561,51.7500485,51.7503041,51.750372,51.7503857,51.7504992,51.7505887,51.7506379,51.7506392,51.7506404,51.7506606,51.750672,51.750672,51.7507016,51.750699,51.7506932]}]]],null,". - name",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":[0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#4B0055","#00588B","#009B95","#53CC67","#FDE333"],"fillOpacity":[1,1,1,1,1],"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Corpus Christi College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/corpuschristi.collegeoxford?fref=ts&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.ccc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Corpus Christi College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1517&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>258&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 98&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>358&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Exeter College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.exeter.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Emmanuel College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1314&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>343&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>233&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>602&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Magdalen College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/magdcolloxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.magd.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Magdalene College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1458&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>390&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>178&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>575&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Merton College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/MertonCollegeOxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.merton.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Peterhouse&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1264&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>302&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>232&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>536&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Pembroke College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/PembrokeOxfordAccess&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.pmb.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Queens' College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1624&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>378&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>220&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>627&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["Corpus Christi College","Exeter College","Magdalen College","Merton College","Pembroke College"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.8,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-1.2593897,51.7493352,-1.2356867,51.7576641,true,". - name","Zoom to . - name","<strong> . - name <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],". - name",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#00588B","#009B95","#53CC67","#FDE333"],"labels":["Corpus Christi College","Exeter College","Magdalen College","Merton College","Pembroke College"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":". - name","extra":null,"layerId":null,"className":"info legend","group":". - name"}]}],"limits":{"lat":[51.7493352,51.7576641],"lng":[-1.2593897,-1.2356867]},"fitBounds":[51.7493352,-1.2593897,51.7576641,-1.2356867,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<p>Fortunately, for all five of these colleges the largest polygon is the actual college and all other polygons can be considered superfluous to the calculation of where the centre of Oxford is. So how do we go about extracting the largest polygon from MULTIPOLYGON items?</p>
<p>Edzer Pebesma is the creator of <code>sf</code> and was kind enough to advise me <a href="https://twitter.com/edzerpebesma/status/1080835401756147712">on Twitter</a> that there’s an unexported function <code>largest_ring</code> that returns the largest polygon. Let’s re-do our data cleaning from above, but add three steps:</p>
<ul>
<li>Use <code>st_zm()</code> and <code>st_set_crs()</code> to remove the Z coordinates and set the projection of the data</li>
<li>Use <code>st_cast()</code> to convert all POLYGONs to MULTIPOLYGONs</li>
<li>Extract the largest polygon with <code>largest_ring()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">college_features <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(shape) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-3">  .[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb23-4">college_geometries <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sfc</span>(college_features) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_zm</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_set_crs</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_cast</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MULTIPOLYGON"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-8">  sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">largest_ring</span>()</span>
<span id="cb23-9"></span>
<span id="cb23-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_geometry</span>(college_nongeometric_data) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_geometries</span>
<span id="cb23-11">college_shapes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_nongeometric_data</span></code></pre></div>
</div>
<p>Now let’s check out the colleges from before which had multiple sites, looks like we’ve been successful!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">college_shapes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Corpus Christi College"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exeter College"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Magdalen College"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Merton College"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pembroke College"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mapview</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zcol =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-6156c057dd23dbe50b7c" style="width:100%;height:464px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-6156c057dd23dbe50b7c">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-1.254141,-1.2541314,-1.2541721,-1.254145,-1.2541323,-1.2541227,-1.2541402,-1.2541822,-1.2541797,-1.2540901,-1.2540543,-1.2540178,-1.2540153,-1.2539849,-1.2539488,-1.2539142,-1.253916,-1.2539163,-1.2539214,-1.2539174,-1.2537994,-1.2537653,-1.2530008,-1.2530515,-1.2530533,-1.253044,-1.2530434,-1.2530973,-1.2532779,-1.2533229,-1.2533741,-1.2534161,-1.2534193,-1.2535505,-1.25362,-1.2536775,-1.2537172,-1.2537564,-1.2538223,-1.254023,-1.2541628,-1.2541573,-1.2541391,-1.2541652,-1.254141],"lat":[51.750864,51.7506671,51.7506696,51.750554,51.750465,51.750389,51.7501972,51.7501953,51.7500551,51.7500492,51.7500486,51.7500486,51.7500722,51.7500693,51.7500714,51.7500913,51.7501084,51.7501259,51.7501527,51.7501726,51.7501833,51.7501878,51.7502878,51.7504697,51.7507269,51.7509375,51.7510055,51.7511461,51.7511072,51.7511008,51.7510831,51.7510823,51.7510908,51.7510895,51.7510883,51.7510891,51.751088,51.7510869,51.7510864,51.7510823,51.7510765,51.7510428,51.7509716,51.7509693,51.750864]}]],[[{"lng":[-1.2553241,-1.2552917,-1.2552587,-1.2551926,-1.2550417,-1.2550697,-1.254725,-1.2546932,-1.2545985,-1.2545932,-1.2545646,-1.2545025,-1.2552004,-1.2554736,-1.2555881,-1.2559209,-1.2561878,-1.2562156,-1.2562511,-1.2562771,-1.2562817,-1.2563044,-1.2563456,-1.256415,-1.2564413,-1.2564823,-1.2565602,-1.256464,-1.2562541,-1.2560784,-1.2559408,-1.2558717,-1.2556222,-1.2556068,-1.2556018,-1.2555884,-1.2555821,-1.2555495,-1.2553241],"lat":[51.7541752,51.7540622,51.7539763,51.7538042,51.7538264,51.7539018,51.7539527,51.75387,51.7538839,51.7538702,51.7537956,51.7536275,51.7535509,51.7535262,51.753505,51.7534489,51.7534083,51.7534787,51.7535732,51.7536232,51.7536333,51.7536867,51.7537825,51.7539252,51.7539761,51.7540555,51.7542064,51.7542283,51.7542622,51.75429,51.7543106,51.7543212,51.7543511,51.7543073,51.7542903,51.7542441,51.7542206,51.7541413,51.7541752]}]],[[{"lng":[-1.2443164,-1.2441723,-1.2439101,-1.2436773,-1.2434816,-1.243424,-1.2420346,-1.2412729,-1.2409027,-1.2403448,-1.2403024,-1.2402517,-1.2402175,-1.2401977,-1.2401939,-1.2399495,-1.2399152,-1.239887,-1.2398483,-1.2398281,-1.2396417,-1.2395369,-1.2392274,-1.2390548,-1.238818,-1.2386407,-1.238571,-1.2384828,-1.2383178,-1.2381844,-1.2381537,-1.238163,-1.2381804,-1.2382556,-1.2382833,-1.2382695,-1.2382454,-1.2382404,-1.2382464,-1.2382774,-1.238281,-1.2382982,-1.2383274,-1.2383962,-1.2384392,-1.2384932,-1.2388837,-1.2393381,-1.2394353,-1.2396038,-1.2358571,-1.2359257,-1.2357977,-1.235693,-1.2356867,-1.237605,-1.2376077,-1.2375335,-1.2359024,-1.2358739,-1.2360341,-1.2361853,-1.2365301,-1.2380306,-1.2383937,-1.2381678,-1.2383113,-1.2390263,-1.2388922,-1.2388468,-1.2387794,-1.23886,-1.2393098,-1.24033,-1.2404666,-1.2407458,-1.2408165,-1.2409108,-1.2410212,-1.2411884,-1.2413729,-1.241549,-1.2417602,-1.2418539,-1.2421638,-1.2422759,-1.2423065,-1.2423758,-1.2426746,-1.2428711,-1.2430967,-1.2432966,-1.2434587,-1.2436304,-1.2439894,-1.2448179,-1.2453533,-1.2458476,-1.2459727,-1.2460161,-1.2460497,-1.246206,-1.2462657,-1.2463037,-1.2463166,-1.2465563,-1.2465952,-1.2466527,-1.2467189,-1.2467323,-1.2468806,-1.2468866,-1.2468964,-1.2469051,-1.246906,-1.2469833,-1.2469924,-1.2470008,-1.2470009,-1.247154,-1.2473272,-1.2475023,-1.2475247,-1.2475695,-1.2476134,-1.2476754,-1.2479858,-1.248268,-1.2482124,-1.2482377,-1.2482781,-1.248327,-1.2485764,-1.2486354,-1.2486171,-1.2484728,-1.2484482,-1.2484462,-1.2484429,-1.2483501,-1.2485537,-1.2486791,-1.2489578,-1.2490389,-1.2490549,-1.2490806,-1.2490645,-1.2490431,-1.2490299,-1.2489391,-1.2487747,-1.24874,-1.2486129,-1.2486076,-1.2479583,-1.2475668,-1.2466032,-1.2463439,-1.2462863,-1.2458106,-1.245629,-1.2456126,-1.2455166,-1.2453526,-1.2451865,-1.2446979,-1.2445316,-1.2444408,-1.2443164],"lat":[51.7547731,51.7547315,51.7546918,51.7546725,51.7546493,51.754562,51.7544591,51.7544026,51.7543694,51.7543827,51.7542408,51.7542364,51.7542208,51.7542043,51.7541836,51.7541529,51.7541666,51.7541732,51.7541648,51.754153,51.7541478,51.754142,51.7541084,51.7540762,51.7540497,51.7540789,51.7542038,51.7544322,51.7546301,51.754746,51.754799,51.7548866,51.7550226,51.7551221,51.7552652,51.7553209,51.7555056,51.7556158,51.7556905,51.7558339,51.7559757,51.7561192,51.7561659,51.7562023,51.7562563,51.7564694,51.7568823,51.7573873,51.7575379,51.7576641,51.7576275,51.757028,51.7565564,51.7563725,51.756231,51.7562376,51.7561829,51.755239,51.7552656,51.755225,51.7547768,51.7541561,51.753128,51.7535298,51.7530583,51.7529941,51.7527407,51.7529406,51.7531204,51.7532181,51.7533516,51.7533957,51.7533653,51.7535429,51.7535844,51.7533169,51.7532734,51.7532339,51.7531886,51.7531288,51.7530199,51.7529652,51.7528687,51.7528144,51.7526289,51.7525481,51.7525128,51.7525002,51.752361,51.7522377,51.7520976,51.7519526,51.751875,51.7518212,51.7517364,51.7515452,51.7514389,51.7513228,51.7513194,51.7513388,51.7513723,51.7514706,51.7514766,51.7514969,51.7515037,51.751607,51.7516233,51.7516444,51.7515919,51.7515823,51.7516535,51.7516493,51.7516484,51.7516524,51.7516598,51.751702,51.7517008,51.7517049,51.7517107,51.7517942,51.7518916,51.7519932,51.7520063,51.7520274,51.7520526,51.7520879,51.7522087,51.7522858,51.7523593,51.752365,51.7523734,51.7523008,51.7523772,51.752432,51.7525421,51.7530239,51.7531623,51.7531735,51.753192,51.754103,51.7543474,51.7545111,51.7547303,51.7547232,51.7548041,51.7548345,51.7548937,51.7549723,51.7549907,51.7550999,51.7552975,51.7553425,51.7553001,51.7553056,51.7551034,51.7550121,51.7547847,51.7547283,51.7548264,51.7548942,51.7552619,51.7552624,51.7552653,51.7553055,51.7553268,51.7551118,51.7549009,51.7548339,51.7547731]}]],[[{"lng":[-1.2521937,-1.2521053,-1.251959,-1.2518031,-1.2516281,-1.2514453,-1.2513739,-1.2512493,-1.2510947,-1.251041,-1.2507424,-1.2505537,-1.2496833,-1.249637,-1.249661,-1.2496132,-1.2495789,-1.2495334,-1.2493771,-1.2493528,-1.2488834,-1.2488568,-1.2487085,-1.2483316,-1.2488158,-1.2489834,-1.2494574,-1.2496387,-1.2498197,-1.2507549,-1.2507619,-1.2507879,-1.2508173,-1.2508271,-1.2509144,-1.2515615,-1.2519538,-1.2524927,-1.2529228,-1.2530008,-1.2530515,-1.2530533,-1.253044,-1.2530434,-1.2530973,-1.2530652,-1.2530163,-1.2528697,-1.2527054,-1.2523221,-1.2522174,-1.2521937],"lat":[51.7513123,51.7513259,51.7513466,51.7513713,51.7513961,51.7514154,51.7514212,51.7514343,51.7514488,51.7514562,51.7514971,51.7515089,51.7515667,51.7516536,51.7516586,51.7517452,51.7518196,51.7519002,51.7518664,51.7518957,51.7517803,51.7518247,51.7517707,51.7516642,51.7510897,51.7508724,51.7510439,51.7508493,51.7509074,51.7507615,51.7507434,51.7507314,51.750737,51.7507516,51.7507337,51.7506169,51.7505328,51.7504099,51.7503174,51.7502878,51.7504697,51.7507269,51.7509375,51.7510055,51.7511461,51.7511543,51.7511659,51.751196,51.7512207,51.7512926,51.7513082,51.7513123]}]],[[{"lng":[-1.2589632,-1.2589473,-1.2588419,-1.258823,-1.258761,-1.2587486,-1.2585528,-1.2585359,-1.2584288,-1.2582221,-1.2581356,-1.2581185,-1.2579871,-1.2580161,-1.2580218,-1.257903,-1.2579245,-1.2579579,-1.2574653,-1.2573462,-1.2572394,-1.2570713,-1.2569313,-1.2569286,-1.2569128,-1.2569101,-1.257042,-1.2573573,-1.2573936,-1.2575376,-1.2576984,-1.2579789,-1.2581629,-1.2584637,-1.2588445,-1.2588647,-1.2588802,-1.2592954,-1.2592798,-1.2593197,-1.259326,-1.2593248,-1.2593459,-1.2593643,-1.2593696,-1.2593554,-1.2593428,-1.2593406,-1.2593394,-1.2593155,-1.259307,-1.259191,-1.2589632],"lat":[51.7506932,51.7506923,51.7506848,51.7506843,51.7506802,51.7506794,51.7506668,51.7506657,51.7506587,51.7506453,51.7506397,51.7506386,51.7506277,51.7504398,51.7504032,51.7503958,51.7503554,51.7502062,51.7501395,51.7501315,51.7501361,51.7501466,51.7501543,51.7501347,51.7500125,51.7497665,51.7497783,51.7498075,51.7498113,51.7498235,51.7498375,51.7498655,51.7498839,51.749901,51.7499223,51.749923,51.7499235,51.7499561,51.7500485,51.7503041,51.750372,51.7503857,51.7504992,51.7505887,51.7506379,51.7506392,51.7506404,51.7506606,51.750672,51.750672,51.7507016,51.750699,51.7506932]}]]],null,". - name",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":[0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#4B0055","#00588B","#009B95","#53CC67","#FDE333"],"fillOpacity":[0.6,0.6,0.6,0.6,0.6],"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Corpus Christi College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/corpuschristi.collegeoxford?fref=ts&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.ccc.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Corpus Christi College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1517&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>258&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td> 98&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>358&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Exeter College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>NA&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.exeter.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Emmanuel College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1314&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>343&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>233&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>602&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Magdalen College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/magdcolloxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.magd.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Magdalene College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1458&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>390&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>178&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>575&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Merton College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/MertonCollegeOxford&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.merton.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Peterhouse&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1264&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>302&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>232&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>536&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>name&emsp;<\/th><td>Pembroke College&emsp;<\/td><\/tr><tr><td>2<\/td><th>social_facebook&emsp;<\/th><td>https://www.facebook.com/PembrokeOxfordAccess&emsp;<\/td><\/tr><tr><td>3<\/td><th>website&emsp;<\/th><td>http://www.pmb.ox.ac.uk/&emsp;<\/td><\/tr><tr><td>4<\/td><th>sister.college&emsp;<\/th><td>Queens' College&emsp;<\/td><\/tr><tr><td>5<\/td><th>foundation.year&emsp;<\/th><td>1624&emsp;<\/td><\/tr><tr><td>6<\/td><th>undergraduates&emsp;<\/th><td>378&emsp;<\/td><\/tr><tr><td>7<\/td><th>post.graduates&emsp;<\/th><td>220&emsp;<\/td><\/tr><tr><td>8<\/td><th>total.students&emsp;<\/th><td>627&emsp;<\/td><\/tr><tr><td>9<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["Corpus Christi College","Exeter College","Magdalen College","Merton College","Pembroke College"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-1.2593696,51.7497665,-1.2356867,51.7576641,true,". - name","Zoom to . - name","<strong> . - name <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],". - name",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#4B0055","#00588B","#009B95","#53CC67","#FDE333"],"labels":["Corpus Christi College","Exeter College","Magdalen College","Merton College","Pembroke College"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":". - name","extra":null,"layerId":null,"className":"info legend","group":". - name"}]}],"limits":{"lat":[51.7497665,51.7576641],"lng":[-1.2593696,-1.2356867]},"fitBounds":[51.7497665,-1.2593696,51.7576641,-1.2356867,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<p>It makes sense to export this now nicely formatted GIS data for use in the actual visualisation scripts. GeoJSON is my preferred GIS data format, and we can create that directly using <code>write_sf()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">college_shapes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2019-02-18_oxford-centres"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shapefiles_oxford_colleges.json"</span>),</span>
<span id="cb25-3">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">driver =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GeoJSON"</span>)</span></code></pre></div>
</div>
</section>
<section id="visualising-college-shapefiles-with-ggmap" class="level3">
<h3 class="anchored" data-anchor-id="visualising-college-shapefiles-with-ggmap">Visualising college shapefiles with <code>ggmap</code></h3>
<p><code>ggmap</code> is the best tool for obtaining static map tiles for inclusion in <code>ggplot2</code> charts, most folks prefer the Google Maps tiles. Unfortunately, since July 2018 users need to provide Google with billing details in order to obtain map tiles. Read my <a href="https://www.visibledata.co.uk/posts/2018/12/05/2018-12-05-using-ggmap-after-july-2018/">blogpost on how to setup your Google Maps API Key</a> before running the code below.</p>
<p>At the time of writing (January 2018), the version of <code>ggmap</code> on CRAN doesn’t support the new API changes. Run <code>packageVersion("ggmap")</code> in your console, if the version is higher than 2.7 then you’re in luck! If not, you need to install the development version of the package as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">devtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_github</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dkahle/ggmap"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyup"</span>)</span></code></pre></div>
</div>
<p>Let’s create a new script file for visualising the college shapes, <code>oxford-college-shapes.R</code>. We’ll need to load the following packages at the top of the script</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb27-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"here"</span>)</span>
<span id="cb27-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggmap"</span>)</span>
<span id="cb27-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span>)</span>
<span id="cb27-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"glue"</span>)</span>
<span id="cb27-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggrepel"</span>)</span></code></pre></div>
</div>
<p>Our GIS data was exported in the previous section, let’s import it ready for use in this script:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">college_shapes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2019-02-18_oxford-centres"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shapefiles_oxford_colleges.json"</span>))</span></code></pre></div>
</div>
<p>Before creating our maps we need to register our Google Maps token using <code>register_google()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">register_google</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My-FAKE-KEY"</span>)</span></code></pre></div>
</div>
<div class="cell">

</div>
<p><code>get_googlemap()</code> gets us a map from the Google Maps API but requires both a center and (integer) zoom level, I’ve fiddled around for a while and think the following work well for us.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">base_map <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_googlemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.257411</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.7601055</span>), </span>
<span id="cb30-2">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maptype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"roadmap"</span>,</span>
<span id="cb30-3">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoom =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>)</span></code></pre></div>
</div>
<p>In order to create <code>ggplot2</code> charts containing map tiles from <code>ggmap</code> we need to start with the <code>ggmap()</code> function and add layers with <code>+</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1">gg_oxford_city <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(base_map)</span>
<span id="cb31-2">gg_oxford_city <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> college_shapes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/index_files/figure-html/2018-12-29-oxford-centres-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is too busy a map to really communicate anything, it would be great if we could remove some of the labels and landmarks from the base map. To do that, we need to use the <code>style</code> argument of <code>ggmap()</code>.</p>
<p>The <a href="https://developers.google.com/maps/documentation/javascript/examples/hiding-features">Google Maps JavaScript API</a> doesn’t make it easy to figure out how to manipulate multiple styles at once. <a href="https://developers.google.com/maps/documentation/maps-static/styling">This page</a> advises, “do not combine multiple operations into a single style operation”. What’s that mean?!</p>
<ul>
<li>If modifying just <em>one</em> style, we can give the <code>style</code> argument a vector</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_googlemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.257411</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.7601055</span>), </span>
<span id="cb32-2">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maptype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"roadmap"</span>,</span>
<span id="cb32-3">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoom =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,</span>
<span id="cb32-4">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">feature =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"feature:poi.park"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">visiblity =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/index_files/figure-html/style-ggmap-one-argument-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>If modifying more than one style, we need to give a string containing multiple styles</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_googlemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.257411</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.7601055</span>), </span>
<span id="cb33-2">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maptype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"roadmap"</span>,</span>
<span id="cb33-3">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoom =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,</span>
<span id="cb33-4">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;style=feature:poi|visibility:off&amp;style=feature:poi.park|visibility:on&amp;style=feature:landscape.man_made|visibility:off"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/index_files/figure-html/style-ggmap-multiple-arguments-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s create a utility function for creating these style strings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">make_ggmap_styles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(styles){</span>
<span id="cb34-2">  styles <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;style=feature:{feature}|visibility:{visibility}"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(style) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-5">    .[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb34-7">}</span></code></pre></div>
</div>
<p>Here are the things we’d like to show/hide:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1">my_styles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb35-2">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>feature, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>visibility,</span>
<span id="cb35-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"poi"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>,</span>
<span id="cb35-4">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"poi.park"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"on"</span>,</span>
<span id="cb35-5">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"landscape.man_made"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span></span>
<span id="cb35-6">) </span></code></pre></div>
</div>
<p>Now we have a good looking <code>gg_oxford_city</code> that we can play with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1">base_map <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_googlemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.257411</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.7601055</span>), </span>
<span id="cb36-2">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maptype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"roadmap"</span>,</span>
<span id="cb36-3">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoom =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,</span>
<span id="cb36-4">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> my_styles <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb36-5">                            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">make_ggmap_styles</span>())</span>
<span id="cb36-6">gg_oxford_city <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(base_map)</span>
<span id="cb36-7">gg_oxford_city</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/index_files/figure-html/styled-base-map-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It’s really incredibly how flexible the <code>ggplot2</code> extensions system is, we can label <code>sf</code> objects using <code>ggrepel::goem_label_repel</code> with barely any effort. The only effort I did expend was on choosing a good value for <code>nudge_x</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">gg_oxford_city <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> college_shapes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb37-3">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> foundation.year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1300</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb37-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label_repel</span>(</span>
<span id="cb37-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> college_shapes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-6">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.list)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb37-7">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(foundation.year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1300</span>),</span>
<span id="cb37-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> name, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geometry =</span> geometry),</span>
<span id="cb37-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf_coordinates"</span>,</span>
<span id="cb37-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nudge_x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb37-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb37-12">  )</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/index_files/figure-html/2018-12-29-oxford-centres-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="animating-the-centre-of-mass-over-time" class="level3">
<h3 class="anchored" data-anchor-id="animating-the-centre-of-mass-over-time">Animating the centre of mass over time</h3>
<p>Now we’ve finally got to the point that we can compute the centre of the colleges over time! Let’s create a new script file <code>college-centres-over-time.R</code> and load our libraries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb38-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggmap"</span>)</span>
<span id="cb38-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf"</span>)</span>
<span id="cb38-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"glue"</span>)</span>
<span id="cb38-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggrepel"</span>)</span></code></pre></div>
</div>
<p>Again, we need to import our GIS data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1">college_shapes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posts"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2019-02-18_oxford-centres"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shapefiles_oxford_colleges.json"</span>))</span></code></pre></div>
</div>
<p>We also need to ensure that we register with the Google Maps API when running this script and set-up our base map again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">make_ggmap_styles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(styles){</span>
<span id="cb40-2">  styles <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&amp;style=feature:{feature}|visibility:{visibility}"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(style) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-5">    .[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb40-7">}</span>
<span id="cb40-8">my_styles <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb40-9">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>feature, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>visibility,</span>
<span id="cb40-10">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"poi"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>,</span>
<span id="cb40-11">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"poi.park"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"on"</span>,</span>
<span id="cb40-12">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"landscape.man_made"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span></span>
<span id="cb40-13">)</span>
<span id="cb40-14">base_map <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_googlemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.257411</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">51.7601055</span>), </span>
<span id="cb40-15">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maptype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"roadmap"</span>,</span>
<span id="cb40-16">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zoom =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,</span>
<span id="cb40-17">                          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> my_styles <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb40-18">                            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">make_ggmap_styles</span>())</span>
<span id="cb40-19">gg_oxford_city <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(base_map)</span></code></pre></div>
</div>
<p>Let’s see how the centre of mass of the colleges changes each century. I’ve created <code>century_cut()</code> which wraps <code>cut()</code> to create prettified centuries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">century_cut <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, upper, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,</span>
<span id="cb41-2">                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">above.char =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>) {</span>
<span id="cb41-3"></span>
<span id="cb41-4"> labs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(lower, upper <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> by, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> by),</span>
<span id="cb41-5">                 <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(lower <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> by <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, upper <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> by),</span>
<span id="cb41-6">                 <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> sep),</span>
<span id="cb41-7">           <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(upper, above.char, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>))</span>
<span id="cb41-8"></span>
<span id="cb41-9"> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">floor</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(lower, upper, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> by), <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">Inf</span>),</span>
<span id="cb41-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">right =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> labs)</span>
<span id="cb41-11">}</span>
<span id="cb41-12"></span>
<span id="cb41-13"></span>
<span id="cb41-14">colleges_by_century <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> college_shapes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb41-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">century =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">century_cut</span>(foundation.year, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1200</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>))</span>
<span id="cb41-16"></span>
<span id="cb41-17"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Messy code to display just the name and century of creation</span></span>
<span id="cb41-18">display_colleges_by_century <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> colleges_by_century <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb41-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(name, century)</span>
<span id="cb41-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_geometry</span>(display_colleges_by_century) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb41-21">display_colleges_by_century <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb41-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(century)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 38 × 2
# Groups:   century [9]
   name                century  
   &lt;chr&gt;               &lt;fct&gt;    
 1 Balliol College     1200-1299
 2 Hertford College    1200-1299
 3 Merton College      1200-1299
 4 St Edmund Hall      1200-1299
 5 University College  1200-1299
 6 Exeter College      1300-1399
 7 New College         1300-1399
 8 Oriel College       1300-1399
 9 The Queen's College 1300-1399
10 All Souls College   1400-1499
# … with 28 more rows</code></pre>
</div>
</div>
<p>Now we’ve done this we can calculate the centres for each century:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1">colleges_by_century <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb43-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(century) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb43-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geometry =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_union</span>(geometry)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb43-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_centroid</span>()</span>
<span id="cb43-5"></span>
<span id="cb43-6"></span>
<span id="cb43-7">century_centres <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> colleges_by_century <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb43-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(century) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb43-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geometry =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_union</span>(geometry)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb43-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_centroid</span>()</span>
<span id="cb43-11"></span>
<span id="cb43-12">gg_century_centres <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_oxford_city <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> colleges_by_century,</span>
<span id="cb43-14">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> century), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> century_centres,</span>
<span id="cb43-16">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> century,</span>
<span id="cb43-17">              <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label_repel</span>(</span>
<span id="cb43-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> century_centres,</span>
<span id="cb43-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> century, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> century, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geometry =</span> geometry),</span>
<span id="cb43-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf_coordinates"</span>,</span>
<span id="cb43-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span id="cb43-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nudge_x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb43-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb43-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb43-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>,</span>
<span id="cb43-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb43-28">  )</span>
<span id="cb43-29">gg_century_centres <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_century_centres <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Centre of Oxford colleges established in each century"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb43-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_viridis_d</span>()</span>
<span id="cb43-33">gg_century_centres</span></code></pre></div>
</div>
<p><img src="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/gg_century_centres.png" class="img-fluid" style="width:100.0%"></p>
<div class="cell">

</div>
<p>Now we’ve established the centre of the colleges for each century, let’s compute the cumulative centres as time progresses. For simplicity, let’s throw away all of the data except for the longitude and latitude of the centre of mass in each century. The <code>centre_over_time_period()</code> function returns the centre of mass for all colleges established within the specific time period:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">centre_over_time_period <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(shapes, lower, upper){</span>
<span id="cb44-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print("a")</span></span>
<span id="cb44-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressWarnings</span>(shapes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(foundation.year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> lower <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> foundation.year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> upper) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_centroid</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_combine</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_centroid</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_coordinates</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">long =</span> X,</span>
<span id="cb44-11">           <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lat =</span> Y))</span>
<span id="cb44-12">}</span>
<span id="cb44-13"></span>
<span id="cb44-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">centre_over_time_period</span>(college_shapes,</span>
<span id="cb44-15">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>,</span>
<span id="cb44-16">                        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1600</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
   long   lat
  &lt;dbl&gt; &lt;dbl&gt;
1 -1.26  51.8</code></pre>
</div>
</div>
<p>Using <code>pmap()</code> we can calculate the cumulative college centres:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1">time_periods <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb46-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1200</span>,</span>
<span id="cb46-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">upper =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1300</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb46-4">)</span>
<span id="cb46-5"></span>
<span id="cb46-6">centres_through_history <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> time_periods <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">centre =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmap</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(lower, upper), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(lower, upper) {</span>
<span id="cb46-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">centre_over_time_period</span>(college_shapes,</span>
<span id="cb46-9">  lower,</span>
<span id="cb46-10">  upper)</span>
<span id="cb46-11">  })) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(centre)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"long"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lat"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_set_crs</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time_period =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{lower} - {upper}"</span>))</span></code></pre></div>
</div>
<p>We can visualise these cumulative centres using <code>geom_label_repel()</code>, just as above. But with carefully selected nudge factors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1">gg_centres_through_time <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_oxford_city <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># geom_sf(data = centres_through_history) +</span></span>
<span id="cb47-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label_repel</span>(</span>
<span id="cb47-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> centres_through_history,</span>
<span id="cb47-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> time_period, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> time_period, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geometry =</span> geometry),</span>
<span id="cb47-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>,</span>
<span id="cb47-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">segment.color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb47-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sf_coordinates"</span>,</span>
<span id="cb47-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">min.segment.length =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,</span>
<span id="cb47-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nudge_x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(centres_through_history), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb47-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nudge_y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.007</span>, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.007</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(centres_through_history), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb47-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb47-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">seed =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb47-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb47-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fontface =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>,</span>
<span id="cb47-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb47-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Centres of University of Oxford through time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb47-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_viridis_d</span>()</span>
<span id="cb47-20">gg_centres_through_time</span></code></pre></div>
</div>
<p><img src="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/gg_centres_through_time.png" class="img-fluid" style="width:100.0%"></p>
<p>I’m slightly late to the <code>gganimate</code> bandwagon, but let’s animate this! The <code>transition_states()</code> function will create a GIF that transitions through the <code>time_period</code> column, and I’ve used <code>shadow_wake()</code> so that the centre of mass can be tracked more easily by the reader.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gganimate"</span>)</span>
<span id="cb48-2">anim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> gg_oxford_city <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_sf</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> centres_through_history, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit.aes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transition_states</span>(time_period,</span>
<span id="cb48-5">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">transition_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb48-6">                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">state_length =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb48-7">anim <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb48-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enter_fade</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb48-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shadow_wake</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wake_length =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb48-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exit_shrink</span>()</span>
<span id="cb48-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anim_save</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"oxford-centres.gif"</span>))</span></code></pre></div>
</div>
<p><img src="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/oxford-centres.gif" class="img-fluid"></p>
<p>I’d really love to be happy with this GIF, but it’s really not good! The main issue is that <code>ggamp</code> only allows integer zoom levels, so the map is either far too zoomed in or out. It’s also quite slow to experiment with <code>geom_sf</code> at the moment, I’m quite excited for <a href="https://twitter.com/thomasp85/status/1093874268809674752">Thomas Pederson’s promise to speed up <code>geom_sf</code></a>.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2019,
  author = {Charlotte Hadley},
  title = {Where Is the Centre of {University} of {Oxford?}},
  date = {2019-02-18},
  url = {https://visibledata.co.uk/posts/2019-02-18_oxford-centres},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2019" class="csl-entry quarto-appendix-citeas">
Charlotte Hadley. 2019. <span>“Where Is the Centre of University of
Oxford?”</span> February 18, 2019. <a href="https://visibledata.co.uk/posts/2019-02-18_oxford-centres">https://visibledata.co.uk/posts/2019-02-18_oxford-centres</a>.
</div></div></section></div> ]]></description>
  <category>dataviz</category>
  <category>GIS</category>
  <guid>https://visibledata.co.uk/posts/2019-02-18_oxford-centres/</guid>
  <pubDate>Mon, 18 Feb 2019 00:00:00 GMT</pubDate>
  <media:content url="https://visibledata.co.uk/posts/2019-02-18_oxford-centres/gg_centres_through_time.png" medium="image" type="image/png" height="86" width="144"/>
</item>
<item>
  <title>Keeping secrets in blogdown</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2019-01-02_keeping-secrets-in-blogdown/</link>
  <description><![CDATA[ 




<p>Sometimes we need to keep secrets. For instance, <a href="https://www.visibledata.co.uk/posts/2019-02-18_oxford-centres/">if you want to use <code>ggmap</code> after July 2018</a> you need an API key and to provide billing details to Google. You <strong>definitely</strong> don’t want to accidentally include your personal API key in a blog post.</p>
<p>This blog is generated using the awesome <code>blogdown</code> package, which means all this wonderful stuff is generated from RMarkdown documents that are available in the Github repository <a href="https://github.com/visibledata/visibledata.github.io">visibledata/visibledata.github.io</a> that powers the website. It’s therefore extremely important I don’t accidentally include the key anywhere in my repository. But I want to consistently use API keys anywhere in the website.</p>
<p>If you want to do something similar, I recommend following these instructions:</p>
<ol type="1">
<li>Add the following lines to your <code>.gitignore</code> file</li>
</ol>
<ul>
<li><p>data/secret-keys.R</p></li>
<li><p>data/secret-vault.vault</p></li>
</ul>
<ol start="2" type="1">
<li><p>Add these changes to a commit and push these to Github.</p></li>
<li><p>Don’t proceed until you’ve done step 2. You need to protect these two files.</p></li>
<li><p>You’re going to need to create an SSH key, so either load up the terminal (-nix systems) or Command Prompt (Windows) and run the following code (I chose <code>blog_vault</code> as the name for my file).</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ssh-keygen</span> <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">-t</span> rsa</span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Enter file in which to save the key (/Users/charliejhadley/.ssh/id_rsa):</span></span></code></pre></div>
</div>
<p>Now we’re going to create the <code>static/data/secret-keys.R</code> file where we will iteratively add our tokens and other secrets using <a href="https://github.com/gaborcsardi/secret">Gabor Csardi’s awesome <code>secret</code> package</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secret"</span>)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"here"</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## ==== Create a vault</span></span>
<span id="cb2-5"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Run these lines ONCE ONLY</span></span>
<span id="cb2-6">my_vault <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secret-vault.vault"</span>)</span>
<span id="cb2-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">create_vault</span>(my_vault)</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## ==== Create a user</span></span>
<span id="cb2-10"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## This uses the ssh-key we created above, run this code ONCE ONLY</span></span>
<span id="cb2-11">key_dir <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/charliejhadley/.ssh"</span></span>
<span id="cb2-12">charliejhadley_public_key <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.path</span>(key_dir, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blog_vault.pub"</span>)</span>
<span id="cb2-13">charliejhadley_private_key <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.path</span>(key_dir, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blog_vault"</span>)</span>
<span id="cb2-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_user</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charliejhadley"</span>, charliejhadley_public_key, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vault =</span> my_vault)</span></code></pre></div>
</div>
<p>Once you’ve run this code, I’d recommend you explicitly comment out everything except for the first two lines.</p>
<p>Now we can add a secrets to the vault using <code>add_secret()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_secret</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggmaps_fake_key"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foobar"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">user =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charliejhadley"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vault =</span> my_vault)</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_secret</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggmap_key_2020"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AIzaSyABTxwpq4Ds2rOgOtblyZeco_QKXJdPruo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">user =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"charliejhadley"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vault =</span> my_vault)</span></code></pre></div>
</div>
<p>Personally, I’m deleting secrets from the <code>static/data/secret-keys.R</code> after I add them. I’d recommend that you do the same. <strong>Remember that if you have not disabled your .RHistory then your keys will be available to ne’er-do-wells in a plain text file.</strong></p>
<p>Now I can use my keys safely in blogposts, as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"here"</span>)</span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secret"</span>)</span>
<span id="cb4-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyverse"</span>)</span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggmap"</span>)</span>
<span id="cb4-5"></span>
<span id="cb4-6">my_vault <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"secret-vault.vault"</span>)</span>
<span id="cb4-7">charliejhadley_private_key <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">file.path</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/.ssh"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blog_vault"</span>)</span>
<span id="cb4-8">ggmaps_rstats_key <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_secret</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggmap_key_2020"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> charliejhadley_private_key, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vault =</span> my_vault)</span>
<span id="cb4-9"></span>
<span id="cb4-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">register_google</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> ggmaps_rstats_key)</span>
<span id="cb4-11">base_map <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_googlemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.2945</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">48.858222</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maptype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"roadmap"</span>)</span>
<span id="cb4-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(base_map)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://visibledata.co.uk/posts/2019-01-02_keeping-secrets-in-blogdown/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I highly recommend <a href="https://cran.r-project.org/web/packages/httr/vignettes/secrets.html">Hadley Wickham’s httr vignette on managing secrets</a> if you want to learn more.</p>



<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2019,
  author = {Charlotte Hadley},
  title = {Keeping Secrets in Blogdown},
  date = {2019-01-02},
  url = {https://visibledata.co.uk/posts/2019-01-02_keeping-secrets-in-blogdown},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2019" class="csl-entry quarto-appendix-citeas">
Charlotte Hadley. 2019. <span>“Keeping Secrets in Blogdown.”</span>
January 2, 2019. <a href="https://visibledata.co.uk/posts/2019-01-02_keeping-secrets-in-blogdown">https://visibledata.co.uk/posts/2019-01-02_keeping-secrets-in-blogdown</a>.
</div></div></section></div> ]]></description>
  <guid>https://visibledata.co.uk/posts/2019-01-02_keeping-secrets-in-blogdown/</guid>
  <pubDate>Wed, 02 Jan 2019 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Using ggmap after July 2018</title>
  <dc:creator>Charlie Hadley</dc:creator>
  <dc:creator>Charlie Joey Hadley</dc:creator>
  <link>https://visibledata.co.uk/posts/2018-12-05-using-ggmap-after-july-2018/</link>
  <description><![CDATA[ 





<p><code>ggmap</code> is an awesome package for creating maps with <code>ggplot2</code>. If you’ve seen a nice looking map built with <code>ggplot2</code> I can almost guarantee you that it uses <code>ggmap</code> to look that good. The <code>ggmap</code> package is used to obtain base maps from the APIs of a number of online mapping tools, the one we care about here is the base maps from Google Maps (because they’re very good).</p>
<p>If you’re reading instructions for using <code>ggmap</code> written before July 2018 <strong>you will fail to replicate the results</strong> unless you make some changes to your workflow. <strong>You will need to give Google your billing information, but can create maps for free</strong>.</p>
<!-- <div class="row"> -->
<!-- <div class="col-sm-6"> -->
<!-- <a class="btn btn-primary btn-block" data-toggle="collapse" href="#whats-an-api" role="button" aria-expanded="false" aria-controls="collapseExample"> -->
<!--     What's an API? -->
<!-- </a> -->
<!-- </div> -->
<!-- <div class="col-sm-6"> -->
<!--   <a class="btn btn-primary btn-block" data-toggle="collapse" href="#what-are-base-maps" role="button" aria-expanded="false" aria-controls="collapseExample"> -->
<!--     What are base maps? -->
<!--   </a> -->
<!-- </div> -->
<!-- </div> -->
<!-- <div class="collapse" id="whats-an-api"> -->
<!--   <div class="card card-body"> -->
<!-- A defined set of interactions with a service to send and receive data. In the case of mapping tools you'll find many API, including one for converting street addresses into longitude and latitudes. -->
<!--   <br/> -->
<!--   </div> -->
<!-- </div> -->
<!-- <div class="collapse" id="what-are-base-maps"> -->
<!--   <div class="card card-body"> -->
<!-- Base maps are the backgrounds of maps. -->
<!--   <br/> -->
<!--   </div> -->
<!-- </div> -->
<section id="whats-changed" class="level2">
<h2 class="anchored" data-anchor-id="whats-changed">What’s changed?</h2>
<p>Before July 2018 it was possible to use the Google Maps API for free without configuration or use account, this is now no longer possible. See the <a href="https://cloud.google.com/maps-platform/pricing/">pricing page</a> for explicit details from Google themselves.</p>
<p>You must do the following to obtain base maps from Google:</p>
<ul>
<li><p>Have a Google Cloud account.</p></li>
<li><p>Enable the Google Maps Platform.</p></li>
<li><p>Provide Google with your billing details.</p></li>
</ul>
<p>You will then be allocated $200 of free usage per month, every month. All API calls will be made against these limits.</p>
<p>If you’re exclusively making static maps with <code>ggmap</code> then <em>you’re extremely unlikely to ever be charged by Google</em>. I’ve summarised the <a href="https://developers.google.com/maps/billing/understanding-cost-of-use">pricing policy</a> as of December 2018 below:</p>
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-b9c0d536f88f46555929" style="width:100%;height:100%;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-b9c0d536f88f46555929">{"x":{"url":"index_files/figure-html//widgets/widget_static-map-pricing.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="lets-make-our-maps" class="level2">
<h2 class="anchored" data-anchor-id="lets-make-our-maps">Let’s make our maps</h2>
<p>We’ll break this into two stages:</p>
<ol type="1">
<li><p>Preparing our Google Maps Platform account</p></li>
<li><p>Setting up and using <code>ggmap</code></p></li>
</ol>
<section id="preparing-our-google-maps-platform-account" class="level3">
<h3 class="anchored" data-anchor-id="preparing-our-google-maps-platform-account">Preparing our Google Maps Platform account</h3>
<ol type="1">
<li><p>Navigate to <a href="https://cloud.google.com/maps-platform/">https://cloud.google.com/maps-platform/</a> and click “Get Started”</p></li>
<li><p>Select “Maps” in the dialog, leave the other things for another tutorial.</p></li>
</ol>
<p><img src="https://visibledata.co.uk/blog/2018-12-05-using-ggmap-after-july-2018/2018-12-05_google-maps-platform-dialog.png" style="width:450px"></p>
<ol start="3" type="1">
<li>Create a new project for tracking your <code>ggmap</code>-incurred expenses, I suggest using the name <code>ggmap</code></li>
</ol>
<p><img src="https://visibledata.co.uk/blog/2018-12-05-using-ggmap-after-july-2018/2018-12-05_google-maps-platform-project.png" style="width:450px"></p>
<ol start="4" type="1">
<li><p>You’ll be prompted to create a billing account, click “create a billing account”</p></li>
<li><p>Select your country, agree to the terms and conditions, and make a decision about marketing. Please note you’ll likely be told you’re getting $300 per month rather than $200 for 12 months, it’s because Google are trying to keep devs happy during the roll out.</p></li>
</ol>
<p><img src="https://visibledata.co.uk/blog/2018-12-05-using-ggmap-after-july-2018/2018-12-05_google-maps-platform_create-billing-account.png" style="width:450px"></p>
<ol start="6" type="1">
<li><p>Fill in your payment details!</p></li>
<li><p>As of 2018 there’s a modal dialog that you want to click through, I assume this will be designed away in the future so don’t worry if you don’t see it.</p></li>
</ol>
<p><img src="https://visibledata.co.uk/blog/2018-12-05-using-ggmap-after-july-2018/2018-12-05_google-maps-platform_enable-your-api.png" style="width:450px"></p>
<ol start="8" type="1">
<li>Success! Now you have an API key to use in R. You’ll want to copy it down somewhere.</li>
</ol>
<p><img src="https://visibledata.co.uk/blog/2018-12-05-using-ggmap-after-july-2018/2018-12-05_google-maps-platform_api-key.png" style="width:450px"></p>
<p>You need to have your API key with you EVERY time that you use <code>ggmap</code> for the time being. Make sure you keep a note of it from above, or else you can find it with these steps:</p>
<ol type="1">
<li>Navigate to <a href="https://console.cloud.google.com/apis/dashboard">https://console.cloud.google.com/apis/dashboard</a> and select the project (I went with <code>ggmap</code>) you created from the pull down list:</li>
</ol>
<p><img src="https://visibledata.co.uk/blog/2018-12-05-using-ggmap-after-july-2018/2018-12-05_google-maps-platform_select-project.png" style="width:450px"></p>
<ol type="1">
<li>Select credentials from the left-hand nav and you’ll be shown your API key</li>
</ol>
<p><img src="https://visibledata.co.uk/blog/2018-12-05-using-ggmap-after-july-2018/2018-12-05_google-maps-platform_credentials.png" style="width:450px"></p>
</section>
<section id="setting-up-and-using-ggmap" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-and-using-ggmap">Setting up and using <code>ggmap</code></h3>
<p>The instructions for these steps can be found in <a href="https://github.com/dkahle/ggmap/issues/51">Github Issue #51</a>.</p>
<ol type="1">
<li>There’s a dev version of the <code>ggmap</code> package that uses the new APIs, which we can install as follows:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">devtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">install_github</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dkahle/ggmap"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ref =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tidyup"</span>)</span></code></pre></div>
</div>
<ol start="2" type="1">
<li><p>You <strong>must</strong> now restart R.</p></li>
<li><p>Load the library and provide your API key</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">register_google</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">key =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My-FAKE-KEY"</span>)</span></code></pre></div>
</div>
<ol start="4" type="1">
<li>Now we can get our base maps using <code>get_googlemap()</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">base_map <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_googlemap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">center =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.2945</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">48.858222</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">maptype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"roadmap"</span>)</span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggmap</span>(base_map)</span></code></pre></div>
</div>
<p><img src="https://visibledata.co.uk/blog/2018-12-05-using-ggmap-after-july-2018/2018-12-05_ggmap-output.png" style="width:450px"></p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hadley2018,
  author = {Hadley, Charlie and Joey Hadley, Charlie},
  title = {Using Ggmap After {July} 2018},
  date = {2018-12-05},
  url = {https://visibledata.co.uk/posts/2018-12-05-using-ggmap-after-july-2018},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hadley2018" class="csl-entry quarto-appendix-citeas">
Hadley, Charlie, and Charlie Joey Hadley. 2018. <span>“Using Ggmap After
July 2018.”</span> December 5, 2018. <a href="https://visibledata.co.uk/posts/2018-12-05-using-ggmap-after-july-2018">https://visibledata.co.uk/posts/2018-12-05-using-ggmap-after-july-2018</a>.
</div></div></section></div> ]]></description>
  <category>dataviz</category>
  <category>R</category>
  <guid>https://visibledata.co.uk/posts/2018-12-05-using-ggmap-after-july-2018/</guid>
  <pubDate>Wed, 05 Dec 2018 00:00:00 GMT</pubDate>
</item>
</channel>
</rss>
