---
title: Christmas Drinks ggplot2 Advent Calendar 2018
author: Martin John Hadley
date: '2018-11-26'
slug: christmas-drinks-ggplot2-advent-calendar-2018
categories:
  - dataviz
tags:
  - R
  - fun
editor_options: 
  chunk_output_type: console
banner: "img/blog-images/header-images/2018-11-30_gg_christmass_advent_doors.png"
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/pymjs/pym.v1.js"></script>
<script src="/rmarkdown-libs/widgetframe-binding/widgetframe.js"></script>


<p>This Christmas it suddently hit me. There are probably enough festive coffees at Starbucks etc that you could use them to populate a very tasty advent calendar.</p>
<p>In the interests of helping everyone explore the range of Christmassy drinks on offer, I‚Äôll be updating my deposit <a href="https://doi.org/10.6084/m9.figshare.7376228">24 days of Christmass drinks</a> on Figshare every year from now on. This blogpost takes you through how you can create your own advent calendar using <code>ggplot2</code>.</p>
<!-- <img src='/img/blog-images/2018_advent-calendar/gg_christmass_advent_doors.png' onmouseover="this.src='/img/blog-images/2018_advent-calendar/gg_logoed_and_cardboarded_treats.png';" onmouseout="this.src='/img/blog-images/2018_advent-calendar/gg_christmass_advent_doors.png';" /> -->
<p><img src='/img/blog-images/2018_advent-calendar/gg_animated_door_openings_small.gif' width='600px'/></p>
<div id="christmassy-drinks-of-2018" class="section level2">
<h2>Christmassy drinks of 2018</h2>
<p>Before we can collate our advent of Christmassy drinks, we need to make some decisions:</p>
<ul>
<li>What counts as a Christmassy drink?
<ul>
<li>Any drink that I can buy all the way through 1st December through to 24th December (so no Pumpkin spice lattes).</li>
</ul></li>
<li>Which cafes should be included?
<ul>
<li>It‚Äôs my first year doing this. I‚Äôm going to choose places that are easy for me to get to!</li>
</ul></li>
<li>Do hot chocolates count?
<ul>
<li>I really wish they didn‚Äôt. But I could only find 15 festive coffee-based drinks.</li>
</ul></li>
</ul>
<p>After searching through a few menus, here are my selections for the Christmassy drinks of 2018:</p>
<div id="htmlwidget-1" style="width:100%;height:100%;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"/blog/2018-11-26-christmas-drinks-ggplot2-advent-calendar-2018_files/figure-html//widgets/widget_internal-show-drinks.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="make-your-own-ggplot2-advent" class="section level2">
<h2>Make your own <code>ggplot2</code> advent</h2>
<p>If you want to follow along, these are the steps you need to follow:</p>
<ol style="list-style-type: decimal">
<li><p>Create a new RStudio project</p></li>
<li><p>Create a data directory by running <code>dir.create(&quot;data&quot;)</code></p></li>
<li><p>Download version 3 of the Figshare deposit <a href="https://doi.org/10.6084/m9.figshare.7376228.v3">DOI:10.6084/m9.figshare.7376228.v3</a> by running this code</p></li>
</ol>
<pre class="r"><code>download.file(&quot;https://ndownloader.figshare.com/articles/7376228/versions/3&quot;,
              &quot;data/christmassy-drinks-2018.zip&quot;)
unzip(&quot;data/christmassy-drinks-2018.zip&quot;,
      exdir = &quot;data&quot;)
unlink(&quot;data/hristmassy-drinks-2018.zip&quot;)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Create a new script <code>christmassy-drinks-advent.R</code> and at the top load all the packages we‚Äôll need:</li>
</ol>
<pre class="r"><code>library(&quot;tidyverse&quot;)
library(&quot;grid&quot;)
library(&quot;rfigshare&quot;)
library(&quot;ggpubr&quot;)
library(&quot;magick&quot;)
library(&quot;here&quot;)</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Run the rest of the code in this blogpost üëé</li>
</ol>
</div>
<div id="ggplot2-advent-calendar-doors" class="section level2">
<h2>ggplot2 advent calendar doors</h2>
<p>In my opinion, there are only really two true advent calendar layouts:</p>
<p><img src="/blog/2018-11-26-christmas-drinks-ggplot2-advent-calendar-2018_files/figure-html/blog-landscape-or-portrait-1.png" width="480" /></p>
<p>We can easily compute the centers of all the doors in these advent calendar layouts with <code>tibble()</code> and <code>seq()</code>:</p>
<pre class="r"><code>portrait_door_centers &lt;- tibble(
  x = rep(seq(1, 10, 3), 6),
  y = rep(seq(1, 16, 3), times = 1, each = 4))

landscape_door_centers &lt;- tibble(
  y = rep(seq(1, 10, 3), 6),
  x = rep(seq(1, 16, 3), times = 1, each = 4))</code></pre>
<p>This blogpost will be slightly shorter if we continue with a landscape advent calendar, so let‚Äôs do that.</p>
<p>Which <code>geom_*()</code> is most suitable for our advent calendar? Well, <code>geom_tile()</code> requires only the centre of our doors. The theme <code>theme_void()</code> throws away the unnecessary axes labels etc, leaving us with our idealised advent calendar:</p>
<pre class="r"><code>gg_advent_landscape &lt;- landscape_door_centers %&gt;%
  ggplot(aes(x, y)) +
  geom_tile(color = &quot;black&quot;,
            size = 0.6,
            linetype = &quot;dotted&quot;,
            fill = &quot;white&quot;,
            alpha = 0.1) +
  theme_void() +
  coord_fixed()
gg_advent_landscape</code></pre>
<p><img src="/blog/2018-11-26-christmas-drinks-ggplot2-advent-calendar-2018_files/figure-html/blog-advent-template-1.png" width="480" /></p>
<p>How about the door labels? Let‚Äôs augment the data with door numbers via <code>mutate()</code> and then add <code>geom_label()</code> to display the door number:</p>
<pre class="r"><code>set.seed(1)
landscape_door_centers &lt;- landscape_door_centers %&gt;%
  mutate(door_number = sample(1:24))
gg_advent_landscape &lt;- landscape_door_centers %&gt;%
  ggplot(aes(x, y)) +
  geom_tile(color = &quot;black&quot;,
            size = 0.6,
            linetype = &quot;dotted&quot;,
            fill = &quot;white&quot;,
            alpha = 0.1) +
  geom_label(aes(label = door_number)) +
  theme_void() +
  coord_fixed()
gg_advent_landscape</code></pre>
<p><img src="/blog/2018-11-26-christmas-drinks-ggplot2-advent-calendar-2018_files/figure-html/blog-randomise-door-numbers-1.png" width="480" /></p>
</div>
<div id="ggplot2-advent-calendar-treats" class="section level2">
<h2>ggplot2 advent calendar treats</h2>
<p>Now we‚Äôve created the doors, we need to create the Christmassy drink treats! Let‚Äôs import the drinks data and re-order them via the <code>door_number</code> column:</p>
<pre class="r"><code>set.seed(1)
christmassy_drinks_2018 &lt;- read_csv(&quot;data/24-days-of-christmassy-drinks.csv&quot;) %&gt;%
  filter(year == 2018) %&gt;%
  slice(landscape_door_centers$door_number) %&gt;%
  mutate(door_number = 1:24)

landscape_door_treats &lt;- christmassy_drinks_2018 %&gt;%
  left_join(landscape_door_centers)</code></pre>
<p>The festive drinks have very long names (‚ÄúSalted caramel brownie hot chocolate‚Äù), so let‚Äôs insert line breaks every 10 characters to prettify our labels:</p>
<pre class="r"><code>landscape_door_treats &lt;- landscape_door_treats %&gt;%
  mutate(drink.name = gsub(&quot;(.{10,}?)\\s&quot;, &quot;\\1\n&quot;, drink.name))

gg_landscape_door_treats &lt;- landscape_door_treats %&gt;%
  ggplot(aes(x, y)) +
  geom_tile(color = &quot;black&quot;,
            size = 0.6,
            linetype = &quot;dotted&quot;,
            fill = &quot;lightgrey&quot;,
            alpha = 0.1) +
  geom_label(aes(label = drink.name),
             nudge_y = 0.5, # give room for logo
             size = 4) +
  theme_void() +
  coord_fixed()</code></pre>
<p><img src='/img/blog-images/2018_advent-calendar/gg_landscape_door_treat_labels.png' style='width:600px'/></p>
<p>It would look great if we could add the retailers‚Äô logos to the squares. Let‚Äôs first import these images from the <code>data</code> folder:</p>
<pre class="r"><code>starbucks_logo &lt;- image_read(&quot;data/starbucks_logo.png&quot;) %&gt;%
  rasterGrob(interpolate = T)

costa_logo &lt;- image_read(&quot;data/costa_logo.png&quot;) %&gt;%
  rasterGrob(interpolate = T)

cafe_nero_logo &lt;- image_read(&quot;data/cafe-nero_logo.jpg&quot;) %&gt;%
  rasterGrob(interpolate = T)

greggs_logo &lt;- image_read(&quot;data/greggs_logo.png&quot;) %&gt;%
  rasterGrob(interpolate = T)

pret_logo &lt;- image_read(&quot;data/pret_logo.jpg&quot;) %&gt;%
  rasterGrob(interpolate = T)

mc_cafe_logo &lt;- image_read(&quot;data/mc-caf√©_logo.png&quot;) %&gt;%
  rasterGrob(interpolate = T)</code></pre>
<p>Use <code>annotation_custom</code> is the best tool for inserting images into a <code>ggplot2</code> object. After a lot of jiggery pokery, these are fairly good options for nudging the logo into an appropriate position in the door:</p>
<pre class="r"><code>door_center &lt;- list(x = 1, y = 1)

nudge_logo_ymin &lt;- -1.25
nudge_logo_ymax &lt;- -0.25
nudge_logo_xmin &lt;- -0.5
nudge_logo_xmax &lt;- 0.5

gg_one_logo &lt;- gg_landscape_door_treats +
  annotation_custom(starbucks_logo, 
                    ymin = door_center$y + nudge_logo_ymax, 
                    ymax = door_center$y + nudge_logo_ymin, 
                    xmin = door_center$x + nudge_logo_xmin, 
                    xmax = door_center$x + nudge_logo_xmax)</code></pre>
<p><img src='/img/blog-images/2018_advent-calendar/gg_one_logo.png' style='width:600px'/></p>
<p>We need to add logos for all the doors. This could be achieved by writing a <code>for</code> (or any other) kind of loop. But it‚Äôs my preference to use the <code>purrr</code> package for a functional approach to this problem.</p>
<p><code>pwalk</code> allows us to iterate a function over every row of <code>landscape_door_treats</code>, which in this case adds a <code>annotation_custom</code> layer to <code>gg_logoed_treats</code>. We use the <code>&lt;&lt;-</code> <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> assignment operator so that the global version of <code>gg_logoed_treatsis</code> is updated. <code>pwalk</code> is the same as <code>pmap</code> but doesn‚Äôt generate output; side-effects are the only repurcussions of <code>pwalk</code>.</p>
<pre class="r"><code>gg_logoed_treats &lt;- gg_landscape_door_treats

landscape_door_treats %&gt;%
  pwalk(function(x, y, retailer, ...){
    
    logo &lt;- switch (retailer,
      &quot;Starbucks&quot; = starbucks_logo,
      &quot;Costa&quot; = costa_logo,
      &quot;Caf√© Nero&quot; = cafe_nero_logo,
      &quot;Greggs&quot; = greggs_logo,
      &quot;McCaf√©&quot; = mc_cafe_logo,
      &quot;Pret&quot; = pret_logo
    )
    gg_logoed_treats &lt;&lt;- gg_logoed_treats +
      annotation_custom(logo, ymin = y - 1.25, ymax = y - 0.25, xmin = x - 0.5, xmax = x + 0.5)
    
  })</code></pre>
<p><img src='/img/blog-images/2018_advent-calendar/gg_logoed_treats.png' style='width:600px'/></p>
</div>
<div id="background-images" class="section level2">
<h2>Background images</h2>
<p>We should really add background images to the two parts of our advent calendar; a Christmassy image for the doors and a cardboard background for the insides of the doors.</p>
<p>The <code>ggpubr</code> package provides <code>background_image()</code> to add an image into the <code>panel</code> of a <code>ggplot2</code>, but it will be placed on top of everything added before it. So, let‚Äôs reorder our <code>ggplot2</code> layers for the doors with this <a href="https://pixabay.com/en/santa-christmas-coffee-mugs-3016939/"><em>beautiful</em> license-free image from pixelbay</a>:</p>
<pre class="r"><code>christmassy_background &lt;- image_read(here(&quot;static&quot;, &quot;img&quot;, &quot;blog-images&quot;, &quot;2018_advent-calendar&quot;, &quot;santa-3016939_640.jpg&quot;))

gg_advent_landscape &lt;- landscape_door_centers %&gt;%
  ggplot(aes(x, y)) +
  background_image(christmassy_background) +
  geom_tile(color = &quot;black&quot;,
            size = 0.6,
            linetype = &quot;dotted&quot;,
            fill = &quot;white&quot;,
            alpha = 0.1) +
  geom_label(aes(label = door_number)) +
  theme_void() +
  coord_fixed()
gg_advent_landscape</code></pre>
<p><img src='/img/blog-images/2018_advent-calendar/gg_christmass_advent_doors.png' width='600px'/></p>
<p>I think it‚Äôs a lot of fun to add a cardboard effect to the treats, so I found this <a href="https://www.flickr.com/photos/27668445@N03/3191148261">license-free image from flickr</a> which I really enjoy:</p>
<pre class="r"><code>cardboard_background &lt;- image_read(here(&quot;static&quot;, &quot;img&quot;, &quot;blog-images&quot;, &quot;2018_advent-calendar&quot;, &quot;cardboard-effect.jpg&quot;))

gg_landscape_door_treats &lt;- landscape_door_treats %&gt;%
  ggplot(aes(x, y)) +
  background_image(cardboard_background) +
  geom_tile(color = &quot;black&quot;,
            size = 0.6,
            linetype = &quot;dotted&quot;,
            fill = &quot;lightgrey&quot;,
            alpha = 0.1) +
  geom_label(aes(label = drink.name),
             nudge_y = 0.5, # give room for logo
             size = 4) +
  theme_void() +
  coord_fixed()</code></pre>
<p><img src='/img/blog-images/2018_advent-calendar/gg_logoed_and_cardboarded_treats.png' width='600px'/></p>
</div>
<div id="iteratively-opening-the-advent-calendar" class="section level2">
<h2>Iteratively opening the advent calendar</h2>
<p>The two images we‚Äôve created so far are only really that useful if we‚Äôre going to print them out and stick together. And even then, it‚Äôs a waste of ink printing out a cardboard effect!</p>
<p>Let‚Äôs create a function for opening the advent doors:</p>
<pre class="r"><code>open_advent_doors &lt;- function(gg_advent,
                              advent_treats,
                              open_doors) {
  gg_local &lt;- gg_advent

  advent_treats %&gt;%
    filter(door_number %in% open_doors) %&gt;%
    pwalk(function(x, y, retailer, drink.name, ...) {
      logo &lt;- switch(retailer,
        &quot;Starbucks&quot; = starbucks_logo,
        &quot;Costa&quot; = costa_logo,
        &quot;Caf√© Nero&quot; = cafe_nero_logo,
        &quot;Greggs&quot; = greggs_logo,
        &quot;McCaf√©&quot; = mc_cafe_logo,
        &quot;Pret&quot; = pret_logo
      )
      gg_local &lt;&lt;- gg_local +
        annotation_custom(
          cardboard_background %&gt;%
            image_crop(&quot;-200x400&quot;) %&gt;%
            grid::rasterGrob(interpolate = T),
          ymin = y - 1.5,
          ymax = y + 1.5,
          xmin = x - 2,
          xmax = x + 2
        ) +
        annotation_custom(
          logo,
          ymin = y - 1.25,
          ymax = y - 0.25,
          xmin = x - 0.5,
          xmax = x + 0.5
        ) +
        geom_label(
          data = tibble(x, y, drink.name),
          aes(
            label = drink.name,
            x = x,
            y = y
          ),
          nudge_y = 0.5,
          # give room for logo
          size = 5
        )
    })

  gg_local
}</code></pre>
<p>Here‚Äôs how our calendar looks after opening 10 doors:</p>
<pre class="r"><code>open_multiple_doors(gg_advent_landscape,
                    landscape_door_treats,
                    1:10)</code></pre>
<p><img src='/img/blog-images/2018_advent-calendar/gg_opened_10_doors.png' width='600px'/></p>
<p>Unfortunately, I don‚Äôt know how to use the <strong>incredible</strong> <a href="https://github.com/thomasp85/gganimate">gganimate package</a> to animate between door openings. Until I learn how, I‚Äôm going to create a .gif by exporting each step of the advent being opened and stitch them together with the <code>magick</code> package.</p>
<pre class="r"><code>tibble(remaining_days = 1:24) %&gt;%
  rowwise() %&gt;%
  mutate(doors = list(1:remaining_days)) %&gt;%
  pwalk(function(doors, ...) {
    opened_door &lt;- open_advent_doors(
      gg_advent_landscape,
      landscape_door_treats,
      doors
    )

    img_path &lt;- here(
        &quot;data&quot;,
        paste0(
          &quot;gg_iterative_opened_door_&quot;,
          formatC(
            length(doors),
            width = 2,
            format = &quot;d&quot;,
            flag = &quot;0&quot;
          ),
          &quot;.png&quot;
        )
      )
    
    ggsave(
      img_path,
      opened_door
    )
    
    image_read(img_path) %&gt;%
      image_trim() %&gt;%
      image_resize(&quot;1400x&quot;) %&gt;%
      image_write(img_path)
    
  })

door_open_images &lt;- list.files(paste0(
        &quot;static&quot;,
        &quot;img&quot;,
        &quot;blog-images&quot;,
        &quot;2018_advent-calendar&quot;), &quot;gg_iterative_opened_door&quot;, full.names = TRUE)


door_open_images %&gt;%
  tibble(img = .) %&gt;%
  map(function(img){image_read(img)}) %&gt;%
  image_join() %&gt;%
  image_animate(fps = 0.5) %&gt;%
  image_write(here(
        &quot;static&quot;,
        &quot;img&quot;,
        &quot;blog-images&quot;,
        &quot;2018_advent-calendar&quot;, &quot;gg_animated_door_openings.gif&quot;))</code></pre>
<p><img src='/img/blog-images/2018_advent-calendar/gg_animated_door_openings_small.gif' width='600px'/></p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>See Hadley Wickham‚Äôs <a href="https://stackoverflow.com/a/2630222/1659890">StackOverflow answer for more details</a><a href="#fnref1" class="footnote-back">‚Ü©</a></p></li>
</ol>
</div>
